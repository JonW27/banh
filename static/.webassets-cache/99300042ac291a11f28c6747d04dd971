V(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global.CodeMirror=factory());}(this,(function(){'use strict';var userAgent=navigator.userAgent\u000avar platform=navigator.platform\u000avar gecko=/gecko\u005c/\u005cd/i.test(userAgent)\u000avar ie_upto10=/MSIE \u005cd/.test(userAgent)\u000avar ie_11up=/Trident\u005c/(?:[7-9]|\u005cd{2,})\u005c..*rv:(\u005cd+)/.exec(userAgent)\u000avar edge=/Edge\u005c/(\u005cd+)/.exec(userAgent)\u000avar ie=ie_upto10||ie_11up||edge\u000avar ie_version=ie&&(ie_upto10?document.documentMode||6:+(edge||ie_11up)[1])\u000avar webkit=!edge&&/WebKit\u005c//.test(userAgent)\u000avar qtwebkit=webkit&&/Qt\u005c/\u005cd+\u005c.\u005cd+/.test(userAgent)\u000avar chrome=!edge&&/Chrome\u005c//.test(userAgent)\u000avar presto=/Opera\u005c//.test(userAgent)\u000avar safari=/Apple Computer/.test(navigator.vendor)\u000avar mac_geMountainLion=/Mac OS X 1\u005cd\u005cD([8-9]|\u005cd\u005cd)\u005cD/.test(userAgent)\u000avar phantom=/PhantomJS/.test(userAgent)\u000avar ios=!edge&&/AppleWebKit/.test(userAgent)&&/Mobile\u005c/\u005cw+/.test(userAgent)\u000avar android=/Android/.test(userAgent)\u000avar mobile=ios||android||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent)\u000avar mac=ios||/Mac/.test(platform)\u000avar chromeOS=/\u005cbCrOS\u005cb/.test(userAgent)\u000avar windows=/win/i.test(platform)\u000avar presto_version=presto&&userAgent.match(/Version\u005c/(\u005cd*\u005c.\u005cd*)/)\u000aif(presto_version){presto_version=Number(presto_version[1])}\u000aif(presto_version&&presto_version>=15){presto=false;webkit=true}\u000avar flipCtrlCmd=mac&&(qtwebkit||presto&&(presto_version==null||presto_version<12.11))\u000avar captureRightClick=gecko||(ie&&ie_version>=9)\u000afunction classTest(cls){return new RegExp("(^|\u005c\u005cs)"+cls+"(?:$|\u005c\u005cs)\u005c\u005cs*")}\u000avar rmClass=function(node,cls){var current=node.className\u000avar match=classTest(cls).exec(current)\u000aif(match){var after=current.slice(match.index+match[0].length)\u000anode.className=current.slice(0,match.index)+(after?match[1]+after:"")}}\u000afunction removeChildren(e){for(var count=e.childNodes.length;count>0;--count)\u000a{e.removeChild(e.firstChild)}\u000areturn e}\u000afunction removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}\u000afunction elt(tag,content,className,style){var e=document.createElement(tag)\u000aif(className){e.className=className}\u000aif(style){e.style.cssText=style}\u000aif(typeof content=="string"){e.appendChild(document.createTextNode(content))}\u000aelse if(content){for(var i=0;i<content.length;++i){e.appendChild(content[i])}}\u000areturn e}\u000afunction eltP(tag,content,className,style){var e=elt(tag,content,className,style)\u000ae.setAttribute("role","presentation")\u000areturn e}\u000avar range\u000aif(document.createRange){range=function(node,start,end,endNode){var r=document.createRange()\u000ar.setEnd(endNode||node,end)\u000ar.setStart(node,start)\u000areturn r}}\u000aelse{range=function(node,start,end){var r=document.body.createTextRange()\u000atry{r.moveToElementText(node.parentNode)}\u000acatch(e){return r}\u000ar.collapse(true)\u000ar.moveEnd("character",end)\u000ar.moveStart("character",start)\u000areturn r}}\u000afunction contains(parent,child){if(child.nodeType==3)\u000a{child=child.parentNode}\u000aif(parent.contains)\u000a{return parent.contains(child)}\u000ado{if(child.nodeType==11){child=child.host}\u000aif(child==parent){return true}}while(child=child.parentNode)}\u000afunction activeElt(){var activeElement\u000atry{activeElement=document.activeElement}catch(e){activeElement=document.body||null}\u000awhile(activeElement&&activeElement.shadowRoot&&activeElement.shadowRoot.activeElement)\u000a{activeElement=activeElement.shadowRoot.activeElement}\u000areturn activeElement}\u000afunction addClass(node,cls){var current=node.className\u000aif(!classTest(cls).test(current)){node.className+=(current?" ":"")+cls}}\u000afunction joinClasses(a,b){var as=a.split(" ")\u000afor(var i=0;i<as.length;i++)\u000a{if(as[i]&&!classTest(as[i]).test(b)){b+=" "+as[i]}}\u000areturn b}\u000avar selectInput=function(node){node.select()}\u000aif(ios)\u000a{selectInput=function(node){node.selectionStart=0;node.selectionEnd=node.value.length}}\u000aelse if(ie)\u000a{selectInput=function(node){try{node.select()}catch(_e){}}}\u000afunction bind(f){var args=Array.prototype.slice.call(arguments,1)\u000areturn function(){return f.apply(null,args)}}\u000afunction copyObj(obj,target,overwrite){if(!target){target={}}\u000afor(var prop in obj)\u000a{if(obj.hasOwnProperty(prop)&&(overwrite!==false||!target.hasOwnProperty(prop)))\u000a{target[prop]=obj[prop]}}\u000areturn target}\u000afunction countColumn(string,end,tabSize,startIndex,startValue){if(end==null){end=string.search(/[^\u005cs\u005cu00a0]/)\u000aif(end==-1){end=string.length}}\u000afor(var i=startIndex||0,n=startValue||0;;){var nextTab=string.indexOf("\u005ct",i)\u000aif(nextTab<0||nextTab>=end)\u000a{return n+(end-i)}\u000an+=nextTab-i\u000an+=tabSize-(n%tabSize)\u000ai=nextTab+1}}\u000avar Delayed=function(){this.id=null};Delayed.prototype.set=function(ms,f){clearTimeout(this.id)\u000athis.id=setTimeout(f,ms)};function indexOf(array,elt){for(var i=0;i<array.length;++i)\u000a{if(array[i]==elt){return i}}\u000areturn-1}\u000avar scrollerGap=30\u000avar Pass={toString:function(){return"CodeMirror.Pass"}}\u000avar sel_dontScroll={scroll:false};var sel_mouse={origin:"*mouse"};var sel_move={origin:"+move"};function findColumn(string,goal,tabSize){for(var pos=0,col=0;;){var nextTab=string.indexOf("\u005ct",pos)\u000aif(nextTab==-1){nextTab=string.length}\u000avar skipped=nextTab-pos\u000aif(nextTab==string.length||col+skipped>=goal)\u000a{return pos+Math.min(skipped,goal-col)}\u000acol+=nextTab-pos\u000acol+=tabSize-(col%tabSize)\u000apos=nextTab+1\u000aif(col>=goal){return pos}}}\u000avar spaceStrs=[""]\u000afunction spaceStr(n){while(spaceStrs.length<=n)\u000a{spaceStrs.push(lst(spaceStrs)+" ")}\u000areturn spaceStrs[n]}\u000afunction lst(arr){return arr[arr.length-1]}\u000afunction map(array,f){var out=[]\u000afor(var i=0;i<array.length;i++){out[i]=f(array[i],i)}\u000areturn out}\u000afunction insertSorted(array,value,score){var pos=0,priority=score(value)\u000awhile(pos<array.length&&score(array[pos])<=priority){pos++}\u000aarray.splice(pos,0,value)}\u000afunction nothing(){}\u000afunction createObj(base,props){var inst\u000aif(Object.create){inst=Object.create(base)}else{nothing.prototype=base\u000ainst=new nothing()}\u000aif(props){copyObj(props,inst)}\u000areturn inst}\u000avar nonASCIISingleCaseWordChar=/[\u005cu00df\u005cu0587\u005cu0590-\u005cu05f4\u005cu0600-\u005cu06ff\u005cu3040-\u005cu309f\u005cu30a0-\u005cu30ff\u005cu3400-\u005cu4db5\u005cu4e00-\u005cu9fcc\u005cuac00-\u005cud7af]/\u000afunction isWordCharBasic(ch){return /\u005cw/.test(ch)||ch>"\u005cx80"&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}\u000afunction isWordChar(ch,helper){if(!helper){return isWordCharBasic(ch)}\u000aif(helper.source.indexOf("\u005c\u005cw")>-1&&isWordCharBasic(ch)){return true}\u000areturn helper.test(ch)}\u000afunction isEmpty(obj){for(var n in obj){if(obj.hasOwnProperty(n)&&obj[n]){return false}}\u000areturn true}\u000avar extendingChars=/[\u005cu0300-\u005cu036f\u005cu0483-\u005cu0489\u005cu0591-\u005cu05bd\u005cu05bf\u005cu05c1\u005cu05c2\u005cu05c4\u005cu05c5\u005cu05c7\u005cu0610-\u005cu061a\u005cu064b-\u005cu065e\u005cu0670\u005cu06d6-\u005cu06dc\u005cu06de-\u005cu06e4\u005cu06e7\u005cu06e8\u005cu06ea-\u005cu06ed\u005cu0711\u005cu0730-\u005cu074a\u005cu07a6-\u005cu07b0\u005cu07eb-\u005cu07f3\u005cu0816-\u005cu0819\u005cu081b-\u005cu0823\u005cu0825-\u005cu0827\u005cu0829-\u005cu082d\u005cu0900-\u005cu0902\u005cu093c\u005cu0941-\u005cu0948\u005cu094d\u005cu0951-\u005cu0955\u005cu0962\u005cu0963\u005cu0981\u005cu09bc\u005cu09be\u005cu09c1-\u005cu09c4\u005cu09cd\u005cu09d7\u005cu09e2\u005cu09e3\u005cu0a01\u005cu0a02\u005cu0a3c\u005cu0a41\u005cu0a42\u005cu0a47\u005cu0a48\u005cu0a4b-\u005cu0a4d\u005cu0a51\u005cu0a70\u005cu0a71\u005cu0a75\u005cu0a81\u005cu0a82\u005cu0abc\u005cu0ac1-\u005cu0ac5\u005cu0ac7\u005cu0ac8\u005cu0acd\u005cu0ae2\u005cu0ae3\u005cu0b01\u005cu0b3c\u005cu0b3e\u005cu0b3f\u005cu0b41-\u005cu0b44\u005cu0b4d\u005cu0b56\u005cu0b57\u005cu0b62\u005cu0b63\u005cu0b82\u005cu0bbe\u005cu0bc0\u005cu0bcd\u005cu0bd7\u005cu0c3e-\u005cu0c40\u005cu0c46-\u005cu0c48\u005cu0c4a-\u005cu0c4d\u005cu0c55\u005cu0c56\u005cu0c62\u005cu0c63\u005cu0cbc\u005cu0cbf\u005cu0cc2\u005cu0cc6\u005cu0ccc\u005cu0ccd\u005cu0cd5\u005cu0cd6\u005cu0ce2\u005cu0ce3\u005cu0d3e\u005cu0d41-\u005cu0d44\u005cu0d4d\u005cu0d57\u005cu0d62\u005cu0d63\u005cu0dca\u005cu0dcf\u005cu0dd2-\u005cu0dd4\u005cu0dd6\u005cu0ddf\u005cu0e31\u005cu0e34-\u005cu0e3a\u005cu0e47-\u005cu0e4e\u005cu0eb1\u005cu0eb4-\u005cu0eb9\u005cu0ebb\u005cu0ebc\u005cu0ec8-\u005cu0ecd\u005cu0f18\u005cu0f19\u005cu0f35\u005cu0f37\u005cu0f39\u005cu0f71-\u005cu0f7e\u005cu0f80-\u005cu0f84\u005cu0f86\u005cu0f87\u005cu0f90-\u005cu0f97\u005cu0f99-\u005cu0fbc\u005cu0fc6\u005cu102d-\u005cu1030\u005cu1032-\u005cu1037\u005cu1039\u005cu103a\u005cu103d\u005cu103e\u005cu1058\u005cu1059\u005cu105e-\u005cu1060\u005cu1071-\u005cu1074\u005cu1082\u005cu1085\u005cu1086\u005cu108d\u005cu109d\u005cu135f\u005cu1712-\u005cu1714\u005cu1732-\u005cu1734\u005cu1752\u005cu1753\u005cu1772\u005cu1773\u005cu17b7-\u005cu17bd\u005cu17c6\u005cu17c9-\u005cu17d3\u005cu17dd\u005cu180b-\u005cu180d\u005cu18a9\u005cu1920-\u005cu1922\u005cu1927\u005cu1928\u005cu1932\u005cu1939-\u005cu193b\u005cu1a17\u005cu1a18\u005cu1a56\u005cu1a58-\u005cu1a5e\u005cu1a60\u005cu1a62\u005cu1a65-\u005cu1a6c\u005cu1a73-\u005cu1a7c\u005cu1a7f\u005cu1b00-\u005cu1b03\u005cu1b34\u005cu1b36-\u005cu1b3a\u005cu1b3c\u005cu1b42\u005cu1b6b-\u005cu1b73\u005cu1b80\u005cu1b81\u005cu1ba2-\u005cu1ba5\u005cu1ba8\u005cu1ba9\u005cu1c2c-\u005cu1c33\u005cu1c36\u005cu1c37\u005cu1cd0-\u005cu1cd2\u005cu1cd4-\u005cu1ce0\u005cu1ce2-\u005cu1ce8\u005cu1ced\u005cu1dc0-\u005cu1de6\u005cu1dfd-\u005cu1dff\u005cu200c\u005cu200d\u005cu20d0-\u005cu20f0\u005cu2cef-\u005cu2cf1\u005cu2de0-\u005cu2dff\u005cu302a-\u005cu302f\u005cu3099\u005cu309a\u005cua66f-\u005cua672\u005cua67c\u005cua67d\u005cua6f0\u005cua6f1\u005cua802\u005cua806\u005cua80b\u005cua825\u005cua826\u005cua8c4\u005cua8e0-\u005cua8f1\u005cua926-\u005cua92d\u005cua947-\u005cua951\u005cua980-\u005cua982\u005cua9b3\u005cua9b6-\u005cua9b9\u005cua9bc\u005cuaa29-\u005cuaa2e\u005cuaa31\u005cuaa32\u005cuaa35\u005cuaa36\u005cuaa43\u005cuaa4c\u005cuaab0\u005cuaab2-\u005cuaab4\u005cuaab7\u005cuaab8\u005cuaabe\u005cuaabf\u005cuaac1\u005cuabe5\u005cuabe8\u005cuabed\u005cudc00-\u005cudfff\u005cufb1e\u005cufe00-\u005cufe0f\u005cufe20-\u005cufe26\u005cuff9e\u005cuff9f]/\u000afunction isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChars.test(ch)}\u000afunction skipExtendingChars(str,pos,dir){while((dir<0?pos>0:pos<str.length)&&isExtendingChar(str.charAt(pos))){pos+=dir}\u000areturn pos}\u000afunction findFirst(pred,from,to){var dir=from>to?-1:1\u000afor(;;){if(from==to){return from}\u000avar midF=(from+to)/2,mid=dir<0?Math.ceil(midF):Math.floor(midF)\u000aif(mid==from){return pred(mid)?from:to}\u000aif(pred(mid)){to=mid}\u000aelse{from=mid+dir}}}\u000afunction Display(place,doc,input){var d=this\u000athis.input=input\u000ad.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler")\u000ad.scrollbarFiller.setAttribute("cm-not-content","true")\u000ad.gutterFiller=elt("div",null,"CodeMirror-gutter-filler")\u000ad.gutterFiller.setAttribute("cm-not-content","true")\u000ad.lineDiv=eltP("div",null,"CodeMirror-code")\u000ad.selectionDiv=elt("div",null,null,"position: relative; z-index: 1")\u000ad.cursorDiv=elt("div",null,"CodeMirror-cursors")\u000ad.measure=elt("div",null,"CodeMirror-measure")\u000ad.lineMeasure=elt("div",null,"CodeMirror-measure")\u000ad.lineSpace=eltP("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none")\u000avar lines=eltP("div",[d.lineSpace],"CodeMirror-lines")\u000ad.mover=elt("div",[lines],null,"position: relative")\u000ad.sizer=elt("div",[d.mover],"CodeMirror-sizer")\u000ad.sizerWidth=null\u000ad.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerGap+"px; width: 1px;")\u000ad.gutters=elt("div",null,"CodeMirror-gutters")\u000ad.lineGutter=null\u000ad.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll")\u000ad.scroller.setAttribute("tabIndex","-1")\u000ad.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror")\u000aif(ie&&ie_version<8){d.gutters.style.zIndex=-1;d.scroller.style.paddingRight=0}\u000aif(!webkit&&!(gecko&&mobile)){d.scroller.draggable=true}\u000aif(place){if(place.appendChild){place.appendChild(d.wrapper)}\u000aelse{place(d.wrapper)}}\u000ad.viewFrom=d.viewTo=doc.first\u000ad.reportedViewFrom=d.reportedViewTo=doc.first\u000ad.view=[]\u000ad.renderedView=null\u000ad.externalMeasured=null\u000ad.viewOffset=0\u000ad.lastWrapHeight=d.lastWrapWidth=0\u000ad.updateLineNumbers=null\u000ad.nativeBarWidth=d.barHeight=d.barWidth=0\u000ad.scrollbarsClipped=false\u000ad.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null\u000ad.alignWidgets=false\u000ad.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null\u000ad.maxLine=null\u000ad.maxLineLength=0\u000ad.maxLineChanged=false\u000ad.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null\u000ad.shift=false\u000ad.selForContextMenu=null\u000ad.activeTouch=null\u000ainput.init(d)}\u000afunction getLine(doc,n){n-=doc.first\u000aif(n<0||n>=doc.size){throw new Error("There is no line "+(n+doc.first)+" in the document.")}\u000avar chunk=doc\u000awhile(!chunk.lines){for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize()\u000aif(n<sz){chunk=child;break}\u000an-=sz}}\u000areturn chunk.lines[n]}\u000afunction getBetween(doc,start,end){var out=[],n=start.line\u000adoc.iter(start.line,end.line+1,function(line){var text=line.text\u000aif(n==end.line){text=text.slice(0,end.ch)}\u000aif(n==start.line){text=text.slice(start.ch)}\u000aout.push(text)\u000a++n})\u000areturn out}\u000afunction getLines(doc,from,to){var out=[]\u000adoc.iter(from,to,function(line){out.push(line.text)})\u000areturn out}\u000afunction updateLineHeight(line,height){var diff=height-line.height\u000aif(diff){for(var n=line;n;n=n.parent){n.height+=diff}}}\u000afunction lineNo(line){if(line.parent==null){return null}\u000avar cur=line.parent,no=indexOf(cur.lines,line)\u000afor(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent){for(var i=0;;++i){if(chunk.children[i]==cur){break}\u000ano+=chunk.children[i].chunkSize()}}\u000areturn no+cur.first}\u000afunction lineAtHeight(chunk,h){var n=chunk.first\u000aouter:do{for(var i$1=0;i$1<chunk.children.length;++i$1){var child=chunk.children[i$1],ch=child.height\u000aif(h<ch){chunk=child;continue outer}\u000ah-=ch\u000an+=child.chunkSize()}\u000areturn n}while(!chunk.lines)\u000avar i=0\u000afor(;i<chunk.lines.length;++i){var line=chunk.lines[i],lh=line.height\u000aif(h<lh){break}\u000ah-=lh}\u000areturn n+i}\u000afunction isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}\u000afunction lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber))}\u000afunction Pos(line,ch,sticky){if(sticky===void 0)sticky=null;if(!(this instanceof Pos)){return new Pos(line,ch,sticky)}\u000athis.line=line\u000athis.ch=ch\u000athis.sticky=sticky}\u000afunction cmp(a,b){return a.line-b.line||a.ch-b.ch}\u000afunction equalCursorPos(a,b){return a.sticky==b.sticky&&cmp(a,b)==0}\u000afunction copyPos(x){return Pos(x.line,x.ch)}\u000afunction maxPos(a,b){return cmp(a,b)<0?b:a}\u000afunction minPos(a,b){return cmp(a,b)<0?a:b}\u000afunction clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1))}\u000afunction clipPos(doc,pos){if(pos.line<doc.first){return Pos(doc.first,0)}\u000avar last=doc.first+doc.size-1\u000aif(pos.line>last){return Pos(last,getLine(doc,last).text.length)}\u000areturn clipToLen(pos,getLine(doc,pos.line).text.length)}\u000afunction clipToLen(pos,linelen){var ch=pos.ch\u000aif(ch==null||ch>linelen){return Pos(pos.line,linelen)}\u000aelse if(ch<0){return Pos(pos.line,0)}\u000aelse{return pos}}\u000afunction clipPosArray(doc,array){var out=[]\u000afor(var i=0;i<array.length;i++){out[i]=clipPos(doc,array[i])}\u000areturn out}\u000avar sawReadOnlySpans=false;var sawCollapsedSpans=false;function seeReadOnlySpans(){sawReadOnlySpans=true}\u000afunction seeCollapsedSpans(){sawCollapsedSpans=true}\u000afunction MarkedSpan(marker,from,to){this.marker=marker\u000athis.from=from;this.to=to}\u000afunction getMarkedSpanFor(spans,marker){if(spans){for(var i=0;i<spans.length;++i){var span=spans[i]\u000aif(span.marker==marker){return span}}}}\u000afunction removeMarkedSpan(spans,span){var r\u000afor(var i=0;i<spans.length;++i)\u000a{if(spans[i]!=span){(r||(r=[])).push(spans[i])}}\u000areturn r}\u000afunction addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span]\u000aspan.marker.attachLine(line)}\u000afunction markedSpansBefore(old,startCh,isInsert){var nw\u000aif(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker\u000avar startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh)\u000aif(startsBefore||span.from==startCh&&marker.type=="bookmark"&&(!isInsert||!span.marker.insertLeft)){var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);(nw||(nw=[])).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to))}}}\u000areturn nw}\u000afunction markedSpansAfter(old,endCh,isInsert){var nw\u000aif(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker\u000avar endsAfter=span.to==null||(marker.inclusiveRight?span.to>=endCh:span.to>endCh)\u000aif(endsAfter||span.from==endCh&&marker.type=="bookmark"&&(!isInsert||span.marker.insertLeft)){var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);(nw||(nw=[])).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,span.to==null?null:span.to-endCh))}}}\u000areturn nw}\u000afunction stretchSpansOverChange(doc,change){if(change.full){return null}\u000avar oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans\u000avar oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans\u000aif(!oldFirst&&!oldLast){return null}\u000avar startCh=change.from.ch,endCh=change.to.ch,isInsert=cmp(change.from,change.to)==0\u000avar first=markedSpansBefore(oldFirst,startCh,isInsert)\u000avar last=markedSpansAfter(oldLast,endCh,isInsert)\u000avar sameLine=change.text.length==1,offset=lst(change.text).length+(sameLine?startCh:0)\u000aif(first){for(var i=0;i<first.length;++i){var span=first[i]\u000aif(span.to==null){var found=getMarkedSpanFor(last,span.marker)\u000aif(!found){span.to=startCh}\u000aelse if(sameLine){span.to=found.to==null?null:found.to+offset}}}}\u000aif(last){for(var i$1=0;i$1<last.length;++i$1){var span$1=last[i$1]\u000aif(span$1.to!=null){span$1.to+=offset}\u000aif(span$1.from==null){var found$1=getMarkedSpanFor(first,span$1.marker)\u000aif(!found$1){span$1.from=offset\u000aif(sameLine){(first||(first=[])).push(span$1)}}}else{span$1.from+=offset\u000aif(sameLine){(first||(first=[])).push(span$1)}}}}\u000aif(first){first=clearEmptySpans(first)}\u000aif(last&&last!=first){last=clearEmptySpans(last)}\u000avar newMarkers=[first]\u000aif(!sameLine){var gap=change.text.length-2,gapMarkers\u000aif(gap>0&&first)\u000a{for(var i$2=0;i$2<first.length;++i$2)\u000a{if(first[i$2].to==null)\u000a{(gapMarkers||(gapMarkers=[])).push(new MarkedSpan(first[i$2].marker,null,null))}}}\u000afor(var i$3=0;i$3<gap;++i$3)\u000a{newMarkers.push(gapMarkers)}\u000anewMarkers.push(last)}\u000areturn newMarkers}\u000afunction clearEmptySpans(spans){for(var i=0;i<spans.length;++i){var span=spans[i]\u000aif(span.from!=null&&span.from==span.to&&span.marker.clearWhenEmpty!==false)\u000a{spans.splice(i--,1)}}\u000aif(!spans.length){return null}\u000areturn spans}\u000afunction removeReadOnlyRanges(doc,from,to){var markers=null\u000adoc.iter(from.line,to.line+1,function(line){if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var mark=line.markedSpans[i].marker\u000aif(mark.readOnly&&(!markers||indexOf(markers,mark)==-1))\u000a{(markers||(markers=[])).push(mark)}}}})\u000aif(!markers){return null}\u000avar parts=[{from:from,to:to}]\u000afor(var i=0;i<markers.length;++i){var mk=markers[i],m=mk.find(0)\u000afor(var j=0;j<parts.length;++j){var p=parts[j]\u000aif(cmp(p.to,m.from)<0||cmp(p.from,m.to)>0){continue}\u000avar newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to)\u000aif(dfrom<0||!mk.inclusiveLeft&&!dfrom)\u000a{newParts.push({from:p.from,to:m.from})}\u000aif(dto>0||!mk.inclusiveRight&&!dto)\u000a{newParts.push({from:m.to,to:p.to})}\u000aparts.splice.apply(parts,newParts)\u000aj+=newParts.length-3}}\u000areturn parts}\u000afunction detachMarkedSpans(line){var spans=line.markedSpans\u000aif(!spans){return}\u000afor(var i=0;i<spans.length;++i)\u000a{spans[i].marker.detachLine(line)}\u000aline.markedSpans=null}\u000afunction attachMarkedSpans(line,spans){if(!spans){return}\u000afor(var i=0;i<spans.length;++i)\u000a{spans[i].marker.attachLine(line)}\u000aline.markedSpans=spans}\u000afunction extraLeft(marker){return marker.inclusiveLeft?-1:0}\u000afunction extraRight(marker){return marker.inclusiveRight?1:0}\u000afunction compareCollapsedMarkers(a,b){var lenDiff=a.lines.length-b.lines.length\u000aif(lenDiff!=0){return lenDiff}\u000avar aPos=a.find(),bPos=b.find()\u000avar fromCmp=cmp(aPos.from,bPos.from)||extraLeft(a)-extraLeft(b)\u000aif(fromCmp){return-fromCmp}\u000avar toCmp=cmp(aPos.to,bPos.to)||extraRight(a)-extraRight(b)\u000aif(toCmp){return toCmp}\u000areturn b.id-a.id}\u000afunction collapsedSpanAtSide(line,start){var sps=sawCollapsedSpans&&line.markedSpans,found\u000aif(sps){for(var sp=(void 0),i=0;i<sps.length;++i){sp=sps[i]\u000aif(sp.marker.collapsed&&(start?sp.from:sp.to)==null&&(!found||compareCollapsedMarkers(found,sp.marker)<0))\u000a{found=sp.marker}}}\u000areturn found}\u000afunction collapsedSpanAtStart(line){return collapsedSpanAtSide(line,true)}\u000afunction collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,false)}\u000afunction conflictingCollapsedRange(doc,lineNo,from,to,marker){var line=getLine(doc,lineNo)\u000avar sps=sawCollapsedSpans&&line.markedSpans\u000aif(sps){for(var i=0;i<sps.length;++i){var sp=sps[i]\u000aif(!sp.marker.collapsed){continue}\u000avar found=sp.marker.find(0)\u000avar fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker)\u000avar toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker)\u000aif(fromCmp>=0&&toCmp<=0||fromCmp<=0&&toCmp>=0){continue}\u000aif(fromCmp<=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.to,from)>=0:cmp(found.to,from)>0)||fromCmp>=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.from,to)<=0:cmp(found.from,to)<0))\u000a{return true}}}}\u000afunction visualLine(line){var merged\u000awhile(merged=collapsedSpanAtStart(line))\u000a{line=merged.find(-1,true).line}\u000areturn line}\u000afunction visualLineEnd(line){var merged\u000awhile(merged=collapsedSpanAtEnd(line))\u000a{line=merged.find(1,true).line}\u000areturn line}\u000afunction visualLineContinued(line){var merged,lines\u000awhile(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;(lines||(lines=[])).push(line)}\u000areturn lines}\u000afunction visualLineNo(doc,lineN){var line=getLine(doc,lineN),vis=visualLine(line)\u000aif(line==vis){return lineN}\u000areturn lineNo(vis)}\u000afunction visualLineEndNo(doc,lineN){if(lineN>doc.lastLine()){return lineN}\u000avar line=getLine(doc,lineN),merged\u000aif(!lineIsHidden(doc,line)){return lineN}\u000awhile(merged=collapsedSpanAtEnd(line))\u000a{line=merged.find(1,true).line}\u000areturn lineNo(line)+1}\u000afunction lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans\u000aif(sps){for(var sp=(void 0),i=0;i<sps.length;++i){sp=sps[i]\u000aif(!sp.marker.collapsed){continue}\u000aif(sp.from==null){return true}\u000aif(sp.marker.widgetNode){continue}\u000aif(sp.from==0&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp))\u000a{return true}}}}\u000afunction lineIsHiddenInner(doc,line,span){if(span.to==null){var end=span.marker.find(1,true)\u000areturn lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker))}\u000aif(span.marker.inclusiveRight&&span.to==line.text.length)\u000a{return true}\u000afor(var sp=(void 0),i=0;i<line.markedSpans.length;++i){sp=line.markedSpans[i]\u000aif(sp.marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(sp.to==null||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp)){return true}}}\u000afunction heightAtLine(lineObj){lineObj=visualLine(lineObj)\u000avar h=0,chunk=lineObj.parent\u000afor(var i=0;i<chunk.lines.length;++i){var line=chunk.lines[i]\u000aif(line==lineObj){break}\u000aelse{h+=line.height}}\u000afor(var p=chunk.parent;p;chunk=p,p=chunk.parent){for(var i$1=0;i$1<p.children.length;++i$1){var cur=p.children[i$1]\u000aif(cur==chunk){break}\u000aelse{h+=cur.height}}}\u000areturn h}\u000afunction lineLength(line){if(line.height==0){return 0}\u000avar len=line.text.length,merged,cur=line\u000awhile(merged=collapsedSpanAtStart(cur)){var found=merged.find(0,true)\u000acur=found.from.line\u000alen+=found.from.ch-found.to.ch}\u000acur=line\u000awhile(merged=collapsedSpanAtEnd(cur)){var found$1=merged.find(0,true)\u000alen-=cur.text.length-found$1.from.ch\u000acur=found$1.to.line\u000alen+=cur.text.length-found$1.to.ch}\u000areturn len}\u000afunction findMaxLine(cm){var d=cm.display,doc=cm.doc\u000ad.maxLine=getLine(doc,doc.first)\u000ad.maxLineLength=lineLength(d.maxLine)\u000ad.maxLineChanged=true\u000adoc.iter(function(line){var len=lineLength(line)\u000aif(len>d.maxLineLength){d.maxLineLength=len\u000ad.maxLine=line}})}\u000afunction iterateBidiSections(order,from,to,f){if(!order){return f(from,to,"ltr",0)}\u000avar found=false\u000afor(var i=0;i<order.length;++i){var part=order[i]\u000aif(part.from<to&&part.to>from||from==to&&part.to==from){f(Math.max(part.from,from),Math.min(part.to,to),part.level==1?"rtl":"ltr",i)\u000afound=true}}\u000aif(!found){f(from,to,"ltr")}}\u000avar bidiOther=null\u000afunction getBidiPartAt(order,ch,sticky){var found\u000abidiOther=null\u000afor(var i=0;i<order.length;++i){var cur=order[i]\u000aif(cur.from<ch&&cur.to>ch){return i}\u000aif(cur.to==ch){if(cur.from!=cur.to&&sticky=="before"){found=i}\u000aelse{bidiOther=i}}\u000aif(cur.from==ch){if(cur.from!=cur.to&&sticky!="before"){found=i}\u000aelse{bidiOther=i}}}\u000areturn found!=null?found:bidiOther}\u000avar bidiOrdering=(function(){var lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN"\u000avar arabicTypes="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111"\u000afunction charType(code){if(code<=0xf7){return lowTypes.charAt(code)}\u000aelse if(0x590<=code&&code<=0x5f4){return"R"}\u000aelse if(0x600<=code&&code<=0x6f9){return arabicTypes.charAt(code-0x600)}\u000aelse if(0x6ee<=code&&code<=0x8ac){return"r"}\u000aelse if(0x2000<=code&&code<=0x200b){return"w"}\u000aelse if(code==0x200c){return"b"}\u000aelse{return"L"}}\u000avar bidiRE=/[\u005cu0590-\u005cu05f4\u005cu0600-\u005cu06ff\u005cu0700-\u005cu08ac]/\u000avar isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/\u000afunction BidiSpan(level,from,to){this.level=level\u000athis.from=from;this.to=to}\u000areturn function(str,direction){var outerType=direction=="ltr"?"L":"R"\u000aif(str.length==0||direction=="ltr"&&!bidiRE.test(str)){return false}\u000avar len=str.length,types=[]\u000afor(var i=0;i<len;++i)\u000a{types.push(charType(str.charCodeAt(i)))}\u000afor(var i$1=0,prev=outerType;i$1<len;++i$1){var type=types[i$1]\u000aif(type=="m"){types[i$1]=prev}\u000aelse{prev=type}}\u000afor(var i$2=0,cur=outerType;i$2<len;++i$2){var type$1=types[i$2]\u000aif(type$1=="1"&&cur=="r"){types[i$2]="n"}\u000aelse if(isStrong.test(type$1)){cur=type$1;if(type$1=="r"){types[i$2]="R"}}}\u000afor(var i$3=1,prev$1=types[0];i$3<len-1;++i$3){var type$2=types[i$3]\u000aif(type$2=="+"&&prev$1=="1"&&types[i$3+1]=="1"){types[i$3]="1"}\u000aelse if(type$2==","&&prev$1==types[i$3+1]&&(prev$1=="1"||prev$1=="n")){types[i$3]=prev$1}\u000aprev$1=type$2}\u000afor(var i$4=0;i$4<len;++i$4){var type$3=types[i$4]\u000aif(type$3==","){types[i$4]="N"}\u000aelse if(type$3=="%"){var end=(void 0)\u000afor(end=i$4+1;end<len&&types[end]=="%";++end){}\u000avar replace=(i$4&&types[i$4-1]=="!")||(end<len&&types[end]=="1")?"1":"N"\u000afor(var j=i$4;j<end;++j){types[j]=replace}\u000ai$4=end-1}}\u000afor(var i$5=0,cur$1=outerType;i$5<len;++i$5){var type$4=types[i$5]\u000aif(cur$1=="L"&&type$4=="1"){types[i$5]="L"}\u000aelse if(isStrong.test(type$4)){cur$1=type$4}}\u000afor(var i$6=0;i$6<len;++i$6){if(isNeutral.test(types[i$6])){var end$1=(void 0)\u000afor(end$1=i$6+1;end$1<len&&isNeutral.test(types[end$1]);++end$1){}\u000avar before=(i$6?types[i$6-1]:outerType)=="L"\u000avar after=(end$1<len?types[end$1]:outerType)=="L"\u000avar replace$1=before==after?(before?"L":"R"):outerType\u000afor(var j$1=i$6;j$1<end$1;++j$1){types[j$1]=replace$1}\u000ai$6=end$1-1}}\u000avar order=[],m\u000afor(var i$7=0;i$7<len;){if(countsAsLeft.test(types[i$7])){var start=i$7\u000afor(++i$7;i$7<len&&countsAsLeft.test(types[i$7]);++i$7){}\u000aorder.push(new BidiSpan(0,start,i$7))}else{var pos=i$7,at=order.length\u000afor(++i$7;i$7<len&&types[i$7]!="L";++i$7){}\u000afor(var j$2=pos;j$2<i$7;){if(countsAsNum.test(types[j$2])){if(pos<j$2){order.splice(at,0,new BidiSpan(1,pos,j$2))}\u000avar nstart=j$2\u000afor(++j$2;j$2<i$7&&countsAsNum.test(types[j$2]);++j$2){}\u000aorder.splice(at,0,new BidiSpan(2,nstart,j$2))\u000apos=j$2}else{++j$2}}\u000aif(pos<i$7){order.splice(at,0,new BidiSpan(1,pos,i$7))}}}\u000aif(direction=="ltr"){if(order[0].level==1&&(m=str.match(/^\u005cs+/))){order[0].from=m[0].length\u000aorder.unshift(new BidiSpan(0,0,m[0].length))}\u000aif(lst(order).level==1&&(m=str.match(/\u005cs+$/))){lst(order).to-=m[0].length\u000aorder.push(new BidiSpan(0,len-m[0].length,len))}}\u000areturn direction=="rtl"?order.reverse():order}})()\u000afunction getOrder(line,direction){var order=line.order\u000aif(order==null){order=line.order=bidiOrdering(line.text,direction)}\u000areturn order}\u000avar noHandlers=[]\u000avar on=function(emitter,type,f){if(emitter.addEventListener){emitter.addEventListener(type,f,false)}else if(emitter.attachEvent){emitter.attachEvent("on"+type,f)}else{var map=emitter._handlers||(emitter._handlers={})\u000amap[type]=(map[type]||noHandlers).concat(f)}}\u000afunction getHandlers(emitter,type){return emitter._handlers&&emitter._handlers[type]||noHandlers}\u000afunction off(emitter,type,f){if(emitter.removeEventListener){emitter.removeEventListener(type,f,false)}else if(emitter.detachEvent){emitter.detachEvent("on"+type,f)}else{var map=emitter._handlers,arr=map&&map[type]\u000aif(arr){var index=indexOf(arr,f)\u000aif(index>-1)\u000a{map[type]=arr.slice(0,index).concat(arr.slice(index+1))}}}}\u000afunction signal(emitter,type ){var handlers=getHandlers(emitter,type)\u000aif(!handlers.length){return}\u000avar args=Array.prototype.slice.call(arguments,2)\u000afor(var i=0;i<handlers.length;++i){handlers[i].apply(null,args)}}\u000afunction signalDOMEvent(cm,e,override){if(typeof e=="string")\u000a{e={type:e,preventDefault:function(){this.defaultPrevented=true}}}\u000asignal(cm,override||e.type,cm,e)\u000areturn e_defaultPrevented(e)||e.codemirrorIgnore}\u000afunction signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity\u000aif(!arr){return}\u000avar set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[])\u000afor(var i=0;i<arr.length;++i){if(indexOf(set,arr[i])==-1)\u000a{set.push(arr[i])}}}\u000afunction hasHandler(emitter,type){return getHandlers(emitter,type).length>0}\u000afunction eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f)}\u000actor.prototype.off=function(type,f){off(this,type,f)}}\u000afunction e_preventDefault(e){if(e.preventDefault){e.preventDefault()}\u000aelse{e.returnValue=false}}\u000afunction e_stopPropagation(e){if(e.stopPropagation){e.stopPropagation()}\u000aelse{e.cancelBubble=true}}\u000afunction e_defaultPrevented(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false}\u000afunction e_stop(e){e_preventDefault(e);e_stopPropagation(e)}\u000afunction e_target(e){return e.target||e.srcElement}\u000afunction e_button(e){var b=e.which\u000aif(b==null){if(e.button&1){b=1}\u000aelse if(e.button&2){b=3}\u000aelse if(e.button&4){b=2}}\u000aif(mac&&e.ctrlKey&&b==1){b=3}\u000areturn b}\u000avar dragAndDrop=function(){if(ie&&ie_version<9){return false}\u000avar div=elt('div')\u000areturn"draggable"in div||"dragDrop"in div}()\u000avar zwspSupported\u000afunction zeroWidthElement(measure){if(zwspSupported==null){var test=elt("span","\u005cu200b")\u000aremoveChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")]))\u000aif(measure.firstChild.offsetHeight!=0)\u000a{zwspSupported=test.offsetWidth<=1&&test.offsetHeight>2&&!(ie&&ie_version<8)}}\u000avar node=zwspSupported?elt("span","\u005cu200b"):elt("span","\u005cu00a0",null,"display: inline-block; width: 1px; margin-right: -1px")\u000anode.setAttribute("cm-text","")\u000areturn node}\u000avar badBidiRects\u000afunction hasBadBidiRects(measure){if(badBidiRects!=null){return badBidiRects}\u000avar txt=removeChildrenAndAdd(measure,document.createTextNode("A\u005cu062eA"))\u000avar r0=range(txt,0,1).getBoundingClientRect()\u000avar r1=range(txt,1,2).getBoundingClientRect()\u000aremoveChildren(measure)\u000aif(!r0||r0.left==r0.right){return false}\u000areturn badBidiRects=(r1.right-r0.right<3)}\u000avar splitLinesAuto="\u005cn\u005cnb".split(/\u005cn/).length!=3?function(string){var pos=0,result=[],l=string.length\u000awhile(pos<=l){var nl=string.indexOf("\u005cn",pos)\u000aif(nl==-1){nl=string.length}\u000avar line=string.slice(pos,string.charAt(nl-1)=="\u005cr"?nl-1:nl)\u000avar rt=line.indexOf("\u005cr")\u000aif(rt!=-1){result.push(line.slice(0,rt))\u000apos+=rt+1}else{result.push(line)\u000apos=nl+1}}\u000areturn result}:function(string){return string.split(/\u005cr\u005cn?|\u005cn/);}\u000avar hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}\u000acatch(e){return false}}:function(te){var range\u000atry{range=te.ownerDocument.selection.createRange()}\u000acatch(e){}\u000aif(!range||range.parentElement()!=te){return false}\u000areturn range.compareEndPoints("StartToEnd",range)!=0}\u000avar hasCopyEvent=(function(){var e=elt("div")\u000aif("oncopy"in e){return true}\u000ae.setAttribute("oncopy","return;")\u000areturn typeof e.oncopy=="function"})()\u000avar badZoomedRects=null\u000afunction hasBadZoomedRects(measure){if(badZoomedRects!=null){return badZoomedRects}\u000avar node=removeChildrenAndAdd(measure,elt("span","x"))\u000avar normal=node.getBoundingClientRect()\u000avar fromRange=range(node,0,1).getBoundingClientRect()\u000areturn badZoomedRects=Math.abs(normal.left-fromRange.left)>1}\u000avar modes={};var mimeModes={};function defineMode(name,mode){if(arguments.length>2)\u000a{mode.dependencies=Array.prototype.slice.call(arguments,2)}\u000amodes[name]=mode}\u000afunction defineMIME(mime,spec){mimeModes[mime]=spec}\u000afunction resolveMode(spec){if(typeof spec=="string"&&mimeModes.hasOwnProperty(spec)){spec=mimeModes[spec]}else if(spec&&typeof spec.name=="string"&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name]\u000aif(typeof found=="string"){found={name:found}}\u000aspec=createObj(found,spec)\u000aspec.name=found.name}else if(typeof spec=="string"&&/^[\u005cw\u005c-]+\u005c/[\u005cw\u005c-]+\u005c+xml$/.test(spec)){return resolveMode("application/xml")}else if(typeof spec=="string"&&/^[\u005cw\u005c-]+\u005c/[\u005cw\u005c-]+\u005c+json$/.test(spec)){return resolveMode("application/json")}\u000aif(typeof spec=="string"){return{name:spec}}\u000aelse{return spec||{name:"null"}}}\u000afunction getMode(options,spec){spec=resolveMode(spec)\u000avar mfactory=modes[spec.name]\u000aif(!mfactory){return getMode(options,"text/plain")}\u000avar modeObj=mfactory(options,spec)\u000aif(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name]\u000afor(var prop in exts){if(!exts.hasOwnProperty(prop)){continue}\u000aif(modeObj.hasOwnProperty(prop)){modeObj["_"+prop]=modeObj[prop]}\u000amodeObj[prop]=exts[prop]}}\u000amodeObj.name=spec.name\u000aif(spec.helperType){modeObj.helperType=spec.helperType}\u000aif(spec.modeProps){for(var prop$1 in spec.modeProps)\u000a{modeObj[prop$1]=spec.modeProps[prop$1]}}\u000areturn modeObj}\u000avar modeExtensions={}\u000afunction extendMode(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:(modeExtensions[mode]={})\u000acopyObj(properties,exts)}\u000afunction copyState(mode,state){if(state===true){return state}\u000aif(mode.copyState){return mode.copyState(state)}\u000avar nstate={}\u000afor(var n in state){var val=state[n]\u000aif(val instanceof Array){val=val.concat([])}\u000anstate[n]=val}\u000areturn nstate}\u000afunction innerMode(mode,state){var info\u000awhile(mode.innerMode){info=mode.innerMode(state)\u000aif(!info||info.mode==mode){break}\u000astate=info.state\u000amode=info.mode}\u000areturn info||{mode:mode,state:state}}\u000afunction startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):true}\u000avar StringStream=function(string,tabSize,lineOracle){this.pos=this.start=0\u000athis.string=string\u000athis.tabSize=tabSize||8\u000athis.lastColumnPos=this.lastColumnValue=0\u000athis.lineStart=0\u000athis.lineOracle=lineOracle};StringStream.prototype.eol=function(){return this.pos>=this.string.length};StringStream.prototype.sol=function(){return this.pos==this.lineStart};StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};StringStream.prototype.next=function(){if(this.pos<this.string.length)\u000a{return this.string.charAt(this.pos++)}};StringStream.prototype.eat=function(match){var ch=this.string.charAt(this.pos)\u000avar ok\u000aif(typeof match=="string"){ok=ch==match}\u000aelse{ok=ch&&(match.test?match.test(ch):match(ch))}\u000aif(ok){++this.pos;return ch}};StringStream.prototype.eatWhile=function(match){var start=this.pos\u000awhile(this.eat(match)){}\u000areturn this.pos>start};StringStream.prototype.eatSpace=function(){var this$1=this;var start=this.pos\u000awhile(/[\u005cs\u005cu00a0]/.test(this.string.charAt(this.pos))){++this$1.pos}\u000areturn this.pos>start};StringStream.prototype.skipToEnd=function(){this.pos=this.string.length};StringStream.prototype.skipTo=function(ch){var found=this.string.indexOf(ch,this.pos)\u000aif(found>-1){this.pos=found;return true}};StringStream.prototype.backUp=function(n){this.pos-=n};StringStream.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue)\u000athis.lastColumnPos=this.start}\u000areturn this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-\u000a(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.match=function(pattern,consume,caseInsensitive){if(typeof pattern=="string"){var cased=function(str){return caseInsensitive?str.toLowerCase():str;}\u000avar substr=this.string.substr(this.pos,pattern.length)\u000aif(cased(substr)==cased(pattern)){if(consume!==false){this.pos+=pattern.length}\u000areturn true}}else{var match=this.string.slice(this.pos).match(pattern)\u000aif(match&&match.index>0){return null}\u000aif(match&&consume!==false){this.pos+=match[0].length}\u000areturn match}};StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)};StringStream.prototype.hideFirstChars=function(n,inner){this.lineStart+=n\u000atry{return inner()}\u000afinally{this.lineStart-=n}};StringStream.prototype.lookAhead=function(n){var oracle=this.lineOracle\u000areturn oracle&&oracle.lookAhead(n)};StringStream.prototype.baseToken=function(){var oracle=this.lineOracle\u000areturn oracle&&oracle.baseToken(this.pos)};var SavedContext=function(state,lookAhead){this.state=state\u000athis.lookAhead=lookAhead};var Context=function(doc,state,line,lookAhead){this.state=state\u000athis.doc=doc\u000athis.line=line\u000athis.maxLookAhead=lookAhead||0\u000athis.baseTokens=null\u000athis.baseTokenPos=1};Context.prototype.lookAhead=function(n){var line=this.doc.getLine(this.line+n)\u000aif(line!=null&&n>this.maxLookAhead){this.maxLookAhead=n}\u000areturn line};Context.prototype.baseToken=function(n){var this$1=this;if(!this.baseTokens){return null}\u000awhile(this.baseTokens[this.baseTokenPos]<=n)\u000a{this$1.baseTokenPos+=2}\u000avar type=this.baseTokens[this.baseTokenPos+1]\u000areturn{type:type&&type.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}};Context.prototype.nextLine=function(){this.line++\u000aif(this.maxLookAhead>0){this.maxLookAhead--}};Context.fromSaved=function(doc,saved,line){if(saved instanceof SavedContext)\u000a{return new Context(doc,copyState(doc.mode,saved.state),line,saved.lookAhead)}\u000aelse\u000a{return new Context(doc,copyState(doc.mode,saved),line)}};Context.prototype.save=function(copy){var state=copy!==false?copyState(this.doc.mode,this.state):this.state\u000areturn this.maxLookAhead>0?new SavedContext(state,this.maxLookAhead):state};function highlightLine(cm,line,context,forceToEnd){var st=[cm.state.modeGen],lineClasses={}\u000arunMode(cm,line.text,cm.doc.mode,context,function(end,style){return st.push(end,style);},lineClasses,forceToEnd)\u000avar state=context.state\u000avar loop=function(o){context.baseTokens=st\u000avar overlay=cm.state.overlays[o],i=1,at=0\u000acontext.state=true\u000arunMode(cm,line.text,overlay.mode,context,function(end,style){var start=i\u000awhile(at<end){var i_end=st[i]\u000aif(i_end>end)\u000a{st.splice(i,1,end,st[i+1],i_end)}\u000ai+=2\u000aat=Math.min(end,i_end)}\u000aif(!style){return}\u000aif(overlay.opaque){st.splice(start,i-start,end,"overlay "+style)\u000ai=start+2}else{for(;start<i;start+=2){var cur=st[start+1]\u000ast[start+1]=(cur?cur+" ":"")+"overlay "+style}}},lineClasses)\u000acontext.state=state\u000acontext.baseTokens=null\u000acontext.baseTokenPos=1};for(var o=0;o<cm.state.overlays.length;++o)loop(o);return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null}}\u000afunction getLineStyles(cm,line,updateFrontier){if(!line.styles||line.styles[0]!=cm.state.modeGen){var context=getContextBefore(cm,lineNo(line))\u000avar resetState=line.text.length>cm.options.maxHighlightLength&&copyState(cm.doc.mode,context.state)\u000avar result=highlightLine(cm,line,context)\u000aif(resetState){context.state=resetState}\u000aline.stateAfter=context.save(!resetState)\u000aline.styles=result.styles\u000aif(result.classes){line.styleClasses=result.classes}\u000aelse if(line.styleClasses){line.styleClasses=null}\u000aif(updateFrontier===cm.doc.highlightFrontier)\u000a{cm.doc.modeFrontier=Math.max(cm.doc.modeFrontier,++cm.doc.highlightFrontier)}}\u000areturn line.styles}\u000afunction getContextBefore(cm,n,precise){var doc=cm.doc,display=cm.display\u000aif(!doc.mode.startState){return new Context(doc,true,n)}\u000avar start=findStartLine(cm,n,precise)\u000avar saved=start>doc.first&&getLine(doc,start-1).stateAfter\u000avar context=saved?Context.fromSaved(doc,saved,start):new Context(doc,startState(doc.mode),start)\u000adoc.iter(start,n,function(line){processLine(cm,line.text,context)\u000avar pos=context.line\u000aline.stateAfter=pos==n-1||pos%5==0||pos>=display.viewFrom&&pos<display.viewTo?context.save():null\u000acontext.nextLine()})\u000aif(precise){doc.modeFrontier=context.line}\u000areturn context}\u000afunction processLine(cm,text,context,startAt){var mode=cm.doc.mode\u000avar stream=new StringStream(text,cm.options.tabSize,context)\u000astream.start=stream.pos=startAt||0\u000aif(text==""){callBlankLine(mode,context.state)}\u000awhile(!stream.eol()){readToken(mode,stream,context.state)\u000astream.start=stream.pos}}\u000afunction callBlankLine(mode,state){if(mode.blankLine){return mode.blankLine(state)}\u000aif(!mode.innerMode){return}\u000avar inner=innerMode(mode,state)\u000aif(inner.mode.blankLine){return inner.mode.blankLine(inner.state)}}\u000afunction readToken(mode,stream,state,inner){for(var i=0;i<10;i++){if(inner){inner[0]=innerMode(mode,state).mode}\u000avar style=mode.token(stream,state)\u000aif(stream.pos>stream.start){return style}}\u000athrow new Error("Mode "+mode.name+" failed to advance stream.")}\u000avar Token=function(stream,type,state){this.start=stream.start;this.end=stream.pos\u000athis.string=stream.current()\u000athis.type=type||null\u000athis.state=state};function takeToken(cm,pos,precise,asArray){var doc=cm.doc,mode=doc.mode,style\u000apos=clipPos(doc,pos)\u000avar line=getLine(doc,pos.line),context=getContextBefore(cm,pos.line,precise)\u000avar stream=new StringStream(line.text,cm.options.tabSize,context),tokens\u000aif(asArray){tokens=[]}\u000awhile((asArray||stream.pos<pos.ch)&&!stream.eol()){stream.start=stream.pos\u000astyle=readToken(mode,stream,context.state)\u000aif(asArray){tokens.push(new Token(stream,style,copyState(doc.mode,context.state)))}}\u000areturn asArray?tokens:new Token(stream,style,context.state)}\u000afunction extractLineClasses(type,output){if(type){for(;;){var lineClass=type.match(/(?:^|\u005cs+)line-(background-)?(\u005cS+)/)\u000aif(!lineClass){break}\u000atype=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length)\u000avar prop=lineClass[1]?"bgClass":"textClass"\u000aif(output[prop]==null)\u000a{output[prop]=lineClass[2]}\u000aelse if(!(new RegExp("(?:^|\u005cs)"+lineClass[2]+"(?:$|\u005cs)")).test(output[prop]))\u000a{output[prop]+=" "+lineClass[2]}}}\u000areturn type}\u000afunction runMode(cm,text,mode,context,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans\u000aif(flattenSpans==null){flattenSpans=cm.options.flattenSpans}\u000avar curStart=0,curStyle=null\u000avar stream=new StringStream(text,cm.options.tabSize,context),style\u000avar inner=cm.options.addModeClass&&[null]\u000aif(text==""){extractLineClasses(callBlankLine(mode,context.state),lineClasses)}\u000awhile(!stream.eol()){if(stream.pos>cm.options.maxHighlightLength){flattenSpans=false\u000aif(forceToEnd){processLine(cm,text,context,stream.pos)}\u000astream.pos=text.length\u000astyle=null}else{style=extractLineClasses(readToken(mode,stream,context.state,inner),lineClasses)}\u000aif(inner){var mName=inner[0].name\u000aif(mName){style="m-"+(style?mName+" "+style:mName)}}\u000aif(!flattenSpans||curStyle!=style){while(curStart<stream.start){curStart=Math.min(stream.start,curStart+5000)\u000af(curStart,curStyle)}\u000acurStyle=style}\u000astream.start=stream.pos}\u000awhile(curStart<stream.pos){var pos=Math.min(stream.pos,curStart+5000)\u000af(pos,curStyle)\u000acurStart=pos}}\u000afunction findStartLine(cm,n,precise){var minindent,minline,doc=cm.doc\u000avar lim=precise?-1:n-(cm.doc.mode.innerMode?1000:100)\u000afor(var search=n;search>lim;--search){if(search<=doc.first){return doc.first}\u000avar line=getLine(doc,search-1),after=line.stateAfter\u000aif(after&&(!precise||search+(after instanceof SavedContext?after.lookAhead:0)<=doc.modeFrontier))\u000a{return search}\u000avar indented=countColumn(line.text,null,cm.options.tabSize)\u000aif(minline==null||minindent>indented){minline=search-1\u000aminindent=indented}}\u000areturn minline}\u000afunction retreatFrontier(doc,n){doc.modeFrontier=Math.min(doc.modeFrontier,n)\u000aif(doc.highlightFrontier<n-10){return}\u000avar start=doc.first\u000afor(var line=n-1;line>start;line--){var saved=getLine(doc,line).stateAfter\u000aif(saved&&(!(saved instanceof SavedContext)||line+saved.lookAhead<n)){start=line+1\u000abreak}}\u000adoc.highlightFrontier=Math.min(doc.highlightFrontier,start)}\u000avar Line=function(text,markedSpans,estimateHeight){this.text=text\u000aattachMarkedSpans(this,markedSpans)\u000athis.height=estimateHeight?estimateHeight(this):1};Line.prototype.lineNo=function(){return lineNo(this)};eventMixin(Line)\u000afunction updateLine(line,text,markedSpans,estimateHeight){line.text=text\u000aif(line.stateAfter){line.stateAfter=null}\u000aif(line.styles){line.styles=null}\u000aif(line.order!=null){line.order=null}\u000adetachMarkedSpans(line)\u000aattachMarkedSpans(line,markedSpans)\u000avar estHeight=estimateHeight?estimateHeight(line):1\u000aif(estHeight!=line.height){updateLineHeight(line,estHeight)}}\u000afunction cleanUpLine(line){line.parent=null\u000adetachMarkedSpans(line)}\u000avar styleToClassCache={};var styleToClassCacheWithMode={};function interpretTokenStyle(style,options){if(!style||/^\u005cs*$/.test(style)){return null}\u000avar cache=options.addModeClass?styleToClassCacheWithMode:styleToClassCache\u000areturn cache[style]||(cache[style]=style.replace(/\u005cS+/g,"cm-$&"))}\u000afunction buildLineContent(cm,lineView){var content=eltP("span",null,null,webkit?"padding-right: .1px":null)\u000avar builder={pre:eltP("pre",[content],"CodeMirror-line"),content:content,col:0,pos:0,cm:cm,trailingSpace:false,splitSpaces:(ie||webkit)&&cm.getOption("lineWrapping")}\u000alineView.measure={}\u000afor(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order=(void 0)\u000abuilder.pos=0\u000abuilder.addToken=buildToken\u000aif(hasBadBidiRects(cm.display.measure)&&(order=getOrder(line,cm.doc.direction)))\u000a{builder.addToken=buildTokenBadBidi(builder.addToken,order)}\u000abuilder.map=[]\u000avar allowFrontierUpdate=lineView!=cm.display.externalMeasured&&lineNo(line)\u000ainsertLineContent(line,builder,getLineStyles(cm,line,allowFrontierUpdate))\u000aif(line.styleClasses){if(line.styleClasses.bgClass)\u000a{builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"")}\u000aif(line.styleClasses.textClass)\u000a{builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||"")}}\u000aif(builder.map.length==0)\u000a{builder.map.push(0,0,builder.content.appendChild(zeroWidthElement(cm.display.measure)))}\u000aif(i==0){lineView.measure.map=builder.map\u000alineView.measure.cache={}}else{;(lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map);(lineView.measure.caches||(lineView.measure.caches=[])).push({})}}\u000aif(webkit){var last=builder.content.lastChild\u000aif(/\u005cbcm-tab\u005cb/.test(last.className)||(last.querySelector&&last.querySelector(".cm-tab")))\u000a{builder.content.className="cm-tab-wrap-hack"}}\u000asignal(cm,"renderLine",cm,lineView.line,builder.pre)\u000aif(builder.pre.className)\u000a{builder.textClass=joinClasses(builder.pre.className,builder.textClass||"")}\u000areturn builder}\u000afunction defaultSpecialCharPlaceholder(ch){var token=elt("span","\u005cu2022","cm-invalidchar")\u000atoken.title="\u005c\u005cu"+ch.charCodeAt(0).toString(16)\u000atoken.setAttribute("aria-label",token.title)\u000areturn token}\u000afunction buildToken(builder,text,style,startStyle,endStyle,title,css){if(!text){return}\u000avar displayText=builder.splitSpaces?splitSpaces(text,builder.trailingSpace):text\u000avar special=builder.cm.state.specialChars,mustWrap=false\u000avar content\u000aif(!special.test(text)){builder.col+=text.length\u000acontent=document.createTextNode(displayText)\u000abuilder.map.push(builder.pos,builder.pos+text.length,content)\u000aif(ie&&ie_version<9){mustWrap=true}\u000abuilder.pos+=text.length}else{content=document.createDocumentFragment()\u000avar pos=0\u000awhile(true){special.lastIndex=pos\u000avar m=special.exec(text)\u000avar skipped=m?m.index-pos:text.length-pos\u000aif(skipped){var txt=document.createTextNode(displayText.slice(pos,pos+skipped))\u000aif(ie&&ie_version<9){content.appendChild(elt("span",[txt]))}\u000aelse{content.appendChild(txt)}\u000abuilder.map.push(builder.pos,builder.pos+skipped,txt)\u000abuilder.col+=skipped\u000abuilder.pos+=skipped}\u000aif(!m){break}\u000apos+=skipped+1\u000avar txt$1=(void 0)\u000aif(m[0]=="\u005ct"){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize\u000atxt$1=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab"))\u000atxt$1.setAttribute("role","presentation")\u000atxt$1.setAttribute("cm-text","\u005ct")\u000abuilder.col+=tabWidth}else if(m[0]=="\u005cr"||m[0]=="\u005cn"){txt$1=content.appendChild(elt("span",m[0]=="\u005cr"?"\u005cu240d":"\u005cu2424","cm-invalidchar"))\u000atxt$1.setAttribute("cm-text",m[0])\u000abuilder.col+=1}else{txt$1=builder.cm.options.specialCharPlaceholder(m[0])\u000atxt$1.setAttribute("cm-text",m[0])\u000aif(ie&&ie_version<9){content.appendChild(elt("span",[txt$1]))}\u000aelse{content.appendChild(txt$1)}\u000abuilder.col+=1}\u000abuilder.map.push(builder.pos,builder.pos+1,txt$1)\u000abuilder.pos++}}\u000abuilder.trailingSpace=displayText.charCodeAt(text.length-1)==32\u000aif(style||startStyle||endStyle||mustWrap||css){var fullStyle=style||""\u000aif(startStyle){fullStyle+=startStyle}\u000aif(endStyle){fullStyle+=endStyle}\u000avar token=elt("span",[content],fullStyle,css)\u000aif(title){token.title=title}\u000areturn builder.content.appendChild(token)}\u000abuilder.content.appendChild(content)}\u000afunction splitSpaces(text,trailingBefore){if(text.length>1&&!/  /.test(text)){return text}\u000avar spaceBefore=trailingBefore,result=""\u000afor(var i=0;i<text.length;i++){var ch=text.charAt(i)\u000aif(ch==" "&&spaceBefore&&(i==text.length-1||text.charCodeAt(i+1)==32))\u000a{ch="\u005cu00a0"}\u000aresult+=ch\u000aspaceBefore=ch==" "}\u000areturn result}\u000afunction buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,title,css){style=style?style+" cm-force-border":"cm-force-border"\u000avar start=builder.pos,end=start+text.length\u000afor(;;){var part=(void 0)\u000afor(var i=0;i<order.length;i++){part=order[i]\u000aif(part.to>start&&part.from<=start){break}}\u000aif(part.to>=end){return inner(builder,text,style,startStyle,endStyle,title,css)}\u000ainner(builder,text.slice(0,part.to-start),style,startStyle,null,title,css)\u000astartStyle=null\u000atext=text.slice(part.to-start)\u000astart=part.to}}}\u000afunction buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode\u000aif(widget){builder.map.push(builder.pos,builder.pos+size,widget)}\u000aif(!ignoreWidget&&builder.cm.display.input.needsContentAttribute){if(!widget)\u000a{widget=builder.content.appendChild(document.createElement("span"))}\u000awidget.setAttribute("cm-marker",marker.id)}\u000aif(widget){builder.cm.display.input.setUneditable(widget)\u000abuilder.content.appendChild(widget)}\u000abuilder.pos+=size\u000abuilder.trailingSpace=false}\u000afunction insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0\u000aif(!spans){for(var i$1=1;i$1<styles.length;i$1+=2)\u000a{builder.addToken(builder,allText.slice(at,at=styles[i$1]),interpretTokenStyle(styles[i$1+1],builder.cm.options))}\u000areturn}\u000avar len=allText.length,pos=0,i=1,text="",style,css\u000avar nextChange=0,spanStyle,spanEndStyle,spanStartStyle,title,collapsed\u000afor(;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=title=css=""\u000acollapsed=null;nextChange=Infinity\u000avar foundBookmarks=[],endStyles=(void 0)\u000afor(var j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker\u000aif(m.type=="bookmark"&&sp.from==pos&&m.widgetNode){foundBookmarks.push(m)}else if(sp.from<=pos&&(sp.to==null||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(sp.to!=null&&sp.to!=pos&&nextChange>sp.to){nextChange=sp.to\u000aspanEndStyle=""}\u000aif(m.className){spanStyle+=" "+m.className}\u000aif(m.css){css=(css?css+";":"")+m.css}\u000aif(m.startStyle&&sp.from==pos){spanStartStyle+=" "+m.startStyle}\u000aif(m.endStyle&&sp.to==nextChange){(endStyles||(endStyles=[])).push(m.endStyle,sp.to)}\u000aif(m.title&&!title){title=m.title}\u000aif(m.collapsed&&(!collapsed||compareCollapsedMarkers(collapsed.marker,m)<0))\u000a{collapsed=sp}}else if(sp.from>pos&&nextChange>sp.from){nextChange=sp.from}}\u000aif(endStyles){for(var j$1=0;j$1<endStyles.length;j$1+=2)\u000a{if(endStyles[j$1+1]==nextChange){spanEndStyle+=" "+endStyles[j$1]}}}\u000aif(!collapsed||collapsed.from==pos){for(var j$2=0;j$2<foundBookmarks.length;++j$2)\u000a{buildCollapsedSpan(builder,0,foundBookmarks[j$2])}}\u000aif(collapsed&&(collapsed.from||0)==pos){buildCollapsedSpan(builder,(collapsed.to==null?len+1:collapsed.to)-pos,collapsed.marker,collapsed.from==null)\u000aif(collapsed.to==null){return}\u000aif(collapsed.to==pos){collapsed=false}}}\u000aif(pos>=len){break}\u000avar upto=Math.min(len,nextChange)\u000awhile(true){if(text){var end=pos+text.length\u000aif(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text\u000abuilder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",title,css)}\u000aif(end>=upto){text=text.slice(upto-pos);pos=upto;break}\u000apos=end\u000aspanStartStyle=""}\u000atext=allText.slice(at,at=styles[i++])\u000astyle=interpretTokenStyle(styles[i++],builder.cm.options)}}}\u000afunction LineView(doc,line,lineN){this.line=line\u000athis.rest=visualLineContinued(line)\u000athis.size=this.rest?lineNo(lst(this.rest))-lineN+1:1\u000athis.node=this.text=null\u000athis.hidden=lineIsHidden(doc,line)}\u000afunction buildViewArray(cm,from,to){var array=[],nextPos\u000afor(var pos=from;pos<to;pos=nextPos){var view=new LineView(cm.doc,getLine(cm.doc,pos),pos)\u000anextPos=pos+view.size\u000aarray.push(view)}\u000areturn array}\u000avar operationGroup=null\u000afunction pushOperation(op){if(operationGroup){operationGroup.ops.push(op)}else{op.ownsGroup=operationGroup={ops:[op],delayedCallbacks:[]}}}\u000afunction fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0\u000ado{for(;i<callbacks.length;i++)\u000a{callbacks[i].call(null)}\u000afor(var j=0;j<group.ops.length;j++){var op=group.ops[j]\u000aif(op.cursorActivityHandlers)\u000a{while(op.cursorActivityCalled<op.cursorActivityHandlers.length)\u000a{op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm)}}}}while(i<callbacks.length)}\u000afunction finishOperation(op,endCb){var group=op.ownsGroup\u000aif(!group){return}\u000atry{fireCallbacksForOps(group)}\u000afinally{operationGroup=null\u000aendCb(group)}}\u000avar orphanDelayedCallbacks=null\u000afunction signalLater(emitter,type ){var arr=getHandlers(emitter,type)\u000aif(!arr.length){return}\u000avar args=Array.prototype.slice.call(arguments,2),list\u000aif(operationGroup){list=operationGroup.delayedCallbacks}else if(orphanDelayedCallbacks){list=orphanDelayedCallbacks}else{list=orphanDelayedCallbacks=[]\u000asetTimeout(fireOrphanDelayed,0)}\u000avar loop=function(i){list.push(function(){return arr[i].apply(null,args);})};for(var i=0;i<arr.length;++i)\u000aloop(i);}\u000afunction fireOrphanDelayed(){var delayed=orphanDelayedCallbacks\u000aorphanDelayedCallbacks=null\u000afor(var i=0;i<delayed.length;++i){delayed[i]()}}\u000afunction updateLineForChanges(cm,lineView,lineN,dims){for(var j=0;j<lineView.changes.length;j++){var type=lineView.changes[j]\u000aif(type=="text"){updateLineText(cm,lineView)}\u000aelse if(type=="gutter"){updateLineGutter(cm,lineView,lineN,dims)}\u000aelse if(type=="class"){updateLineClasses(cm,lineView)}\u000aelse if(type=="widget"){updateLineWidgets(cm,lineView,dims)}}\u000alineView.changes=null}\u000afunction ensureLineWrapped(lineView){if(lineView.node==lineView.text){lineView.node=elt("div",null,null,"position: relative")\u000aif(lineView.text.parentNode)\u000a{lineView.text.parentNode.replaceChild(lineView.node,lineView.text)}\u000alineView.node.appendChild(lineView.text)\u000aif(ie&&ie_version<8){lineView.node.style.zIndex=2}}\u000areturn lineView.node}\u000afunction updateLineBackground(cm,lineView){var cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass\u000aif(cls){cls+=" CodeMirror-linebackground"}\u000aif(lineView.background){if(cls){lineView.background.className=cls}\u000aelse{lineView.background.parentNode.removeChild(lineView.background);lineView.background=null}}else if(cls){var wrap=ensureLineWrapped(lineView)\u000alineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild)\u000acm.display.input.setUneditable(lineView.background)}}\u000afunction getLineContent(cm,lineView){var ext=cm.display.externalMeasured\u000aif(ext&&ext.line==lineView.line){cm.display.externalMeasured=null\u000alineView.measure=ext.measure\u000areturn ext.built}\u000areturn buildLineContent(cm,lineView)}\u000afunction updateLineText(cm,lineView){var cls=lineView.text.className\u000avar built=getLineContent(cm,lineView)\u000aif(lineView.text==lineView.node){lineView.node=built.pre}\u000alineView.text.parentNode.replaceChild(built.pre,lineView.text)\u000alineView.text=built.pre\u000aif(built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass){lineView.bgClass=built.bgClass\u000alineView.textClass=built.textClass\u000aupdateLineClasses(cm,lineView)}else if(cls){lineView.text.className=cls}}\u000afunction updateLineClasses(cm,lineView){updateLineBackground(cm,lineView)\u000aif(lineView.line.wrapClass)\u000a{ensureLineWrapped(lineView).className=lineView.line.wrapClass}\u000aelse if(lineView.node!=lineView.text)\u000a{lineView.node.className=""}\u000avar textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass\u000alineView.text.className=textClass||""}\u000afunction updateLineGutter(cm,lineView,lineN,dims){if(lineView.gutter){lineView.node.removeChild(lineView.gutter)\u000alineView.gutter=null}\u000aif(lineView.gutterBackground){lineView.node.removeChild(lineView.gutterBackground)\u000alineView.gutterBackground=null}\u000aif(lineView.line.gutterClass){var wrap=ensureLineWrapped(lineView)\u000alineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,("left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+(dims.gutterTotalWidth)+"px"))\u000acm.display.input.setUneditable(lineView.gutterBackground)\u000awrap.insertBefore(lineView.gutterBackground,lineView.text)}\u000avar markers=lineView.line.gutterMarkers\u000aif(cm.options.lineNumbers||markers){var wrap$1=ensureLineWrapped(lineView)\u000avar gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper",("left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px"))\u000acm.display.input.setUneditable(gutterWrap)\u000awrap$1.insertBefore(gutterWrap,lineView.text)\u000aif(lineView.line.gutterClass)\u000a{gutterWrap.className+=" "+lineView.line.gutterClass}\u000aif(cm.options.lineNumbers&&(!markers||!markers["CodeMirror-linenumbers"]))\u000a{lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt",("left: "+(dims.gutterLeft["CodeMirror-linenumbers"])+"px; width: "+(cm.display.lineNumInnerWidth)+"px")))}\u000aif(markers){for(var k=0;k<cm.options.gutters.length;++k){var id=cm.options.gutters[k],found=markers.hasOwnProperty(id)&&markers[id]\u000aif(found)\u000a{gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt",("left: "+(dims.gutterLeft[id])+"px; width: "+(dims.gutterWidth[id])+"px")))}}}}}\u000afunction updateLineWidgets(cm,lineView,dims){if(lineView.alignable){lineView.alignable=null}\u000afor(var node=lineView.node.firstChild,next=(void 0);node;node=next){next=node.nextSibling\u000aif(node.className=="CodeMirror-linewidget")\u000a{lineView.node.removeChild(node)}}\u000ainsertLineWidgets(cm,lineView,dims)}\u000afunction buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView)\u000alineView.text=lineView.node=built.pre\u000aif(built.bgClass){lineView.bgClass=built.bgClass}\u000aif(built.textClass){lineView.textClass=built.textClass}\u000aupdateLineClasses(cm,lineView)\u000aupdateLineGutter(cm,lineView,lineN,dims)\u000ainsertLineWidgets(cm,lineView,dims)\u000areturn lineView.node}\u000afunction insertLineWidgets(cm,lineView,dims){insertLineWidgetsFor(cm,lineView.line,lineView,dims,true)\u000aif(lineView.rest){for(var i=0;i<lineView.rest.length;i++)\u000a{insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,false)}}}\u000afunction insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(!line.widgets){return}\u000avar wrap=ensureLineWrapped(lineView)\u000afor(var i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget")\u000aif(!widget.handleMouseEvents){node.setAttribute("cm-ignore-events","true")}\u000apositionLineWidget(widget,node,lineView,dims)\u000acm.display.input.setUneditable(node)\u000aif(allowAbove&&widget.above)\u000a{wrap.insertBefore(node,lineView.gutter||lineView.text)}\u000aelse\u000a{wrap.appendChild(node)}\u000asignalLater(widget,"redraw")}}\u000afunction positionLineWidget(widget,node,lineView,dims){if(widget.noHScroll){;(lineView.alignable||(lineView.alignable=[])).push(node)\u000avar width=dims.wrapperWidth\u000anode.style.left=dims.fixedPos+"px"\u000aif(!widget.coverGutter){width-=dims.gutterTotalWidth\u000anode.style.paddingLeft=dims.gutterTotalWidth+"px"}\u000anode.style.width=width+"px"}\u000aif(widget.coverGutter){node.style.zIndex=5\u000anode.style.position="relative"\u000aif(!widget.noHScroll){node.style.marginLeft=-dims.gutterTotalWidth+"px"}}}\u000afunction widgetHeight(widget){if(widget.height!=null){return widget.height}\u000avar cm=widget.doc.cm\u000aif(!cm){return 0}\u000aif(!contains(document.body,widget.node)){var parentStyle="position: relative;"\u000aif(widget.coverGutter)\u000a{parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;"}\u000aif(widget.noHScroll)\u000a{parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;"}\u000aremoveChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle))}\u000areturn widget.height=widget.node.parentNode.offsetHeight}\u000afunction eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode){if(!n||(n.nodeType==1&&n.getAttribute("cm-ignore-events")=="true")||(n.parentNode==display.sizer&&n!=display.mover))\u000a{return true}}}\u000afunction paddingTop(display){return display.lineSpace.offsetTop}\u000afunction paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}\u000afunction paddingH(display){if(display.cachedPaddingH){return display.cachedPaddingH}\u000avar e=removeChildrenAndAdd(display.measure,elt("pre","x"))\u000avar style=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle\u000avar data={left:parseInt(style.paddingLeft),right:parseInt(style.paddingRight)}\u000aif(!isNaN(data.left)&&!isNaN(data.right)){display.cachedPaddingH=data}\u000areturn data}\u000afunction scrollGap(cm){return scrollerGap-cm.display.nativeBarWidth}\u000afunction displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth}\u000afunction displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight}\u000afunction ensureLineHeights(cm,lineView,rect){var wrapping=cm.options.lineWrapping\u000avar curWidth=wrapping&&displayWidth(cm)\u000aif(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[]\u000aif(wrapping){lineView.measure.width=curWidth\u000avar rects=lineView.text.firstChild.getClientRects()\u000afor(var i=0;i<rects.length-1;i++){var cur=rects[i],next=rects[i+1]\u000aif(Math.abs(cur.bottom-next.bottom)>2)\u000a{heights.push((cur.bottom+next.top)/2-rect.top)}}}\u000aheights.push(rect.bottom-rect.top)}}\u000afunction mapFromLineView(lineView,line,lineN){if(lineView.line==line)\u000a{return{map:lineView.measure.map,cache:lineView.measure.cache}}\u000afor(var i=0;i<lineView.rest.length;i++)\u000a{if(lineView.rest[i]==line)\u000a{return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]}}}\u000afor(var i$1=0;i$1<lineView.rest.length;i$1++)\u000a{if(lineNo(lineView.rest[i$1])>lineN)\u000a{return{map:lineView.measure.maps[i$1],cache:lineView.measure.caches[i$1],before:true}}}}\u000afunction updateExternalMeasurement(cm,line){line=visualLine(line)\u000avar lineN=lineNo(line)\u000avar view=cm.display.externalMeasured=new LineView(cm.doc,line,lineN)\u000aview.lineN=lineN\u000avar built=view.built=buildLineContent(cm,view)\u000aview.text=built.pre\u000aremoveChildrenAndAdd(cm.display.lineMeasure,built.pre)\u000areturn view}\u000afunction measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias)}\u000afunction findViewForLine(cm,lineN){if(lineN>=cm.display.viewFrom&&lineN<cm.display.viewTo)\u000a{return cm.display.view[findViewIndex(cm,lineN)]}\u000avar ext=cm.display.externalMeasured\u000aif(ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size)\u000a{return ext}}\u000afunction prepareMeasureForLine(cm,line){var lineN=lineNo(line)\u000avar view=findViewForLine(cm,lineN)\u000aif(view&&!view.text){view=null}else if(view&&view.changes){updateLineForChanges(cm,view,lineN,getDimensions(cm))\u000acm.curOp.forceUpdate=true}\u000aif(!view)\u000a{view=updateExternalMeasurement(cm,line)}\u000avar info=mapFromLineView(view,line,lineN)\u000areturn{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:false}}\u000afunction measureCharPrepared(cm,prepared,ch,bias,varHeight){if(prepared.before){ch=-1}\u000avar key=ch+(bias||""),found\u000aif(prepared.cache.hasOwnProperty(key)){found=prepared.cache[key]}else{if(!prepared.rect)\u000a{prepared.rect=prepared.view.text.getBoundingClientRect()}\u000aif(!prepared.hasHeights){ensureLineHeights(cm,prepared.view,prepared.rect)\u000aprepared.hasHeights=true}\u000afound=measureCharInner(cm,prepared,ch,bias)\u000aif(!found.bogus){prepared.cache[key]=found}}\u000areturn{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom}}\u000avar nullRect={left:0,right:0,top:0,bottom:0}\u000afunction nodeAndOffsetInLineMap(map,ch,bias){var node,start,end,collapse,mStart,mEnd\u000afor(var i=0;i<map.length;i+=3){mStart=map[i]\u000amEnd=map[i+1]\u000aif(ch<mStart){start=0;end=1\u000acollapse="left"}else if(ch<mEnd){start=ch-mStart\u000aend=start+1}else if(i==map.length-3||ch==mEnd&&map[i+3]>ch){end=mEnd-mStart\u000astart=end-1\u000aif(ch>=mEnd){collapse="right"}}\u000aif(start!=null){node=map[i+2]\u000aif(mStart==mEnd&&bias==(node.insertLeft?"left":"right"))\u000a{collapse=bias}\u000aif(bias=="left"&&start==0)\u000a{while(i&&map[i-2]==map[i-3]&&map[i-1].insertLeft){node=map[(i-=3)+2]\u000acollapse="left"}}\u000aif(bias=="right"&&start==mEnd-mStart)\u000a{while(i<map.length-3&&map[i+3]==map[i+4]&&!map[i+5].insertLeft){node=map[(i+=3)+2]\u000acollapse="right"}}\u000abreak}}\u000areturn{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd}}\u000afunction getUsefulRect(rects,bias){var rect=nullRect\u000aif(bias=="left"){for(var i=0;i<rects.length;i++){if((rect=rects[i]).left!=rect.right){break}}}else{for(var i$1=rects.length-1;i$1>=0;i$1--){if((rect=rects[i$1]).left!=rect.right){break}}}\u000areturn rect}\u000afunction measureCharInner(cm,prepared,ch,bias){var place=nodeAndOffsetInLineMap(prepared.map,ch,bias)\u000avar node=place.node,start=place.start,end=place.end,collapse=place.collapse\u000avar rect\u000aif(node.nodeType==3){for(var i$1=0;i$1<4;i$1++){while(start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start))){--start}\u000awhile(place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end))){++end}\u000aif(ie&&ie_version<9&&start==0&&end==place.coverEnd-place.coverStart)\u000a{rect=node.parentNode.getBoundingClientRect()}\u000aelse\u000a{rect=getUsefulRect(range(node,start,end).getClientRects(),bias)}\u000aif(rect.left||rect.right||start==0){break}\u000aend=start\u000astart=start-1\u000acollapse="right"}\u000aif(ie&&ie_version<11){rect=maybeUpdateRectForZooming(cm.display.measure,rect)}}else{if(start>0){collapse=bias="right"}\u000avar rects\u000aif(cm.options.lineWrapping&&(rects=node.getClientRects()).length>1)\u000a{rect=rects[bias=="right"?rects.length-1:0]}\u000aelse\u000a{rect=node.getBoundingClientRect()}}\u000aif(ie&&ie_version<9&&!start&&(!rect||!rect.left&&!rect.right)){var rSpan=node.parentNode.getClientRects()[0]\u000aif(rSpan)\u000a{rect={left:rSpan.left,right:rSpan.left+charWidth(cm.display),top:rSpan.top,bottom:rSpan.bottom}}\u000aelse\u000a{rect=nullRect}}\u000avar rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top\u000avar mid=(rtop+rbot)/2\u000avar heights=prepared.view.measure.heights\u000avar i=0\u000afor(;i<heights.length-1;i++)\u000a{if(mid<heights[i]){break}}\u000avar top=i?heights[i-1]:0,bot=heights[i]\u000avar result={left:(collapse=="right"?rect.right:rect.left)-prepared.rect.left,right:(collapse=="left"?rect.left:rect.right)-prepared.rect.left,top:top,bottom:bot}\u000aif(!rect.left&&!rect.right){result.bogus=true}\u000aif(!cm.options.singleCursorHeightPerLine){result.rtop=rtop;result.rbottom=rbot}\u000areturn result}\u000afunction maybeUpdateRectForZooming(measure,rect){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(measure))\u000a{return rect}\u000avar scaleX=screen.logicalXDPI/screen.deviceXDPI\u000avar scaleY=screen.logicalYDPI/screen.deviceYDPI\u000areturn{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY}}\u000afunction clearLineMeasurementCacheFor(lineView){if(lineView.measure){lineView.measure.cache={}\u000alineView.measure.heights=null\u000aif(lineView.rest){for(var i=0;i<lineView.rest.length;i++)\u000a{lineView.measure.caches[i]={}}}}}\u000afunction clearLineMeasurementCache(cm){cm.display.externalMeasure=null\u000aremoveChildren(cm.display.lineMeasure)\u000afor(var i=0;i<cm.display.view.length;i++)\u000a{clearLineMeasurementCacheFor(cm.display.view[i])}}\u000afunction clearCaches(cm){clearLineMeasurementCache(cm)\u000acm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null\u000aif(!cm.options.lineWrapping){cm.display.maxLineChanged=true}\u000acm.display.lineNumChars=null}\u000afunction pageScrollX(){if(chrome&&android){return-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft))}\u000areturn window.pageXOffset||(document.documentElement||document.body).scrollLeft}\u000afunction pageScrollY(){if(chrome&&android){return-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop))}\u000areturn window.pageYOffset||(document.documentElement||document.body).scrollTop}\u000afunction widgetTopHeight(lineObj){var height=0\u000aif(lineObj.widgets){for(var i=0;i<lineObj.widgets.length;++i){if(lineObj.widgets[i].above)\u000a{height+=widgetHeight(lineObj.widgets[i])}}}\u000areturn height}\u000afunction intoCoordSystem(cm,lineObj,rect,context,includeWidgets){if(!includeWidgets){var height=widgetTopHeight(lineObj)\u000arect.top+=height;rect.bottom+=height}\u000aif(context=="line"){return rect}\u000aif(!context){context="local"}\u000avar yOff=heightAtLine(lineObj)\u000aif(context=="local"){yOff+=paddingTop(cm.display)}\u000aelse{yOff-=cm.display.viewOffset}\u000aif(context=="page"||context=="window"){var lOff=cm.display.lineSpace.getBoundingClientRect()\u000ayOff+=lOff.top+(context=="window"?0:pageScrollY())\u000avar xOff=lOff.left+(context=="window"?0:pageScrollX())\u000arect.left+=xOff;rect.right+=xOff}\u000arect.top+=yOff;rect.bottom+=yOff\u000areturn rect}\u000afunction fromCoordSystem(cm,coords,context){if(context=="div"){return coords}\u000avar left=coords.left,top=coords.top\u000aif(context=="page"){left-=pageScrollX()\u000atop-=pageScrollY()}else if(context=="local"||!context){var localBox=cm.display.sizer.getBoundingClientRect()\u000aleft+=localBox.left\u000atop+=localBox.top}\u000avar lineSpaceBox=cm.display.lineSpace.getBoundingClientRect()\u000areturn{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}\u000afunction charCoords(cm,pos,context,lineObj,bias){if(!lineObj){lineObj=getLine(cm.doc,pos.line)}\u000areturn intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,bias),context)}\u000afunction cursorCoords(cm,pos,context,lineObj,preparedMeasure,varHeight){lineObj=lineObj||getLine(cm.doc,pos.line)\u000aif(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj)}\u000afunction get(ch,right){var m=measureCharPrepared(cm,preparedMeasure,ch,right?"right":"left",varHeight)\u000aif(right){m.left=m.right;}else{m.right=m.left}\u000areturn intoCoordSystem(cm,lineObj,m,context)}\u000avar order=getOrder(lineObj,cm.doc.direction),ch=pos.ch,sticky=pos.sticky\u000aif(ch>=lineObj.text.length){ch=lineObj.text.length\u000asticky="before"}else if(ch<=0){ch=0\u000asticky="after"}\u000aif(!order){return get(sticky=="before"?ch-1:ch,sticky=="before")}\u000afunction getBidi(ch,partPos,invert){var part=order[partPos],right=part.level==1\u000areturn get(invert?ch-1:ch,right!=invert)}\u000avar partPos=getBidiPartAt(order,ch,sticky)\u000avar other=bidiOther\u000avar val=getBidi(ch,partPos,sticky=="before")\u000aif(other!=null){val.other=getBidi(ch,other,sticky!="before")}\u000areturn val}\u000afunction estimateCoords(cm,pos){var left=0\u000apos=clipPos(cm.doc,pos)\u000aif(!cm.options.lineWrapping){left=charWidth(cm.display)*pos.ch}\u000avar lineObj=getLine(cm.doc,pos.line)\u000avar top=heightAtLine(lineObj)+paddingTop(cm.display)\u000areturn{left:left,right:left,top:top,bottom:top+lineObj.height}}\u000afunction PosWithInfo(line,ch,sticky,outside,xRel){var pos=Pos(line,ch,sticky)\u000apos.xRel=xRel\u000aif(outside){pos.outside=true}\u000areturn pos}\u000afunction coordsChar(cm,x,y){var doc=cm.doc\u000ay+=cm.display.viewOffset\u000aif(y<0){return PosWithInfo(doc.first,0,null,true,-1)}\u000avar lineN=lineAtHeight(doc,y),last=doc.first+doc.size-1\u000aif(lineN>last)\u000a{return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,null,true,1)}\u000aif(x<0){x=0}\u000avar lineObj=getLine(doc,lineN)\u000afor(;;){var found=coordsCharInner(cm,lineObj,lineN,x,y)\u000avar merged=collapsedSpanAtEnd(lineObj)\u000avar mergedPos=merged&&merged.find(0,true)\u000aif(merged&&(found.ch>mergedPos.from.ch||found.ch==mergedPos.from.ch&&found.xRel>0))\u000a{lineN=lineNo(lineObj=mergedPos.to.line)}\u000aelse\u000a{return found}}}\u000afunction wrappedLineExtent(cm,lineObj,preparedMeasure,y){y-=widgetTopHeight(lineObj)\u000avar end=lineObj.text.length\u000avar begin=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch-1).bottom<=y;},end,0)\u000aend=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch).top>y;},begin,end)\u000areturn{begin:begin,end:end}}\u000afunction wrappedLineExtentChar(cm,lineObj,preparedMeasure,target){if(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj)}\u000avar targetTop=intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,target),"line").top\u000areturn wrappedLineExtent(cm,lineObj,preparedMeasure,targetTop)}\u000afunction boxIsAfter(box,x,y,left){return box.bottom<=y?false:box.top>y?true:(left?box.left:box.right)>x}\u000afunction coordsCharInner(cm,lineObj,lineNo,x,y){y-=heightAtLine(lineObj)\u000avar preparedMeasure=prepareMeasureForLine(cm,lineObj)\u000avar widgetHeight=widgetTopHeight(lineObj)\u000avar begin=0,end=lineObj.text.length,ltr=true\u000avar order=getOrder(lineObj,cm.doc.direction)\u000aif(order){var part=(cm.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)\u000a(cm,lineObj,lineNo,preparedMeasure,order,x,y)\u000altr=part.level!=1\u000abegin=ltr?part.from:part.to-1\u000aend=ltr?part.to:part.from-1}\u000avar chAround=null,boxAround=null\u000avar ch=findFirst(function(ch){var box=measureCharPrepared(cm,preparedMeasure,ch)\u000abox.top+=widgetHeight;box.bottom+=widgetHeight\u000aif(!boxIsAfter(box,x,y,false)){return false}\u000aif(box.top<=y&&box.left<=x){chAround=ch\u000aboxAround=box}\u000areturn true},begin,end)\u000avar baseX,sticky,outside=false\u000aif(boxAround){var atLeft=x-boxAround.left<boxAround.right-x,atStart=atLeft==ltr\u000ach=chAround+(atStart?0:1)\u000asticky=atStart?"after":"before"\u000abaseX=atLeft?boxAround.left:boxAround.right}else{if(!ltr&&(ch==end||ch==begin)){ch++}\u000asticky=ch==0?"after":ch==lineObj.text.length?"before":(measureCharPrepared(cm,preparedMeasure,ch-(ltr?1:0)).bottom+widgetHeight<=y)==ltr?"after":"before"\u000avar coords=cursorCoords(cm,Pos(lineNo,ch,sticky),"line",lineObj,preparedMeasure)\u000abaseX=coords.left\u000aoutside=y<coords.top||y>=coords.bottom}\u000ach=skipExtendingChars(lineObj.text,ch,1)\u000areturn PosWithInfo(lineNo,ch,sticky,outside,x-baseX)}\u000afunction coordsBidiPart(cm,lineObj,lineNo,preparedMeasure,order,x,y){var index=findFirst(function(i){var part=order[i],ltr=part.level!=1\u000areturn boxIsAfter(cursorCoords(cm,Pos(lineNo,ltr?part.to:part.from,ltr?"before":"after"),"line",lineObj,preparedMeasure),x,y,true)},0,order.length-1)\u000avar part=order[index]\u000aif(index>0){var ltr=part.level!=1\u000avar start=cursorCoords(cm,Pos(lineNo,ltr?part.from:part.to,ltr?"after":"before"),"line",lineObj,preparedMeasure)\u000aif(boxIsAfter(start,x,y,true)&&start.top>y)\u000a{part=order[index-1]}}\u000areturn part}\u000afunction coordsBidiPartWrapped(cm,lineObj,_lineNo,preparedMeasure,order,x,y){var ref=wrappedLineExtent(cm,lineObj,preparedMeasure,y);var begin=ref.begin;var end=ref.end;if(/\u005cs/.test(lineObj.text.charAt(end-1))){end--}\u000avar part=null,closestDist=null\u000afor(var i=0;i<order.length;i++){var p=order[i]\u000aif(p.from>=end||p.to<=begin){continue}\u000avar ltr=p.level!=1\u000avar endX=measureCharPrepared(cm,preparedMeasure,ltr?Math.min(end,p.to)-1:Math.max(begin,p.from)).right\u000avar dist=endX<x?x-endX+1e9:endX-x\u000aif(!part||closestDist>dist){part=p\u000aclosestDist=dist}}\u000aif(!part){part=order[order.length-1]}\u000aif(part.from<begin){part={from:begin,to:part.to,level:part.level}}\u000aif(part.to>end){part={from:part.from,to:end,level:part.level}}\u000areturn part}\u000avar measureText\u000afunction textHeight(display){if(display.cachedTextHeight!=null){return display.cachedTextHeight}\u000aif(measureText==null){measureText=elt("pre")\u000afor(var i=0;i<49;++i){measureText.appendChild(document.createTextNode("x"))\u000ameasureText.appendChild(elt("br"))}\u000ameasureText.appendChild(document.createTextNode("x"))}\u000aremoveChildrenAndAdd(display.measure,measureText)\u000avar height=measureText.offsetHeight/50\u000aif(height>3){display.cachedTextHeight=height}\u000aremoveChildren(display.measure)\u000areturn height||1}\u000afunction charWidth(display){if(display.cachedCharWidth!=null){return display.cachedCharWidth}\u000avar anchor=elt("span","xxxxxxxxxx")\u000avar pre=elt("pre",[anchor])\u000aremoveChildrenAndAdd(display.measure,pre)\u000avar rect=anchor.getBoundingClientRect(),width=(rect.right-rect.left)/10\u000aif(width>2){display.cachedCharWidth=width}\u000areturn width||10}\u000afunction getDimensions(cm){var d=cm.display,left={},width={}\u000avar gutterLeft=d.gutters.clientLeft\u000afor(var n=d.gutters.firstChild,i=0;n;n=n.nextSibling,++i){left[cm.options.gutters[i]]=n.offsetLeft+n.clientLeft+gutterLeft\u000awidth[cm.options.gutters[i]]=n.clientWidth}\u000areturn{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}\u000afunction compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left}\u000afunction estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping\u000avar perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3)\u000areturn function(line){if(lineIsHidden(cm.doc,line)){return 0}\u000avar widgetsHeight=0\u000aif(line.widgets){for(var i=0;i<line.widgets.length;i++){if(line.widgets[i].height){widgetsHeight+=line.widgets[i].height}}}\u000aif(wrapping)\u000a{return widgetsHeight+(Math.ceil(line.text.length/perLine)||1)*th}\u000aelse\u000a{return widgetsHeight+th}}}\u000afunction estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm)\u000adoc.iter(function(line){var estHeight=est(line)\u000aif(estHeight!=line.height){updateLineHeight(line,estHeight)}})}\u000afunction posFromMouse(cm,e,liberal,forRect){var display=cm.display\u000aif(!liberal&&e_target(e).getAttribute("cm-not-content")=="true"){return null}\u000avar x,y,space=display.lineSpace.getBoundingClientRect()\u000atry{x=e.clientX-space.left;y=e.clientY-space.top}\u000acatch(e){return null}\u000avar coords=coordsChar(cm,x,y),line\u000aif(forRect&&coords.xRel==1&&(line=getLine(cm.doc,coords.line).text).length==coords.ch){var colDiff=countColumn(line,line.length,cm.options.tabSize)-line.length\u000acoords=Pos(coords.line,Math.max(0,Math.round((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff))}\u000areturn coords}\u000afunction findViewIndex(cm,n){if(n>=cm.display.viewTo){return null}\u000an-=cm.display.viewFrom\u000aif(n<0){return null}\u000avar view=cm.display.view\u000afor(var i=0;i<view.length;i++){n-=view[i].size\u000aif(n<0){return i}}}\u000afunction updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection())}\u000afunction prepareSelection(cm,primary){if(primary===void 0)primary=true;var doc=cm.doc,result={}\u000avar curFragment=result.cursors=document.createDocumentFragment()\u000avar selFragment=result.selection=document.createDocumentFragment()\u000afor(var i=0;i<doc.sel.ranges.length;i++){if(!primary&&i==doc.sel.primIndex){continue}\u000avar range=doc.sel.ranges[i]\u000aif(range.from().line>=cm.display.viewTo||range.to().line<cm.display.viewFrom){continue}\u000avar collapsed=range.empty()\u000aif(collapsed||cm.options.showCursorWhenSelecting)\u000a{drawSelectionCursor(cm,range.head,curFragment)}\u000aif(!collapsed)\u000a{drawSelectionRange(cm,range,selFragment)}}\u000areturn result}\u000afunction drawSelectionCursor(cm,head,output){var pos=cursorCoords(cm,head,"div",null,null,!cm.options.singleCursorHeightPerLine)\u000avar cursor=output.appendChild(elt("div","\u005cu00a0","CodeMirror-cursor"))\u000acursor.style.left=pos.left+"px"\u000acursor.style.top=pos.top+"px"\u000acursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px"\u000aif(pos.other){var otherCursor=output.appendChild(elt("div","\u005cu00a0","CodeMirror-cursor CodeMirror-secondarycursor"))\u000aotherCursor.style.display=""\u000aotherCursor.style.left=pos.other.left+"px"\u000aotherCursor.style.top=pos.other.top+"px"\u000aotherCursor.style.height=(pos.other.bottom-pos.other.top)*.85+"px"}}\u000afunction cmpCoords(a,b){return a.top-b.top||a.left-b.left}\u000afunction drawSelectionRange(cm,range,output){var display=cm.display,doc=cm.doc\u000avar fragment=document.createDocumentFragment()\u000avar padding=paddingH(cm.display),leftSide=padding.left\u000avar rightSide=Math.max(display.sizerWidth,displayWidth(cm)-display.sizer.offsetLeft)-padding.right\u000avar docLTR=doc.direction=="ltr"\u000afunction add(left,top,width,bottom){if(top<0){top=0}\u000atop=Math.round(top)\u000abottom=Math.round(bottom)\u000afragment.appendChild(elt("div",null,"CodeMirror-selected",("position: absolute; left: "+left+"px;\u005cn                             top: "+top+"px; width: "+(width==null?rightSide-left:width)+"px;\u005cn                             height: "+(bottom-top)+"px")))}\u000afunction drawForLine(line,fromArg,toArg){var lineObj=getLine(doc,line)\u000avar lineLen=lineObj.text.length\u000avar start,end\u000afunction coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias)}\u000afunction wrapX(pos,dir,side){var extent=wrappedLineExtentChar(cm,lineObj,null,pos)\u000avar prop=(dir=="ltr")==(side=="after")?"left":"right"\u000avar ch=side=="after"?extent.begin:extent.end-(/\u005cs/.test(lineObj.text.charAt(extent.end-1))?2:1)\u000areturn coords(ch,prop)[prop]}\u000avar order=getOrder(lineObj,doc.direction)\u000aiterateBidiSections(order,fromArg||0,toArg==null?lineLen:toArg,function(from,to,dir,i){var ltr=dir=="ltr"\u000avar fromPos=coords(from,ltr?"left":"right")\u000avar toPos=coords(to-1,ltr?"right":"left")\u000avar openStart=fromArg==null&&from==0,openEnd=toArg==null&&to==lineLen\u000avar first=i==0,last=!order||i==order.length-1\u000aif(toPos.top-fromPos.top<=3){var openLeft=(docLTR?openStart:openEnd)&&first\u000avar openRight=(docLTR?openEnd:openStart)&&last\u000avar left=openLeft?leftSide:(ltr?fromPos:toPos).left\u000avar right=openRight?rightSide:(ltr?toPos:fromPos).right\u000aadd(left,fromPos.top,right-left,fromPos.bottom)}else{var topLeft,topRight,botLeft,botRight\u000aif(ltr){topLeft=docLTR&&openStart&&first?leftSide:fromPos.left\u000atopRight=docLTR?rightSide:wrapX(from,dir,"before")\u000abotLeft=docLTR?leftSide:wrapX(to,dir,"after")\u000abotRight=docLTR&&openEnd&&last?rightSide:toPos.right}else{topLeft=!docLTR?leftSide:wrapX(from,dir,"before")\u000atopRight=!docLTR&&openStart&&first?rightSide:fromPos.right\u000abotLeft=!docLTR&&openEnd&&last?leftSide:toPos.left\u000abotRight=!docLTR?rightSide:wrapX(to,dir,"after")}\u000aadd(topLeft,fromPos.top,topRight-topLeft,fromPos.bottom)\u000aif(fromPos.bottom<toPos.top){add(leftSide,fromPos.bottom,null,toPos.top)}\u000aadd(botLeft,toPos.top,botRight-botLeft,toPos.bottom)}\u000aif(!start||cmpCoords(fromPos,start)<0){start=fromPos}\u000aif(cmpCoords(toPos,start)<0){start=toPos}\u000aif(!end||cmpCoords(fromPos,end)<0){end=fromPos}\u000aif(cmpCoords(toPos,end)<0){end=toPos}})\u000areturn{start:start,end:end}}\u000avar sFrom=range.from(),sTo=range.to()\u000aif(sFrom.line==sTo.line){drawForLine(sFrom.line,sFrom.ch,sTo.ch)}else{var fromLine=getLine(doc,sFrom.line),toLine=getLine(doc,sTo.line)\u000avar singleVLine=visualLine(fromLine)==visualLine(toLine)\u000avar leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?fromLine.text.length+1:null).end\u000avar rightStart=drawForLine(sTo.line,singleVLine?0:null,sTo.ch).start\u000aif(singleVLine){if(leftEnd.top<rightStart.top-2){add(leftEnd.right,leftEnd.top,null,leftEnd.bottom)\u000aadd(leftSide,rightStart.top,rightStart.left,rightStart.bottom)}else{add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom)}}\u000aif(leftEnd.bottom<rightStart.top)\u000a{add(leftSide,leftEnd.bottom,null,rightStart.top)}}\u000aoutput.appendChild(fragment)}\u000afunction restartBlink(cm){if(!cm.state.focused){return}\u000avar display=cm.display\u000aclearInterval(display.blinker)\u000avar on=true\u000adisplay.cursorDiv.style.visibility=""\u000aif(cm.options.cursorBlinkRate>0)\u000a{display.blinker=setInterval(function(){return display.cursorDiv.style.visibility=(on=!on)?"":"hidden";},cm.options.cursorBlinkRate)}\u000aelse if(cm.options.cursorBlinkRate<0)\u000a{display.cursorDiv.style.visibility="hidden"}}\u000afunction ensureFocus(cm){if(!cm.state.focused){cm.display.input.focus();onFocus(cm)}}\u000afunction delayBlurEvent(cm){cm.state.delayingBlurEvent=true\u000asetTimeout(function(){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false\u000aonBlur(cm)}},100)}\u000afunction onFocus(cm,e){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false}\u000aif(cm.options.readOnly=="nocursor"){return}\u000aif(!cm.state.focused){signal(cm,"focus",cm,e)\u000acm.state.focused=true\u000aaddClass(cm.display.wrapper,"CodeMirror-focused")\u000aif(!cm.curOp&&cm.display.selForContextMenu!=cm.doc.sel){cm.display.input.reset()\u000aif(webkit){setTimeout(function(){return cm.display.input.reset(true);},20)}}\u000acm.display.input.receivedFocus()}\u000arestartBlink(cm)}\u000afunction onBlur(cm,e){if(cm.state.delayingBlurEvent){return}\u000aif(cm.state.focused){signal(cm,"blur",cm,e)\u000acm.state.focused=false\u000armClass(cm.display.wrapper,"CodeMirror-focused")}\u000aclearInterval(cm.display.blinker)\u000asetTimeout(function(){if(!cm.state.focused){cm.display.shift=false}},150)}\u000afunction updateHeightsInViewport(cm){var display=cm.display\u000avar prevBottom=display.lineDiv.offsetTop\u000afor(var i=0;i<display.view.length;i++){var cur=display.view[i],height=(void 0)\u000aif(cur.hidden){continue}\u000aif(ie&&ie_version<8){var bot=cur.node.offsetTop+cur.node.offsetHeight\u000aheight=bot-prevBottom\u000aprevBottom=bot}else{var box=cur.node.getBoundingClientRect()\u000aheight=box.bottom-box.top}\u000avar diff=cur.line.height-height\u000aif(height<2){height=textHeight(display)}\u000aif(diff>.005||diff<-.005){updateLineHeight(cur.line,height)\u000aupdateWidgetHeight(cur.line)\u000aif(cur.rest){for(var j=0;j<cur.rest.length;j++)\u000a{updateWidgetHeight(cur.rest[j])}}}}}\u000afunction updateWidgetHeight(line){if(line.widgets){for(var i=0;i<line.widgets.length;++i){var w=line.widgets[i],parent=w.node.parentNode\u000aif(parent){w.height=parent.offsetHeight}}}}\u000afunction visibleLines(display,doc,viewport){var top=viewport&&viewport.top!=null?Math.max(0,viewport.top):display.scroller.scrollTop\u000atop=Math.floor(top-paddingTop(display))\u000avar bottom=viewport&&viewport.bottom!=null?viewport.bottom:top+display.wrapper.clientHeight\u000avar from=lineAtHeight(doc,top),to=lineAtHeight(doc,bottom)\u000aif(viewport&&viewport.ensure){var ensureFrom=viewport.ensure.from.line,ensureTo=viewport.ensure.to.line\u000aif(ensureFrom<from){from=ensureFrom\u000ato=lineAtHeight(doc,heightAtLine(getLine(doc,ensureFrom))+display.wrapper.clientHeight)}else if(Math.min(ensureTo,doc.lastLine())>=to){from=lineAtHeight(doc,heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight)\u000ato=ensureTo}}\u000areturn{from:from,to:Math.max(to,from+1)}}\u000afunction alignHorizontally(cm){var display=cm.display,view=display.view\u000aif(!display.alignWidgets&&(!display.gutters.firstChild||!cm.options.fixedGutter)){return}\u000avar comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft\u000avar gutterW=display.gutters.offsetWidth,left=comp+"px"\u000afor(var i=0;i<view.length;i++){if(!view[i].hidden){if(cm.options.fixedGutter){if(view[i].gutter)\u000a{view[i].gutter.style.left=left}\u000aif(view[i].gutterBackground)\u000a{view[i].gutterBackground.style.left=left}}\u000avar align=view[i].alignable\u000aif(align){for(var j=0;j<align.length;j++)\u000a{align[j].style.left=left}}}}\u000aif(cm.options.fixedGutter)\u000a{display.gutters.style.left=(comp+gutterW)+"px"}}\u000afunction maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers){return false}\u000avar doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display\u000aif(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt"))\u000avar innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW\u000adisplay.lineGutter.style.width=""\u000adisplay.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding)+1\u000adisplay.lineNumWidth=display.lineNumInnerWidth+padding\u000adisplay.lineNumChars=display.lineNumInnerWidth?last.length:-1\u000adisplay.lineGutter.style.width=display.lineNumWidth+"px"\u000aupdateGutterSpace(cm)\u000areturn true}\u000areturn false}\u000afunction maybeScrollWindow(cm,rect){if(signalDOMEvent(cm,"scrollCursorIntoView")){return}\u000avar display=cm.display,box=display.sizer.getBoundingClientRect(),doScroll=null\u000aif(rect.top+box.top<0){doScroll=true}\u000aelse if(rect.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)){doScroll=false}\u000aif(doScroll!=null&&!phantom){var scrollNode=elt("div","\u005cu200b",null,("position: absolute;\u005cn                         top: "+(rect.top-display.viewOffset-paddingTop(cm.display))+"px;\u005cn                         height: "+(rect.bottom-rect.top+scrollGap(cm)+display.barHeight)+"px;\u005cn                         left: "+(rect.left)+"px; width: "+(Math.max(2,rect.right-rect.left))+"px;"))\u000acm.display.lineSpace.appendChild(scrollNode)\u000ascrollNode.scrollIntoView(doScroll)\u000acm.display.lineSpace.removeChild(scrollNode)}}\u000afunction scrollPosIntoView(cm,pos,end,margin){if(margin==null){margin=0}\u000avar rect\u000aif(!cm.options.lineWrapping&&pos==end){pos=pos.ch?Pos(pos.line,pos.sticky=="before"?pos.ch-1:pos.ch,"after"):pos\u000aend=pos.sticky=="before"?Pos(pos.line,pos.ch+1,"before"):pos}\u000afor(var limit=0;limit<5;limit++){var changed=false\u000avar coords=cursorCoords(cm,pos)\u000avar endCoords=!end||end==pos?coords:cursorCoords(cm,end)\u000arect={left:Math.min(coords.left,endCoords.left),top:Math.min(coords.top,endCoords.top)-margin,right:Math.max(coords.left,endCoords.left),bottom:Math.max(coords.bottom,endCoords.bottom)+margin}\u000avar scrollPos=calculateScrollPos(cm,rect)\u000avar startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft\u000aif(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop)\u000aif(Math.abs(cm.doc.scrollTop-startTop)>1){changed=true}}\u000aif(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft)\u000aif(Math.abs(cm.doc.scrollLeft-startLeft)>1){changed=true}}\u000aif(!changed){break}}\u000areturn rect}\u000afunction scrollIntoView(cm,rect){var scrollPos=calculateScrollPos(cm,rect)\u000aif(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop)}\u000aif(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft)}}\u000afunction calculateScrollPos(cm,rect){var display=cm.display,snapMargin=textHeight(cm.display)\u000aif(rect.top<0){rect.top=0}\u000avar screentop=cm.curOp&&cm.curOp.scrollTop!=null?cm.curOp.scrollTop:display.scroller.scrollTop\u000avar screen=displayHeight(cm),result={}\u000aif(rect.bottom-rect.top>screen){rect.bottom=rect.top+screen}\u000avar docBottom=cm.doc.height+paddingVert(display)\u000avar atTop=rect.top<snapMargin,atBottom=rect.bottom>docBottom-snapMargin\u000aif(rect.top<screentop){result.scrollTop=atTop?0:rect.top}else if(rect.bottom>screentop+screen){var newTop=Math.min(rect.top,(atBottom?docBottom:rect.bottom)-screen)\u000aif(newTop!=screentop){result.scrollTop=newTop}}\u000avar screenleft=cm.curOp&&cm.curOp.scrollLeft!=null?cm.curOp.scrollLeft:display.scroller.scrollLeft\u000avar screenw=displayWidth(cm)-(cm.options.fixedGutter?display.gutters.offsetWidth:0)\u000avar tooWide=rect.right-rect.left>screenw\u000aif(tooWide){rect.right=rect.left+screenw}\u000aif(rect.left<10)\u000a{result.scrollLeft=0}\u000aelse if(rect.left<screenleft)\u000a{result.scrollLeft=Math.max(0,rect.left-(tooWide?0:10))}\u000aelse if(rect.right>screenw+screenleft-3)\u000a{result.scrollLeft=rect.right+(tooWide?0:10)-screenw}\u000areturn result}\u000afunction addToScrollTop(cm,top){if(top==null){return}\u000aresolveScrollToPos(cm)\u000acm.curOp.scrollTop=(cm.curOp.scrollTop==null?cm.doc.scrollTop:cm.curOp.scrollTop)+top}\u000afunction ensureCursorVisible(cm){resolveScrollToPos(cm)\u000avar cur=cm.getCursor()\u000acm.curOp.scrollToPos={from:cur,to:cur,margin:cm.options.cursorScrollMargin}}\u000afunction scrollToCoords(cm,x,y){if(x!=null||y!=null){resolveScrollToPos(cm)}\u000aif(x!=null){cm.curOp.scrollLeft=x}\u000aif(y!=null){cm.curOp.scrollTop=y}}\u000afunction scrollToRange(cm,range){resolveScrollToPos(cm)\u000acm.curOp.scrollToPos=range}\u000afunction resolveScrollToPos(cm){var range=cm.curOp.scrollToPos\u000aif(range){cm.curOp.scrollToPos=null\u000avar from=estimateCoords(cm,range.from),to=estimateCoords(cm,range.to)\u000ascrollToCoordsRange(cm,from,to,range.margin)}}\u000afunction scrollToCoordsRange(cm,from,to,margin){var sPos=calculateScrollPos(cm,{left:Math.min(from.left,to.left),top:Math.min(from.top,to.top)-margin,right:Math.max(from.right,to.right),bottom:Math.max(from.bottom,to.bottom)+margin})\u000ascrollToCoords(cm,sPos.scrollLeft,sPos.scrollTop)}\u000afunction updateScrollTop(cm,val){if(Math.abs(cm.doc.scrollTop-val)<2){return}\u000aif(!gecko){updateDisplaySimple(cm,{top:val})}\u000asetScrollTop(cm,val,true)\u000aif(gecko){updateDisplaySimple(cm)}\u000astartWorker(cm,100)}\u000afunction setScrollTop(cm,val,forceScroll){val=Math.min(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,val)\u000aif(cm.display.scroller.scrollTop==val&&!forceScroll){return}\u000acm.doc.scrollTop=val\u000acm.display.scrollbars.setScrollTop(val)\u000aif(cm.display.scroller.scrollTop!=val){cm.display.scroller.scrollTop=val}}\u000afunction setScrollLeft(cm,val,isScroller,forceScroll){val=Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth)\u000aif((isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2)&&!forceScroll){return}\u000acm.doc.scrollLeft=val\u000aalignHorizontally(cm)\u000aif(cm.display.scroller.scrollLeft!=val){cm.display.scroller.scrollLeft=val}\u000acm.display.scrollbars.setScrollLeft(val)}\u000afunction measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth\u000avar docH=Math.round(cm.doc.height+paddingVert(cm.display))\u000areturn{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW}}\u000avar NativeScrollbars=function(place,scroll,cm){this.cm=cm\u000avar vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar")\u000avar horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar")\u000aplace(vert);place(horiz)\u000aon(vert,"scroll",function(){if(vert.clientHeight){scroll(vert.scrollTop,"vertical")}})\u000aon(horiz,"scroll",function(){if(horiz.clientWidth){scroll(horiz.scrollLeft,"horizontal")}})\u000athis.checkedZeroWidth=false\u000aif(ie&&ie_version<8){this.horiz.style.minHeight=this.vert.style.minWidth="18px"}};NativeScrollbars.prototype.update=function(measure){var needsH=measure.scrollWidth>measure.clientWidth+1\u000avar needsV=measure.scrollHeight>measure.clientHeight+1\u000avar sWidth=measure.nativeBarWidth\u000aif(needsV){this.vert.style.display="block"\u000athis.vert.style.bottom=needsH?sWidth+"px":"0"\u000avar totalHeight=measure.viewHeight-(needsH?sWidth:0)\u000athis.vert.firstChild.style.height=Math.max(0,measure.scrollHeight-measure.clientHeight+totalHeight)+"px"}else{this.vert.style.display=""\u000athis.vert.firstChild.style.height="0"}\u000aif(needsH){this.horiz.style.display="block"\u000athis.horiz.style.right=needsV?sWidth+"px":"0"\u000athis.horiz.style.left=measure.barLeft+"px"\u000avar totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0)\u000athis.horiz.firstChild.style.width=Math.max(0,measure.scrollWidth-measure.clientWidth+totalWidth)+"px"}else{this.horiz.style.display=""\u000athis.horiz.firstChild.style.width="0"}\u000aif(!this.checkedZeroWidth&&measure.clientHeight>0){if(sWidth==0){this.zeroWidthHack()}\u000athis.checkedZeroWidth=true}\u000areturn{right:needsV?sWidth:0,bottom:needsH?sWidth:0}};NativeScrollbars.prototype.setScrollLeft=function(pos){if(this.horiz.scrollLeft!=pos){this.horiz.scrollLeft=pos}\u000aif(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}};NativeScrollbars.prototype.setScrollTop=function(pos){if(this.vert.scrollTop!=pos){this.vert.scrollTop=pos}\u000aif(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}};NativeScrollbars.prototype.zeroWidthHack=function(){var w=mac&&!mac_geMountainLion?"12px":"18px"\u000athis.horiz.style.height=this.vert.style.width=w\u000athis.horiz.style.pointerEvents=this.vert.style.pointerEvents="none"\u000athis.disableHoriz=new Delayed\u000athis.disableVert=new Delayed};NativeScrollbars.prototype.enableZeroWidthBar=function(bar,delay,type){bar.style.pointerEvents="auto"\u000afunction maybeDisable(){var box=bar.getBoundingClientRect()\u000avar elt=type=="vert"?document.elementFromPoint(box.right-1,(box.top+box.bottom)/2):document.elementFromPoint((box.right+box.left)/2,box.bottom-1)\u000aif(elt!=bar){bar.style.pointerEvents="none"}\u000aelse{delay.set(1000,maybeDisable)}}\u000adelay.set(1000,maybeDisable)};NativeScrollbars.prototype.clear=function(){var parent=this.horiz.parentNode\u000aparent.removeChild(this.horiz)\u000aparent.removeChild(this.vert)};var NullScrollbars=function(){};NullScrollbars.prototype.update=function(){return{bottom:0,right:0}};NullScrollbars.prototype.setScrollLeft=function(){};NullScrollbars.prototype.setScrollTop=function(){};NullScrollbars.prototype.clear=function(){};function updateScrollbars(cm,measure){if(!measure){measure=measureForScrollbars(cm)}\u000avar startWidth=cm.display.barWidth,startHeight=cm.display.barHeight\u000aupdateScrollbarsInner(cm,measure)\u000afor(var i=0;i<4&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;i++){if(startWidth!=cm.display.barWidth&&cm.options.lineWrapping)\u000a{updateHeightsInViewport(cm)}\u000aupdateScrollbarsInner(cm,measureForScrollbars(cm))\u000astartWidth=cm.display.barWidth;startHeight=cm.display.barHeight}}\u000afunction updateScrollbarsInner(cm,measure){var d=cm.display\u000avar sizes=d.scrollbars.update(measure)\u000ad.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px"\u000ad.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px"\u000ad.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent"\u000aif(sizes.right&&sizes.bottom){d.scrollbarFiller.style.display="block"\u000ad.scrollbarFiller.style.height=sizes.bottom+"px"\u000ad.scrollbarFiller.style.width=sizes.right+"px"}else{d.scrollbarFiller.style.display=""}\u000aif(sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter){d.gutterFiller.style.display="block"\u000ad.gutterFiller.style.height=sizes.bottom+"px"\u000ad.gutterFiller.style.width=measure.gutterWidth+"px"}else{d.gutterFiller.style.display=""}}\u000avar scrollbarModel={"native":NativeScrollbars,"null":NullScrollbars}\u000afunction initScrollbars(cm){if(cm.display.scrollbars){cm.display.scrollbars.clear()\u000aif(cm.display.scrollbars.addClass)\u000a{rmClass(cm.display.wrapper,cm.display.scrollbars.addClass)}}\u000acm.display.scrollbars=new scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller)\u000aon(node,"mousedown",function(){if(cm.state.focused){setTimeout(function(){return cm.display.input.focus();},0)}})\u000anode.setAttribute("cm-not-content","true")},function(pos,axis){if(axis=="horizontal"){setScrollLeft(cm,pos)}\u000aelse{updateScrollTop(cm,pos)}},cm)\u000aif(cm.display.scrollbars.addClass)\u000a{addClass(cm.display.wrapper,cm.display.scrollbars.addClass)}}\u000avar nextOpId=0\u000afunction startOperation(cm){cm.curOp={cm:cm,viewChanged:false,startHeight:cm.doc.height,forceUpdate:false,updateInput:null,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++nextOpId}\u000apushOperation(cm.curOp)}\u000afunction endOperation(cm){var op=cm.curOp\u000afinishOperation(op,function(group){for(var i=0;i<group.ops.length;i++)\u000a{group.ops[i].cm.curOp=null}\u000aendOperations(group)})}\u000afunction endOperations(group){var ops=group.ops\u000afor(var i=0;i<ops.length;i++)\u000a{endOperation_R1(ops[i])}\u000afor(var i$1=0;i$1<ops.length;i$1++)\u000a{endOperation_W1(ops[i$1])}\u000afor(var i$2=0;i$2<ops.length;i$2++)\u000a{endOperation_R2(ops[i$2])}\u000afor(var i$3=0;i$3<ops.length;i$3++)\u000a{endOperation_W2(ops[i$3])}\u000afor(var i$4=0;i$4<ops.length;i$4++)\u000a{endOperation_finish(ops[i$4])}}\u000afunction endOperation_R1(op){var cm=op.cm,display=cm.display\u000amaybeClipScrollbars(cm)\u000aif(op.updateMaxLine){findMaxLine(cm)}\u000aop.mustUpdate=op.viewChanged||op.forceUpdate||op.scrollTop!=null||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping\u000aop.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate)}\u000afunction endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update)}\u000afunction endOperation_R2(op){var cm=op.cm,display=cm.display\u000aif(op.updatedDisplay){updateHeightsInViewport(cm)}\u000aop.barMeasure=measureForScrollbars(cm)\u000aif(display.maxLineChanged&&!cm.options.lineWrapping){op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3\u000acm.display.sizerWidth=op.adjustWidthTo\u000aop.barMeasure.scrollWidth=Math.max(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth)\u000aop.maxScrollLeft=Math.max(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm))}\u000aif(op.updatedDisplay||op.selectionChanged)\u000a{op.preparedSelection=display.input.prepareSelection()}}\u000afunction endOperation_W2(op){var cm=op.cm\u000aif(op.adjustWidthTo!=null){cm.display.sizer.style.minWidth=op.adjustWidthTo+"px"\u000aif(op.maxScrollLeft<cm.doc.scrollLeft)\u000a{setScrollLeft(cm,Math.min(cm.display.scroller.scrollLeft,op.maxScrollLeft),true)}\u000acm.display.maxLineChanged=false}\u000avar takeFocus=op.focus&&op.focus==activeElt()\u000aif(op.preparedSelection)\u000a{cm.display.input.showSelection(op.preparedSelection,takeFocus)}\u000aif(op.updatedDisplay||op.startHeight!=cm.doc.height)\u000a{updateScrollbars(cm,op.barMeasure)}\u000aif(op.updatedDisplay)\u000a{setDocumentHeight(cm,op.barMeasure)}\u000aif(op.selectionChanged){restartBlink(cm)}\u000aif(cm.state.focused&&op.updateInput)\u000a{cm.display.input.reset(op.typing)}\u000aif(takeFocus){ensureFocus(op.cm)}}\u000afunction endOperation_finish(op){var cm=op.cm,display=cm.display,doc=cm.doc\u000aif(op.updatedDisplay){postUpdateDisplay(cm,op.update)}\u000aif(display.wheelStartX!=null&&(op.scrollTop!=null||op.scrollLeft!=null||op.scrollToPos))\u000a{display.wheelStartX=display.wheelStartY=null}\u000aif(op.scrollTop!=null){setScrollTop(cm,op.scrollTop,op.forceScroll)}\u000aif(op.scrollLeft!=null){setScrollLeft(cm,op.scrollLeft,true,true)}\u000aif(op.scrollToPos){var rect=scrollPosIntoView(cm,clipPos(doc,op.scrollToPos.from),clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin)\u000amaybeScrollWindow(cm,rect)}\u000avar hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers\u000aif(hidden){for(var i=0;i<hidden.length;++i)\u000a{if(!hidden[i].lines.length){signal(hidden[i],"hide")}}}\u000aif(unhidden){for(var i$1=0;i$1<unhidden.length;++i$1)\u000a{if(unhidden[i$1].lines.length){signal(unhidden[i$1],"unhide")}}}\u000aif(display.wrapper.offsetHeight)\u000a{doc.scrollTop=cm.display.scroller.scrollTop}\u000aif(op.changeObjs)\u000a{signal(cm,"changes",cm,op.changeObjs)}\u000aif(op.update)\u000a{op.update.finish()}}\u000afunction runInOp(cm,f){if(cm.curOp){return f()}\u000astartOperation(cm)\u000atry{return f()}\u000afinally{endOperation(cm)}}\u000afunction operation(cm,f){return function(){if(cm.curOp){return f.apply(cm,arguments)}\u000astartOperation(cm)\u000atry{return f.apply(cm,arguments)}\u000afinally{endOperation(cm)}}}\u000afunction methodOp(f){return function(){if(this.curOp){return f.apply(this,arguments)}\u000astartOperation(this)\u000atry{return f.apply(this,arguments)}\u000afinally{endOperation(this)}}}\u000afunction docMethodOp(f){return function(){var cm=this.cm\u000aif(!cm||cm.curOp){return f.apply(this,arguments)}\u000astartOperation(cm)\u000atry{return f.apply(this,arguments)}\u000afinally{endOperation(cm)}}}\u000afunction regChange(cm,from,to,lendiff){if(from==null){from=cm.doc.first}\u000aif(to==null){to=cm.doc.first+cm.doc.size}\u000aif(!lendiff){lendiff=0}\u000avar display=cm.display\u000aif(lendiff&&to<display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>from))\u000a{display.updateLineNumbers=from}\u000acm.curOp.viewChanged=true\u000aif(from>=display.viewTo){if(sawCollapsedSpans&&visualLineNo(cm.doc,from)<display.viewTo)\u000a{resetView(cm)}}else if(to<=display.viewFrom){if(sawCollapsedSpans&&visualLineEndNo(cm.doc,to+lendiff)>display.viewFrom){resetView(cm)}else{display.viewFrom+=lendiff\u000adisplay.viewTo+=lendiff}}else if(from<=display.viewFrom&&to>=display.viewTo){resetView(cm)}else if(from<=display.viewFrom){var cut=viewCuttingPoint(cm,to,to+lendiff,1)\u000aif(cut){display.view=display.view.slice(cut.index)\u000adisplay.viewFrom=cut.lineN\u000adisplay.viewTo+=lendiff}else{resetView(cm)}}else if(to>=display.viewTo){var cut$1=viewCuttingPoint(cm,from,from,-1)\u000aif(cut$1){display.view=display.view.slice(0,cut$1.index)\u000adisplay.viewTo=cut$1.lineN}else{resetView(cm)}}else{var cutTop=viewCuttingPoint(cm,from,from,-1)\u000avar cutBot=viewCuttingPoint(cm,to,to+lendiff,1)\u000aif(cutTop&&cutBot){display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(cm,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index))\u000adisplay.viewTo+=lendiff}else{resetView(cm)}}\u000avar ext=display.externalMeasured\u000aif(ext){if(to<ext.lineN)\u000a{ext.lineN+=lendiff}\u000aelse if(from<ext.lineN+ext.size)\u000a{display.externalMeasured=null}}}\u000afunction regLineChange(cm,line,type){cm.curOp.viewChanged=true\u000avar display=cm.display,ext=cm.display.externalMeasured\u000aif(ext&&line>=ext.lineN&&line<ext.lineN+ext.size)\u000a{display.externalMeasured=null}\u000aif(line<display.viewFrom||line>=display.viewTo){return}\u000avar lineView=display.view[findViewIndex(cm,line)]\u000aif(lineView.node==null){return}\u000avar arr=lineView.changes||(lineView.changes=[])\u000aif(indexOf(arr,type)==-1){arr.push(type)}}\u000afunction resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first\u000acm.display.view=[]\u000acm.display.viewOffset=0}\u000afunction viewCuttingPoint(cm,oldN,newN,dir){var index=findViewIndex(cm,oldN),diff,view=cm.display.view\u000aif(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size)\u000a{return{index:index,lineN:newN}}\u000avar n=cm.display.viewFrom\u000afor(var i=0;i<index;i++)\u000a{n+=view[i].size}\u000aif(n!=oldN){if(dir>0){if(index==view.length-1){return null}\u000adiff=(n+view[index].size)-oldN\u000aindex++}else{diff=n-oldN}\u000aoldN+=diff;newN+=diff}\u000awhile(visualLineNo(cm.doc,newN)!=newN){if(index==(dir<0?0:view.length-1)){return null}\u000anewN+=dir*view[index-(dir<0?1:0)].size\u000aindex+=dir}\u000areturn{index:index,lineN:newN}}\u000afunction adjustView(cm,from,to){var display=cm.display,view=display.view\u000aif(view.length==0||from>=display.viewTo||to<=display.viewFrom){display.view=buildViewArray(cm,from,to)\u000adisplay.viewFrom=from}else{if(display.viewFrom>from)\u000a{display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view)}\u000aelse if(display.viewFrom<from)\u000a{display.view=display.view.slice(findViewIndex(cm,from))}\u000adisplay.viewFrom=from\u000aif(display.viewTo<to)\u000a{display.view=display.view.concat(buildViewArray(cm,display.viewTo,to))}\u000aelse if(display.viewTo>to)\u000a{display.view=display.view.slice(0,findViewIndex(cm,to))}}\u000adisplay.viewTo=to}\u000afunction countDirtyView(cm){var view=cm.display.view,dirty=0\u000afor(var i=0;i<view.length;i++){var lineView=view[i]\u000aif(!lineView.hidden&&(!lineView.node||lineView.changes)){++dirty}}\u000areturn dirty}\u000afunction startWorker(cm,time){if(cm.doc.highlightFrontier<cm.display.viewTo)\u000a{cm.state.highlight.set(time,bind(highlightWorker,cm))}}\u000afunction highlightWorker(cm){var doc=cm.doc\u000aif(doc.highlightFrontier>=cm.display.viewTo){return}\u000avar end=+new Date+cm.options.workTime\u000avar context=getContextBefore(cm,doc.highlightFrontier)\u000avar changedLines=[]\u000adoc.iter(context.line,Math.min(doc.first+doc.size,cm.display.viewTo+500),function(line){if(context.line>=cm.display.viewFrom){var oldStyles=line.styles\u000avar resetState=line.text.length>cm.options.maxHighlightLength?copyState(doc.mode,context.state):null\u000avar highlighted=highlightLine(cm,line,context,true)\u000aif(resetState){context.state=resetState}\u000aline.styles=highlighted.styles\u000avar oldCls=line.styleClasses,newCls=highlighted.classes\u000aif(newCls){line.styleClasses=newCls}\u000aelse if(oldCls){line.styleClasses=null}\u000avar ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass)\u000afor(var i=0;!ischange&&i<oldStyles.length;++i){ischange=oldStyles[i]!=line.styles[i]}\u000aif(ischange){changedLines.push(context.line)}\u000aline.stateAfter=context.save()\u000acontext.nextLine()}else{if(line.text.length<=cm.options.maxHighlightLength)\u000a{processLine(cm,line.text,context)}\u000aline.stateAfter=context.line%5==0?context.save():null\u000acontext.nextLine()}\u000aif(+new Date>end){startWorker(cm,cm.options.workDelay)\u000areturn true}})\u000adoc.highlightFrontier=context.line\u000adoc.modeFrontier=Math.max(doc.modeFrontier,context.line)\u000aif(changedLines.length){runInOp(cm,function(){for(var i=0;i<changedLines.length;i++)\u000a{regLineChange(cm,changedLines[i],"text")}})}}\u000avar DisplayUpdate=function(cm,viewport,force){var display=cm.display\u000athis.viewport=viewport\u000athis.visible=visibleLines(display,cm.doc,viewport)\u000athis.editorIsHidden=!display.wrapper.offsetWidth\u000athis.wrapperHeight=display.wrapper.clientHeight\u000athis.wrapperWidth=display.wrapper.clientWidth\u000athis.oldDisplayWidth=displayWidth(cm)\u000athis.force=force\u000athis.dims=getDimensions(cm)\u000athis.events=[]};DisplayUpdate.prototype.signal=function(emitter,type){if(hasHandler(emitter,type))\u000a{this.events.push(arguments)}};DisplayUpdate.prototype.finish=function(){var this$1=this;for(var i=0;i<this.events.length;i++)\u000a{signal.apply(null,this$1.events[i])}};function maybeClipScrollbars(cm){var display=cm.display\u000aif(!display.scrollbarsClipped&&display.scroller.offsetWidth){display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth\u000adisplay.heightForcer.style.height=scrollGap(cm)+"px"\u000adisplay.sizer.style.marginBottom=-display.nativeBarWidth+"px"\u000adisplay.sizer.style.borderRightWidth=scrollGap(cm)+"px"\u000adisplay.scrollbarsClipped=true}}\u000afunction selectionSnapshot(cm){if(cm.hasFocus()){return null}\u000avar active=activeElt()\u000aif(!active||!contains(cm.display.lineDiv,active)){return null}\u000avar result={activeElt:active}\u000aif(window.getSelection){var sel=window.getSelection()\u000aif(sel.anchorNode&&sel.extend&&contains(cm.display.lineDiv,sel.anchorNode)){result.anchorNode=sel.anchorNode\u000aresult.anchorOffset=sel.anchorOffset\u000aresult.focusNode=sel.focusNode\u000aresult.focusOffset=sel.focusOffset}}\u000areturn result}\u000afunction restoreSelection(snapshot){if(!snapshot||!snapshot.activeElt||snapshot.activeElt==activeElt()){return}\u000asnapshot.activeElt.focus()\u000aif(snapshot.anchorNode&&contains(document.body,snapshot.anchorNode)&&contains(document.body,snapshot.focusNode)){var sel=window.getSelection(),range=document.createRange()\u000arange.setEnd(snapshot.anchorNode,snapshot.anchorOffset)\u000arange.collapse(false)\u000asel.removeAllRanges()\u000asel.addRange(range)\u000asel.extend(snapshot.focusNode,snapshot.focusOffset)}}\u000afunction updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc\u000aif(update.editorIsHidden){resetView(cm)\u000areturn false}\u000aif(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&countDirtyView(cm)==0)\u000a{return false}\u000aif(maybeUpdateLineNumberWidth(cm)){resetView(cm)\u000aupdate.dims=getDimensions(cm)}\u000avar end=doc.first+doc.size\u000avar from=Math.max(update.visible.from-cm.options.viewportMargin,doc.first)\u000avar to=Math.min(end,update.visible.to+cm.options.viewportMargin)\u000aif(display.viewFrom<from&&from-display.viewFrom<20){from=Math.max(doc.first,display.viewFrom)}\u000aif(display.viewTo>to&&display.viewTo-to<20){to=Math.min(end,display.viewTo)}\u000aif(sawCollapsedSpans){from=visualLineNo(cm.doc,from)\u000ato=visualLineEndNo(cm.doc,to)}\u000avar different=from!=display.viewFrom||to!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth\u000aadjustView(cm,from,to)\u000adisplay.viewOffset=heightAtLine(getLine(cm.doc,display.viewFrom))\u000acm.display.mover.style.top=display.viewOffset+"px"\u000avar toUpdate=countDirtyView(cm)\u000aif(!different&&toUpdate==0&&!update.force&&display.renderedView==display.view&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo))\u000a{return false}\u000avar selSnapshot=selectionSnapshot(cm)\u000aif(toUpdate>4){display.lineDiv.style.display="none"}\u000apatchDisplay(cm,display.updateLineNumbers,update.dims)\u000aif(toUpdate>4){display.lineDiv.style.display=""}\u000adisplay.renderedView=display.view\u000arestoreSelection(selSnapshot)\u000aremoveChildren(display.cursorDiv)\u000aremoveChildren(display.selectionDiv)\u000adisplay.gutters.style.height=display.sizer.style.minHeight=0\u000aif(different){display.lastWrapHeight=update.wrapperHeight\u000adisplay.lastWrapWidth=update.wrapperWidth\u000astartWorker(cm,400)}\u000adisplay.updateLineNumbers=null\u000areturn true}\u000afunction postUpdateDisplay(cm,update){var viewport=update.viewport\u000afor(var first=true;;first=false){if(!first||!cm.options.lineWrapping||update.oldDisplayWidth==displayWidth(cm)){if(viewport&&viewport.top!=null)\u000a{viewport={top:Math.min(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)}}\u000aupdate.visible=visibleLines(cm.display,cm.doc,viewport)\u000aif(update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo)\u000a{break}}\u000aif(!updateDisplayIfNeeded(cm,update)){break}\u000aupdateHeightsInViewport(cm)\u000avar barMeasure=measureForScrollbars(cm)\u000aupdateSelection(cm)\u000aupdateScrollbars(cm,barMeasure)\u000asetDocumentHeight(cm,barMeasure)\u000aupdate.force=false}\u000aupdate.signal(cm,"update",cm)\u000aif(cm.display.viewFrom!=cm.display.reportedViewFrom||cm.display.viewTo!=cm.display.reportedViewTo){update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo)\u000acm.display.reportedViewFrom=cm.display.viewFrom;cm.display.reportedViewTo=cm.display.viewTo}}\u000afunction updateDisplaySimple(cm,viewport){var update=new DisplayUpdate(cm,viewport)\u000aif(updateDisplayIfNeeded(cm,update)){updateHeightsInViewport(cm)\u000apostUpdateDisplay(cm,update)\u000avar barMeasure=measureForScrollbars(cm)\u000aupdateSelection(cm)\u000aupdateScrollbars(cm,barMeasure)\u000asetDocumentHeight(cm,barMeasure)\u000aupdate.finish()}}\u000afunction patchDisplay(cm,updateNumbersFrom,dims){var display=cm.display,lineNumbers=cm.options.lineNumbers\u000avar container=display.lineDiv,cur=container.firstChild\u000afunction rm(node){var next=node.nextSibling\u000aif(webkit&&mac&&cm.display.currentWheelTarget==node)\u000a{node.style.display="none"}\u000aelse\u000a{node.parentNode.removeChild(node)}\u000areturn next}\u000avar view=display.view,lineN=display.viewFrom\u000afor(var i=0;i<view.length;i++){var lineView=view[i]\u000aif(lineView.hidden){}else if(!lineView.node||lineView.node.parentNode!=container){var node=buildLineElement(cm,lineView,lineN,dims)\u000acontainer.insertBefore(node,cur)}else{while(cur!=lineView.node){cur=rm(cur)}\u000avar updateNumber=lineNumbers&&updateNumbersFrom!=null&&updateNumbersFrom<=lineN&&lineView.lineNumber\u000aif(lineView.changes){if(indexOf(lineView.changes,"gutter")>-1){updateNumber=false}\u000aupdateLineForChanges(cm,lineView,lineN,dims)}\u000aif(updateNumber){removeChildren(lineView.lineNumber)\u000alineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)))}\u000acur=lineView.node.nextSibling}\u000alineN+=lineView.size}\u000awhile(cur){cur=rm(cur)}}\u000afunction updateGutterSpace(cm){var width=cm.display.gutters.offsetWidth\u000acm.display.sizer.style.marginLeft=width+"px"}\u000afunction setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px"\u000acm.display.heightForcer.style.top=measure.docHeight+"px"\u000acm.display.gutters.style.height=(measure.docHeight+cm.display.barHeight+scrollGap(cm))+"px"}\u000afunction updateGutters(cm){var gutters=cm.display.gutters,specs=cm.options.gutters\u000aremoveChildren(gutters)\u000avar i=0\u000afor(;i<specs.length;++i){var gutterClass=specs[i]\u000avar gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+gutterClass))\u000aif(gutterClass=="CodeMirror-linenumbers"){cm.display.lineGutter=gElt\u000agElt.style.width=(cm.display.lineNumWidth||1)+"px"}}\u000agutters.style.display=i?"":"none"\u000aupdateGutterSpace(cm)}\u000afunction setGuttersForLineNumbers(options){var found=indexOf(options.gutters,"CodeMirror-linenumbers")\u000aif(found==-1&&options.lineNumbers){options.gutters=options.gutters.concat(["CodeMirror-linenumbers"])}else if(found>-1&&!options.lineNumbers){options.gutters=options.gutters.slice(0)\u000aoptions.gutters.splice(found,1)}}\u000avar wheelSamples=0;var wheelPixelsPerUnit=null;if(ie){wheelPixelsPerUnit=-.53}\u000aelse if(gecko){wheelPixelsPerUnit=15}\u000aelse if(chrome){wheelPixelsPerUnit=-.7}\u000aelse if(safari){wheelPixelsPerUnit=-1/3}\u000afunction wheelEventDelta(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY\u000aif(dx==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS){dx=e.detail}\u000aif(dy==null&&e.detail&&e.axis==e.VERTICAL_AXIS){dy=e.detail}\u000aelse if(dy==null){dy=e.wheelDelta}\u000areturn{x:dx,y:dy}}\u000afunction wheelEventPixels(e){var delta=wheelEventDelta(e)\u000adelta.x*=wheelPixelsPerUnit\u000adelta.y*=wheelPixelsPerUnit\u000areturn delta}\u000afunction onScrollWheel(cm,e){var delta=wheelEventDelta(e),dx=delta.x,dy=delta.y\u000avar display=cm.display,scroll=display.scroller\u000avar canScrollX=scroll.scrollWidth>scroll.clientWidth\u000avar canScrollY=scroll.scrollHeight>scroll.clientHeight\u000aif(!(dx&&canScrollX||dy&&canScrollY)){return}\u000aif(dy&&mac&&webkit){outer:for(var cur=e.target,view=display.view;cur!=scroll;cur=cur.parentNode){for(var i=0;i<view.length;i++){if(view[i].node==cur){cm.display.currentWheelTarget=cur\u000abreak outer}}}}\u000aif(dx&&!gecko&&!presto&&wheelPixelsPerUnit!=null){if(dy&&canScrollY)\u000a{updateScrollTop(cm,Math.max(0,scroll.scrollTop+dy*wheelPixelsPerUnit))}\u000asetScrollLeft(cm,Math.max(0,scroll.scrollLeft+dx*wheelPixelsPerUnit))\u000aif(!dy||(dy&&canScrollY))\u000a{e_preventDefault(e)}\u000adisplay.wheelStartX=null\u000areturn}\u000aif(dy&&wheelPixelsPerUnit!=null){var pixels=dy*wheelPixelsPerUnit\u000avar top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight\u000aif(pixels<0){top=Math.max(0,top+pixels-50)}\u000aelse{bot=Math.min(cm.doc.height,bot+pixels+50)}\u000aupdateDisplaySimple(cm,{top:top,bottom:bot})}\u000aif(wheelSamples<20){if(display.wheelStartX==null){display.wheelStartX=scroll.scrollLeft;display.wheelStartY=scroll.scrollTop\u000adisplay.wheelDX=dx;display.wheelDY=dy\u000asetTimeout(function(){if(display.wheelStartX==null){return}\u000avar movedX=scroll.scrollLeft-display.wheelStartX\u000avar movedY=scroll.scrollTop-display.wheelStartY\u000avar sample=(movedY&&display.wheelDY&&movedY/display.wheelDY)||(movedX&&display.wheelDX&&movedX/display.wheelDX)\u000adisplay.wheelStartX=display.wheelStartY=null\u000aif(!sample){return}\u000awheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1)\u000a++wheelSamples},200)}else{display.wheelDX+=dx;display.wheelDY+=dy}}}\u000avar Selection=function(ranges,primIndex){this.ranges=ranges\u000athis.primIndex=primIndex};Selection.prototype.primary=function(){return this.ranges[this.primIndex]};Selection.prototype.equals=function(other){var this$1=this;if(other==this){return true}\u000aif(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length){return false}\u000afor(var i=0;i<this.ranges.length;i++){var here=this$1.ranges[i],there=other.ranges[i]\u000aif(!equalCursorPos(here.anchor,there.anchor)||!equalCursorPos(here.head,there.head)){return false}}\u000areturn true};Selection.prototype.deepCopy=function(){var this$1=this;var out=[]\u000afor(var i=0;i<this.ranges.length;i++)\u000a{out[i]=new Range(copyPos(this$1.ranges[i].anchor),copyPos(this$1.ranges[i].head))}\u000areturn new Selection(out,this.primIndex)};Selection.prototype.somethingSelected=function(){var this$1=this;for(var i=0;i<this.ranges.length;i++)\u000a{if(!this$1.ranges[i].empty()){return true}}\u000areturn false};Selection.prototype.contains=function(pos,end){var this$1=this;if(!end){end=pos}\u000afor(var i=0;i<this.ranges.length;i++){var range=this$1.ranges[i]\u000aif(cmp(end,range.from())>=0&&cmp(pos,range.to())<=0)\u000a{return i}}\u000areturn-1};var Range=function(anchor,head){this.anchor=anchor;this.head=head};Range.prototype.from=function(){return minPos(this.anchor,this.head)};Range.prototype.to=function(){return maxPos(this.anchor,this.head)};Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function normalizeSelection(ranges,primIndex){var prim=ranges[primIndex]\u000aranges.sort(function(a,b){return cmp(a.from(),b.from());})\u000aprimIndex=indexOf(ranges,prim)\u000afor(var i=1;i<ranges.length;i++){var cur=ranges[i],prev=ranges[i-1]\u000aif(cmp(prev.to(),cur.from())>=0){var from=minPos(prev.from(),cur.from()),to=maxPos(prev.to(),cur.to())\u000avar inv=prev.empty()?cur.from()==cur.head:prev.from()==prev.head\u000aif(i<=primIndex){--primIndex}\u000aranges.splice(--i,2,new Range(inv?to:from,inv?from:to))}}\u000areturn new Selection(ranges,primIndex)}\u000afunction simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0)}\u000afunction changeEnd(change){if(!change.text){return change.to}\u000areturn Pos(change.from.line+change.text.length-1,lst(change.text).length+(change.text.length==1?change.from.ch:0))}\u000afunction adjustForChange(pos,change){if(cmp(pos,change.from)<0){return pos}\u000aif(cmp(pos,change.to)<=0){return changeEnd(change)}\u000avar line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch\u000aif(pos.line==change.to.line){ch+=changeEnd(change).ch-change.to.ch}\u000areturn Pos(line,ch)}\u000afunction computeSelAfterChange(doc,change){var out=[]\u000afor(var i=0;i<doc.sel.ranges.length;i++){var range=doc.sel.ranges[i]\u000aout.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)))}\u000areturn normalizeSelection(out,doc.sel.primIndex)}\u000afunction offsetPos(pos,old,nw){if(pos.line==old.line)\u000a{return Pos(nw.line,pos.ch-old.ch+nw.ch)}\u000aelse\u000a{return Pos(nw.line+(pos.line-old.line),pos.ch)}}\u000afunction computeReplacedSel(doc,changes,hint){var out=[]\u000avar oldPrev=Pos(doc.first,0),newPrev=oldPrev\u000afor(var i=0;i<changes.length;i++){var change=changes[i]\u000avar from=offsetPos(change.from,oldPrev,newPrev)\u000avar to=offsetPos(changeEnd(change),oldPrev,newPrev)\u000aoldPrev=change.to\u000anewPrev=to\u000aif(hint=="around"){var range=doc.sel.ranges[i],inv=cmp(range.head,range.anchor)<0\u000aout[i]=new Range(inv?to:from,inv?from:to)}else{out[i]=new Range(from,from)}}\u000areturn new Selection(out,doc.sel.primIndex)}\u000afunction loadMode(cm){cm.doc.mode=getMode(cm.options,cm.doc.modeOption)\u000aresetModeState(cm)}\u000afunction resetModeState(cm){cm.doc.iter(function(line){if(line.stateAfter){line.stateAfter=null}\u000aif(line.styles){line.styles=null}})\u000acm.doc.modeFrontier=cm.doc.highlightFrontier=cm.doc.first\u000astartWorker(cm,100)\u000acm.state.modeGen++\u000aif(cm.curOp){regChange(cm)}}\u000afunction isWholeLineUpdate(doc,change){return change.from.ch==0&&change.to.ch==0&&lst(change.text)==""&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore)}\u000afunction updateDoc(doc,change,markedSpans,estimateHeight){function spansFor(n){return markedSpans?markedSpans[n]:null}\u000afunction update(line,text,spans){updateLine(line,text,spans,estimateHeight)\u000asignalLater(line,"change",line,change)}\u000afunction linesFor(start,end){var result=[]\u000afor(var i=start;i<end;++i)\u000a{result.push(new Line(text[i],spansFor(i),estimateHeight))}\u000areturn result}\u000avar from=change.from,to=change.to,text=change.text\u000avar firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line)\u000avar lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line\u000aif(change.full){doc.insert(0,linesFor(0,text.length))\u000adoc.remove(text.length,doc.size-text.length)}else if(isWholeLineUpdate(doc,change)){var added=linesFor(0,text.length-1)\u000aupdate(lastLine,lastLine.text,lastSpans)\u000aif(nlines){doc.remove(from.line,nlines)}\u000aif(added.length){doc.insert(from.line,added)}}else if(firstLine==lastLine){if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans)}else{var added$1=linesFor(1,text.length-1)\u000aadded$1.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight))\u000aupdate(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0))\u000adoc.insert(from.line+1,added$1)}}else if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0))\u000adoc.remove(from.line+1,nlines)}else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0))\u000aupdate(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans)\u000avar added$2=linesFor(1,text.length-1)\u000aif(nlines>1){doc.remove(from.line+1,nlines-1)}\u000adoc.insert(from.line+1,added$2)}\u000asignalLater(doc,"change",doc,change)}\u000afunction linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked){for(var i=0;i<doc.linked.length;++i){var rel=doc.linked[i]\u000aif(rel.doc==skip){continue}\u000avar shared=sharedHist&&rel.sharedHist\u000aif(sharedHistOnly&&!shared){continue}\u000af(rel.doc,shared)\u000apropagate(rel.doc,doc,shared)}}}\u000apropagate(doc,null,true)}\u000afunction attachDoc(cm,doc){if(doc.cm){throw new Error("This document is already in use.")}\u000acm.doc=doc\u000adoc.cm=cm\u000aestimateLineHeights(cm)\u000aloadMode(cm)\u000asetDirectionClass(cm)\u000aif(!cm.options.lineWrapping){findMaxLine(cm)}\u000acm.options.mode=doc.modeOption\u000aregChange(cm)}\u000afunction setDirectionClass(cm){;(cm.doc.direction=="rtl"?addClass:rmClass)(cm.display.lineDiv,"CodeMirror-rtl")}\u000afunction directionChanged(cm){runInOp(cm,function(){setDirectionClass(cm)\u000aregChange(cm)})}\u000afunction History(startGen){this.done=[];this.undone=[]\u000athis.undoDepth=Infinity\u000athis.lastModTime=this.lastSelTime=0\u000athis.lastOp=this.lastSelOp=null\u000athis.lastOrigin=this.lastSelOrigin=null\u000athis.generation=this.maxGeneration=startGen||1}\u000afunction historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)}\u000aattachLocalSpans(doc,histChange,change.from.line,change.to.line+1)\u000alinkedDocs(doc,function(doc){return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);},true)\u000areturn histChange}\u000afunction clearSelectionEvents(array){while(array.length){var last=lst(array)\u000aif(last.ranges){array.pop()}\u000aelse{break}}}\u000afunction lastChangeEvent(hist,force){if(force){clearSelectionEvents(hist.done)\u000areturn lst(hist.done)}else if(hist.done.length&&!lst(hist.done).ranges){return lst(hist.done)}else if(hist.done.length>1&&!hist.done[hist.done.length-2].ranges){hist.done.pop()\u000areturn lst(hist.done)}}\u000afunction addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history\u000ahist.undone.length=0\u000avar time=+new Date,cur\u000avar last\u000aif((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&((change.origin.charAt(0)=="+"&&doc.cm&&hist.lastModTime>time-doc.cm.options.historyEventDelay)||change.origin.charAt(0)=="*"))&&(cur=lastChangeEvent(hist,hist.lastOp==opId))){last=lst(cur.changes)\u000aif(cmp(change.from,change.to)==0&&cmp(change.from,last.to)==0){last.to=changeEnd(change)}else{cur.changes.push(historyChangeFromChange(doc,change))}}else{var before=lst(hist.done)\u000aif(!before||!before.ranges)\u000a{pushSelectionToHistory(doc.sel,hist.done)}\u000acur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation}\u000ahist.done.push(cur)\u000awhile(hist.done.length>hist.undoDepth){hist.done.shift()\u000aif(!hist.done[0].ranges){hist.done.shift()}}}\u000ahist.done.push(selAfter)\u000ahist.generation=++hist.maxGeneration\u000ahist.lastModTime=hist.lastSelTime=time\u000ahist.lastOp=hist.lastSelOp=opId\u000ahist.lastOrigin=hist.lastSelOrigin=change.origin\u000aif(!last){signal(doc,"historyAdded")}}\u000afunction selectionEventCanBeMerged(doc,origin,prev,sel){var ch=origin.charAt(0)\u000areturn ch=="*"||ch=="+"&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500)}\u000afunction addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin\u000aif(opId==hist.lastSelOp||(origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||selectionEventCanBeMerged(doc,origin,lst(hist.done),sel))))\u000a{hist.done[hist.done.length-1]=sel}\u000aelse\u000a{pushSelectionToHistory(sel,hist.done)}\u000ahist.lastSelTime=+new Date\u000ahist.lastSelOrigin=origin\u000ahist.lastSelOp=opId\u000aif(options&&options.clearRedo!==false)\u000a{clearSelectionEvents(hist.undone)}}\u000afunction pushSelectionToHistory(sel,dest){var top=lst(dest)\u000aif(!(top&&top.ranges&&top.equals(sel)))\u000a{dest.push(sel)}}\u000afunction attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0\u000adoc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){if(line.markedSpans)\u000a{(existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans}\u000a++n})}\u000afunction removeClearedSpans(spans){if(!spans){return null}\u000avar out\u000afor(var i=0;i<spans.length;++i){if(spans[i].marker.explicitlyCleared){if(!out){out=spans.slice(0,i)}}\u000aelse if(out){out.push(spans[i])}}\u000areturn!out?spans:out.length?out:null}\u000afunction getOldSpans(doc,change){var found=change["spans_"+doc.id]\u000aif(!found){return null}\u000avar nw=[]\u000afor(var i=0;i<change.text.length;++i)\u000a{nw.push(removeClearedSpans(found[i]))}\u000areturn nw}\u000afunction mergeOldSpans(doc,change){var old=getOldSpans(doc,change)\u000avar stretched=stretchSpansOverChange(doc,change)\u000aif(!old){return stretched}\u000aif(!stretched){return old}\u000afor(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i]\u000aif(oldCur&&stretchCur){spans:for(var j=0;j<stretchCur.length;++j){var span=stretchCur[j]\u000afor(var k=0;k<oldCur.length;++k)\u000a{if(oldCur[k].marker==span.marker){continue spans}}\u000aoldCur.push(span)}}else if(stretchCur){old[i]=stretchCur}}\u000areturn old}\u000afunction copyHistoryArray(events,newGroup,instantiateSel){var copy=[]\u000afor(var i=0;i<events.length;++i){var event=events[i]\u000aif(event.ranges){copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event)\u000acontinue}\u000avar changes=event.changes,newChanges=[]\u000acopy.push({changes:newChanges})\u000afor(var j=0;j<changes.length;++j){var change=changes[j],m=(void 0)\u000anewChanges.push({from:change.from,to:change.to,text:change.text})\u000aif(newGroup){for(var prop in change){if(m=prop.match(/^spans_(\u005cd+)$/)){if(indexOf(newGroup,Number(m[1]))>-1){lst(newChanges)[prop]=change[prop]\u000adelete change[prop]}}}}}}\u000areturn copy}\u000afunction extendRange(range,head,other,extend){if(extend){var anchor=range.anchor\u000aif(other){var posBefore=cmp(head,anchor)<0\u000aif(posBefore!=(cmp(other,anchor)<0)){anchor=head\u000ahead=other}else if(posBefore!=(cmp(head,other)<0)){head=other}}\u000areturn new Range(anchor,head)}else{return new Range(other||head,head)}}\u000afunction extendSelection(doc,head,other,options,extend){if(extend==null){extend=doc.cm&&(doc.cm.display.shift||doc.extend)}\u000asetSelection(doc,new Selection([extendRange(doc.sel.primary(),head,other,extend)],0),options)}\u000afunction extendSelections(doc,heads,options){var out=[]\u000avar extend=doc.cm&&(doc.cm.display.shift||doc.extend)\u000afor(var i=0;i<doc.sel.ranges.length;i++)\u000a{out[i]=extendRange(doc.sel.ranges[i],heads[i],null,extend)}\u000avar newSel=normalizeSelection(out,doc.sel.primIndex)\u000asetSelection(doc,newSel,options)}\u000afunction replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0)\u000aranges[i]=range\u000asetSelection(doc,normalizeSelection(ranges,doc.sel.primIndex),options)}\u000afunction setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options)}\u000afunction filterSelectionChange(doc,sel,options){var obj={ranges:sel.ranges,update:function(ranges){var this$1=this;this.ranges=[]\u000afor(var i=0;i<ranges.length;i++)\u000a{this$1.ranges[i]=new Range(clipPos(doc,ranges[i].anchor),clipPos(doc,ranges[i].head))}},origin:options&&options.origin}\u000asignal(doc,"beforeSelectionChange",doc,obj)\u000aif(doc.cm){signal(doc.cm,"beforeSelectionChange",doc.cm,obj)}\u000aif(obj.ranges!=sel.ranges){return normalizeSelection(obj.ranges,obj.ranges.length-1)}\u000aelse{return sel}}\u000afunction setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done)\u000aif(last&&last.ranges){done[done.length-1]=sel\u000asetSelectionNoUndo(doc,sel,options)}else{setSelection(doc,sel,options)}}\u000afunction setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options)\u000aaddSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options)}\u000afunction setSelectionNoUndo(doc,sel,options){if(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange"))\u000a{sel=filterSelectionChange(doc,sel,options)}\u000avar bias=options&&options.bias||(cmp(sel.primary().head,doc.sel.primary().head)<0?-1:1)\u000asetSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,true))\u000aif(!(options&&options.scroll===false)&&doc.cm)\u000a{ensureCursorVisible(doc.cm)}}\u000afunction setSelectionInner(doc,sel){if(sel.equals(doc.sel)){return}\u000adoc.sel=sel\u000aif(doc.cm){doc.cm.curOp.updateInput=doc.cm.curOp.selectionChanged=true\u000asignalCursorActivity(doc.cm)}\u000asignalLater(doc,"cursorActivity",doc)}\u000afunction reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,false))}\u000afunction skipAtomicInSelection(doc,sel,bias,mayClear){var out\u000afor(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i]\u000avar old=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i]\u000avar newAnchor=skipAtomic(doc,range.anchor,old&&old.anchor,bias,mayClear)\u000avar newHead=skipAtomic(doc,range.head,old&&old.head,bias,mayClear)\u000aif(out||newAnchor!=range.anchor||newHead!=range.head){if(!out){out=sel.ranges.slice(0,i)}\u000aout[i]=new Range(newAnchor,newHead)}}\u000areturn out?normalizeSelection(out,sel.primIndex):sel}\u000afunction skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line)\u000aif(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker\u000aif((sp.from==null||(m.inclusiveLeft?sp.from<=pos.ch:sp.from<pos.ch))&&(sp.to==null||(m.inclusiveRight?sp.to>=pos.ch:sp.to>pos.ch))){if(mayClear){signal(m,"beforeCursorEnter")\u000aif(m.explicitlyCleared){if(!line.markedSpans){break}\u000aelse{--i;continue}}}\u000aif(!m.atomic){continue}\u000aif(oldPos){var near=m.find(dir<0?1:-1),diff=(void 0)\u000aif(dir<0?m.inclusiveRight:m.inclusiveLeft)\u000a{near=movePos(doc,near,-dir,near&&near.line==pos.line?line:null)}\u000aif(near&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(dir<0?diff<0:diff>0))\u000a{return skipAtomicInner(doc,near,pos,dir,mayClear)}}\u000avar far=m.find(dir<0?-1:1)\u000aif(dir<0?m.inclusiveLeft:m.inclusiveRight)\u000a{far=movePos(doc,far,dir,far.line==pos.line?line:null)}\u000areturn far?skipAtomicInner(doc,far,pos,dir,mayClear):null}}}\u000areturn pos}\u000afunction skipAtomic(doc,pos,oldPos,bias,mayClear){var dir=bias||1\u000avar found=skipAtomicInner(doc,pos,oldPos,dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,dir,true))||skipAtomicInner(doc,pos,oldPos,-dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,-dir,true))\u000aif(!found){doc.cantEdit=true\u000areturn Pos(doc.first,0)}\u000areturn found}\u000afunction movePos(doc,pos,dir,line){if(dir<0&&pos.ch==0){if(pos.line>doc.first){return clipPos(doc,Pos(pos.line-1))}\u000aelse{return null}}else if(dir>0&&pos.ch==(line||getLine(doc,pos.line)).text.length){if(pos.line<doc.first+doc.size-1){return Pos(pos.line+1,0)}\u000aelse{return null}}else{return new Pos(pos.line,pos.ch+dir)}}\u000afunction selectAll(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll)}\u000afunction filterChange(doc,change,update){var obj={canceled:false,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){return obj.canceled=true;}}\u000aif(update){obj.update=function(from,to,text,origin){if(from){obj.from=clipPos(doc,from)}\u000aif(to){obj.to=clipPos(doc,to)}\u000aif(text){obj.text=text}\u000aif(origin!==undefined){obj.origin=origin}}}\u000asignal(doc,"beforeChange",doc,obj)\u000aif(doc.cm){signal(doc.cm,"beforeChange",doc.cm,obj)}\u000aif(obj.canceled){return null}\u000areturn{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}\u000afunction makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp){return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly)}\u000aif(doc.cm.state.suppressEdits){return}}\u000aif(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange")){change=filterChange(doc,change,true)\u000aif(!change){return}}\u000avar split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to)\u000aif(split){for(var i=split.length-1;i>=0;--i)\u000a{makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text,origin:change.origin})}}else{makeChangeInner(doc,change)}}\u000afunction makeChangeInner(doc,change){if(change.text.length==1&&change.text[0]==""&&cmp(change.from,change.to)==0){return}\u000avar selAfter=computeSelAfterChange(doc,change)\u000aaddChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN)\u000amakeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change))\u000avar rebased=[]\u000alinkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change)\u000arebased.push(doc.history)}\u000amakeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change))})}\u000afunction makeChangeFromHistory(doc,type,allowSelectionOnly){if(doc.cm&&doc.cm.state.suppressEdits&&!allowSelectionOnly){return}\u000avar hist=doc.history,event,selAfter=doc.sel\u000avar source=type=="undo"?hist.done:hist.undone,dest=type=="undo"?hist.undone:hist.done\u000avar i=0\u000afor(;i<source.length;i++){event=source[i]\u000aif(allowSelectionOnly?event.ranges&&!event.equals(doc.sel):!event.ranges)\u000a{break}}\u000aif(i==source.length){return}\u000ahist.lastOrigin=hist.lastSelOrigin=null\u000afor(;;){event=source.pop()\u000aif(event.ranges){pushSelectionToHistory(event,dest)\u000aif(allowSelectionOnly&&!event.equals(doc.sel)){setSelection(doc,event,{clearRedo:false})\u000areturn}\u000aselAfter=event}\u000aelse{break}}\u000avar antiChanges=[]\u000apushSelectionToHistory(selAfter,dest)\u000adest.push({changes:antiChanges,generation:hist.generation})\u000ahist.generation=event.generation||++hist.maxGeneration\u000avar filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange")\u000avar loop=function(i){var change=event.changes[i]\u000achange.origin=type\u000aif(filter&&!filterChange(doc,change,false)){source.length=0\u000areturn{}}\u000aantiChanges.push(historyChangeFromChange(doc,change))\u000avar after=i?computeSelAfterChange(doc,change):lst(source)\u000amakeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change))\u000aif(!i&&doc.cm){doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)})}\u000avar rebased=[]\u000alinkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change)\u000arebased.push(doc.history)}\u000amakeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change))})};for(var i$1=event.changes.length-1;i$1>=0;--i$1){var returned=loop(i$1);if(returned)return returned.v;}}\u000afunction shiftDoc(doc,distance){if(distance==0){return}\u000adoc.first+=distance\u000adoc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch));}),doc.sel.primIndex)\u000aif(doc.cm){regChange(doc.cm,doc.first,doc.first-distance,distance)\u000afor(var d=doc.cm.display,l=d.viewFrom;l<d.viewTo;l++)\u000a{regLineChange(doc.cm,l,"gutter")}}}\u000afunction makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp)\u000a{return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans)}\u000aif(change.to.line<doc.first){shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line))\u000areturn}\u000aif(change.from.line>doc.lastLine()){return}\u000aif(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line)\u000ashiftDoc(doc,shift)\u000achange={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin}}\u000avar last=doc.lastLine()\u000aif(change.to.line>last){change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin}}\u000achange.removed=getBetween(doc,change.from,change.to)\u000aif(!selAfter){selAfter=computeSelAfterChange(doc,change)}\u000aif(doc.cm){makeChangeSingleDocInEditor(doc.cm,change,spans)}\u000aelse{updateDoc(doc,change,spans)}\u000asetSelectionNoUndo(doc,selAfter,sel_dontScroll)}\u000afunction makeChangeSingleDocInEditor(cm,change,spans){var doc=cm.doc,display=cm.display,from=change.from,to=change.to\u000avar recomputeMaxLength=false,checkWidthStart=from.line\u000aif(!cm.options.lineWrapping){checkWidthStart=lineNo(visualLine(getLine(doc,from.line)))\u000adoc.iter(checkWidthStart,to.line+1,function(line){if(line==display.maxLine){recomputeMaxLength=true\u000areturn true}})}\u000aif(doc.sel.contains(change.from,change.to)>-1)\u000a{signalCursorActivity(cm)}\u000aupdateDoc(doc,change,spans,estimateHeight(cm))\u000aif(!cm.options.lineWrapping){doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(line)\u000aif(len>display.maxLineLength){display.maxLine=line\u000adisplay.maxLineLength=len\u000adisplay.maxLineChanged=true\u000arecomputeMaxLength=false}})\u000aif(recomputeMaxLength){cm.curOp.updateMaxLine=true}}\u000aretreatFrontier(doc,from.line)\u000astartWorker(cm,400)\u000avar lendiff=change.text.length-(to.line-from.line)-1\u000aif(change.full)\u000a{regChange(cm)}\u000aelse if(from.line==to.line&&change.text.length==1&&!isWholeLineUpdate(cm.doc,change))\u000a{regLineChange(cm,from.line,"text")}\u000aelse\u000a{regChange(cm,from.line,to.line+1,lendiff)}\u000avar changesHandler=hasHandler(cm,"changes"),changeHandler=hasHandler(cm,"change")\u000aif(changeHandler||changesHandler){var obj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin}\u000aif(changeHandler){signalLater(cm,"change",cm,obj)}\u000aif(changesHandler){(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj)}}\u000acm.display.selForContextMenu=null}\u000afunction replaceRange(doc,code,from,to,origin){if(!to){to=from}\u000aif(cmp(to,from)<0){var assign;(assign=[to,from],from=assign[0],to=assign[1],assign)}\u000aif(typeof code=="string"){code=doc.splitLines(code)}\u000amakeChange(doc,{from:from,to:to,text:code,origin:origin})}\u000afunction rebaseHistSelSingle(pos,from,to,diff){if(to<pos.line){pos.line+=diff}else if(from<pos.line){pos.line=from\u000apos.ch=0}}\u000afunction rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){var sub=array[i],ok=true\u000aif(sub.ranges){if(!sub.copied){sub=array[i]=sub.deepCopy();sub.copied=true}\u000afor(var j=0;j<sub.ranges.length;j++){rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff)\u000arebaseHistSelSingle(sub.ranges[j].head,from,to,diff)}\u000acontinue}\u000afor(var j$1=0;j$1<sub.changes.length;++j$1){var cur=sub.changes[j$1]\u000aif(to<cur.from.line){cur.from=Pos(cur.from.line+diff,cur.from.ch)\u000acur.to=Pos(cur.to.line+diff,cur.to.ch)}else if(from<=cur.to.line){ok=false\u000abreak}}\u000aif(!ok){array.splice(0,i+1)\u000ai=0}}}\u000afunction rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1\u000arebaseHistArray(hist.done,from,to,diff)\u000arebaseHistArray(hist.undone,from,to,diff)}\u000afunction changeLine(doc,handle,changeType,op){var no=handle,line=handle\u000aif(typeof handle=="number"){line=getLine(doc,clipLine(doc,handle))}\u000aelse{no=lineNo(handle)}\u000aif(no==null){return null}\u000aif(op(line,no)&&doc.cm){regLineChange(doc.cm,no,changeType)}\u000areturn line}\u000afunction LeafChunk(lines){var this$1=this;this.lines=lines\u000athis.parent=null\u000avar height=0\u000afor(var i=0;i<lines.length;++i){lines[i].parent=this$1\u000aheight+=lines[i].height}\u000athis.height=height}\u000aLeafChunk.prototype={chunkSize:function chunkSize(){return this.lines.length},removeInner:function removeInner(at,n){var this$1=this;for(var i=at,e=at+n;i<e;++i){var line=this$1.lines[i]\u000athis$1.height-=line.height\u000acleanUpLine(line)\u000asignalLater(line,"delete")}\u000athis.lines.splice(at,n)},collapse:function collapse(lines){lines.push.apply(lines,this.lines)},insertInner:function insertInner(at,lines,height){var this$1=this;this.height+=height\u000athis.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at))\u000afor(var i=0;i<lines.length;++i){lines[i].parent=this$1}},iterN:function iterN(at,n,op){var this$1=this;for(var e=at+n;at<e;++at)\u000a{if(op(this$1.lines[at])){return true}}}}\u000afunction BranchChunk(children){var this$1=this;this.children=children\u000avar size=0,height=0\u000afor(var i=0;i<children.length;++i){var ch=children[i]\u000asize+=ch.chunkSize();height+=ch.height\u000ach.parent=this$1}\u000athis.size=size\u000athis.height=height\u000athis.parent=null}\u000aBranchChunk.prototype={chunkSize:function chunkSize(){return this.size},removeInner:function removeInner(at,n){var this$1=this;this.size-=n\u000afor(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize()\u000aif(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height\u000achild.removeInner(at,rm)\u000athis$1.height-=oldHeight-child.height\u000aif(sz==rm){this$1.children.splice(i--,1);child.parent=null}\u000aif((n-=rm)==0){break}\u000aat=0}else{at-=sz}}\u000aif(this.size-n<25&&(this.children.length>1||!(this.children[0]instanceof LeafChunk))){var lines=[]\u000athis.collapse(lines)\u000athis.children=[new LeafChunk(lines)]\u000athis.children[0].parent=this}},collapse:function collapse(lines){var this$1=this;for(var i=0;i<this.children.length;++i){this$1.children[i].collapse(lines)}},insertInner:function insertInner(at,lines,height){var this$1=this;this.size+=lines.length\u000athis.height+=height\u000afor(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize()\u000aif(at<=sz){child.insertInner(at,lines,height)\u000aif(child.lines&&child.lines.length>50){var remaining=child.lines.length%25+25\u000afor(var pos=remaining;pos<child.lines.length;){var leaf=new LeafChunk(child.lines.slice(pos,pos+=25))\u000achild.height-=leaf.height\u000athis$1.children.splice(++i,0,leaf)\u000aleaf.parent=this$1}\u000achild.lines=child.lines.slice(0,remaining)\u000athis$1.maybeSpill()}\u000abreak}\u000aat-=sz}},maybeSpill:function maybeSpill(){if(this.children.length<=10){return}\u000avar me=this\u000ado{var spilled=me.children.splice(me.children.length-5,5)\u000avar sibling=new BranchChunk(spilled)\u000aif(!me.parent){var copy=new BranchChunk(me.children)\u000acopy.parent=me\u000ame.children=[copy,sibling]\u000ame=copy}else{me.size-=sibling.size\u000ame.height-=sibling.height\u000avar myIndex=indexOf(me.parent.children,me)\u000ame.parent.children.splice(myIndex+1,0,sibling)}\u000asibling.parent=me.parent}while(me.children.length>10)\u000ame.parent.maybeSpill()},iterN:function iterN(at,n,op){var this$1=this;for(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize()\u000aif(at<sz){var used=Math.min(n,sz-at)\u000aif(child.iterN(at,used,op)){return true}\u000aif((n-=used)==0){break}\u000aat=0}else{at-=sz}}}}\u000avar LineWidget=function(doc,node,options){var this$1=this;if(options){for(var opt in options){if(options.hasOwnProperty(opt))\u000a{this$1[opt]=options[opt]}}}\u000athis.doc=doc\u000athis.node=node};LineWidget.prototype.clear=function(){var this$1=this;var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line)\u000aif(no==null||!ws){return}\u000afor(var i=0;i<ws.length;++i){if(ws[i]==this$1){ws.splice(i--,1)}}\u000aif(!ws.length){line.widgets=null}\u000avar height=widgetHeight(this)\u000aupdateLineHeight(line,Math.max(0,line.height-height))\u000aif(cm){runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height)\u000aregLineChange(cm,no,"widget")})\u000asignalLater(cm,"lineWidgetCleared",cm,this,no)}};LineWidget.prototype.changed=function(){var this$1=this;var oldH=this.height,cm=this.doc.cm,line=this.line\u000athis.height=null\u000avar diff=widgetHeight(this)-oldH\u000aif(!diff){return}\u000aupdateLineHeight(line,line.height+diff)\u000aif(cm){runInOp(cm,function(){cm.curOp.forceUpdate=true\u000aadjustScrollWhenAboveVisible(cm,line,diff)\u000asignalLater(cm,"lineWidgetChanged",cm,this$1,lineNo(line))})}};eventMixin(LineWidget)\u000afunction adjustScrollWhenAboveVisible(cm,line,diff){if(heightAtLine(line)<((cm.curOp&&cm.curOp.scrollTop)||cm.doc.scrollTop))\u000a{addToScrollTop(cm,diff)}}\u000afunction addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options)\u000avar cm=doc.cm\u000aif(cm&&widget.noHScroll){cm.display.alignWidgets=true}\u000achangeLine(doc,handle,"widget",function(line){var widgets=line.widgets||(line.widgets=[])\u000aif(widget.insertAt==null){widgets.push(widget)}\u000aelse{widgets.splice(Math.min(widgets.length-1,Math.max(0,widget.insertAt)),0,widget)}\u000awidget.line=line\u000aif(cm&&!lineIsHidden(doc,line)){var aboveVisible=heightAtLine(line)<doc.scrollTop\u000aupdateLineHeight(line,line.height+widgetHeight(widget))\u000aif(aboveVisible){addToScrollTop(cm,widget.height)}\u000acm.curOp.forceUpdate=true}\u000areturn true})\u000asignalLater(cm,"lineWidgetAdded",cm,widget,typeof handle=="number"?handle:lineNo(handle))\u000areturn widget}\u000avar nextMarkerId=0\u000avar TextMarker=function(doc,type){this.lines=[]\u000athis.type=type\u000athis.doc=doc\u000athis.id=++nextMarkerId};TextMarker.prototype.clear=function(){var this$1=this;if(this.explicitlyCleared){return}\u000avar cm=this.doc.cm,withOp=cm&&!cm.curOp\u000aif(withOp){startOperation(cm)}\u000aif(hasHandler(this,"clear")){var found=this.find()\u000aif(found){signalLater(this,"clear",found.from,found.to)}}\u000avar min=null,max=null\u000afor(var i=0;i<this.lines.length;++i){var line=this$1.lines[i]\u000avar span=getMarkedSpanFor(line.markedSpans,this$1)\u000aif(cm&&!this$1.collapsed){regLineChange(cm,lineNo(line),"text")}\u000aelse if(cm){if(span.to!=null){max=lineNo(line)}\u000aif(span.from!=null){min=lineNo(line)}}\u000aline.markedSpans=removeMarkedSpan(line.markedSpans,span)\u000aif(span.from==null&&this$1.collapsed&&!lineIsHidden(this$1.doc,line)&&cm)\u000a{updateLineHeight(line,textHeight(cm.display))}}\u000aif(cm&&this.collapsed&&!cm.options.lineWrapping){for(var i$1=0;i$1<this.lines.length;++i$1){var visual=visualLine(this$1.lines[i$1]),len=lineLength(visual)\u000aif(len>cm.display.maxLineLength){cm.display.maxLine=visual\u000acm.display.maxLineLength=len\u000acm.display.maxLineChanged=true}}}\u000aif(min!=null&&cm&&this.collapsed){regChange(cm,min,max+1)}\u000athis.lines.length=0\u000athis.explicitlyCleared=true\u000aif(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false\u000aif(cm){reCheckSelection(cm.doc)}}\u000aif(cm){signalLater(cm,"markerCleared",cm,this,min,max)}\u000aif(withOp){endOperation(cm)}\u000aif(this.parent){this.parent.clear()}};TextMarker.prototype.find=function(side,lineObj){var this$1=this;if(side==null&&this.type=="bookmark"){side=1}\u000avar from,to\u000afor(var i=0;i<this.lines.length;++i){var line=this$1.lines[i]\u000avar span=getMarkedSpanFor(line.markedSpans,this$1)\u000aif(span.from!=null){from=Pos(lineObj?line:lineNo(line),span.from)\u000aif(side==-1){return from}}\u000aif(span.to!=null){to=Pos(lineObj?line:lineNo(line),span.to)\u000aif(side==1){return to}}}\u000areturn from&&{from:from,to:to}};TextMarker.prototype.changed=function(){var this$1=this;var pos=this.find(-1,true),widget=this,cm=this.doc.cm\u000aif(!pos||!cm){return}\u000arunInOp(cm,function(){var line=pos.line,lineN=lineNo(pos.line)\u000avar view=findViewForLine(cm,lineN)\u000aif(view){clearLineMeasurementCacheFor(view)\u000acm.curOp.selectionChanged=cm.curOp.forceUpdate=true}\u000acm.curOp.updateMaxLine=true\u000aif(!lineIsHidden(widget.doc,line)&&widget.height!=null){var oldHeight=widget.height\u000awidget.height=null\u000avar dHeight=widgetHeight(widget)-oldHeight\u000aif(dHeight)\u000a{updateLineHeight(line,line.height+dHeight)}}\u000asignalLater(cm,"markerChanged",cm,this$1)})};TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp\u000aif(!op.maybeHiddenMarkers||indexOf(op.maybeHiddenMarkers,this)==-1)\u000a{(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this)}}\u000athis.lines.push(line)};TextMarker.prototype.detachLine=function(line){this.lines.splice(indexOf(this.lines,line),1)\u000aif(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this)}};eventMixin(TextMarker)\u000afunction markText(doc,from,to,options,type){if(options&&options.shared){return markTextShared(doc,from,to,options,type)}\u000aif(doc.cm&&!doc.cm.curOp){return operation(doc.cm,markText)(doc,from,to,options,type)}\u000avar marker=new TextMarker(doc,type),diff=cmp(from,to)\u000aif(options){copyObj(options,marker,false)}\u000aif(diff>0||diff==0&&marker.clearWhenEmpty!==false)\u000a{return marker}\u000aif(marker.replacedWith){marker.collapsed=true\u000amarker.widgetNode=eltP("span",[marker.replacedWith],"CodeMirror-widget")\u000aif(!options.handleMouseEvents){marker.widgetNode.setAttribute("cm-ignore-events","true")}\u000aif(options.insertLeft){marker.widgetNode.insertLeft=true}}\u000aif(marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker))\u000a{throw new Error("Inserting collapsed marker partially overlapping an existing one")}\u000aseeCollapsedSpans()}\u000aif(marker.addToHistory)\u000a{addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN)}\u000avar curLine=from.line,cm=doc.cm,updateMaxLine\u000adoc.iter(curLine,to.line+1,function(line){if(cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine)\u000a{updateMaxLine=true}\u000aif(marker.collapsed&&curLine!=from.line){updateLineHeight(line,0)}\u000aaddMarkedSpan(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null))\u000a++curLine})\u000aif(marker.collapsed){doc.iter(from.line,to.line+1,function(line){if(lineIsHidden(doc,line)){updateLineHeight(line,0)}})}\u000aif(marker.clearOnEnter){on(marker,"beforeCursorEnter",function(){return marker.clear();})}\u000aif(marker.readOnly){seeReadOnlySpans()\u000aif(doc.history.done.length||doc.history.undone.length)\u000a{doc.clearHistory()}}\u000aif(marker.collapsed){marker.id=++nextMarkerId\u000amarker.atomic=true}\u000aif(cm){if(updateMaxLine){cm.curOp.updateMaxLine=true}\u000aif(marker.collapsed)\u000a{regChange(cm,from.line,to.line+1)}\u000aelse if(marker.className||marker.title||marker.startStyle||marker.endStyle||marker.css)\u000a{for(var i=from.line;i<=to.line;i++){regLineChange(cm,i,"text")}}\u000aif(marker.atomic){reCheckSelection(cm.doc)}\u000asignalLater(cm,"markerAdded",cm,marker)}\u000areturn marker}\u000avar SharedTextMarker=function(markers,primary){var this$1=this;this.markers=markers\u000athis.primary=primary\u000afor(var i=0;i<markers.length;++i)\u000a{markers[i].parent=this$1}};SharedTextMarker.prototype.clear=function(){var this$1=this;if(this.explicitlyCleared){return}\u000athis.explicitlyCleared=true\u000afor(var i=0;i<this.markers.length;++i)\u000a{this$1.markers[i].clear()}\u000asignalLater(this,"clear")};SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj)};eventMixin(SharedTextMarker)\u000afunction markTextShared(doc,from,to,options,type){options=copyObj(options)\u000aoptions.shared=false\u000avar markers=[markText(doc,from,to,options,type)],primary=markers[0]\u000avar widget=options.widgetNode\u000alinkedDocs(doc,function(doc){if(widget){options.widgetNode=widget.cloneNode(true)}\u000amarkers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type))\u000afor(var i=0;i<doc.linked.length;++i)\u000a{if(doc.linked[i].isParent){return}}\u000aprimary=lst(markers)})\u000areturn new SharedTextMarker(markers,primary)}\u000afunction findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent;})}\u000afunction copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],pos=marker.find()\u000avar mFrom=doc.clipPos(pos.from),mTo=doc.clipPos(pos.to)\u000aif(cmp(mFrom,mTo)){var subMark=markText(doc,mFrom,mTo,marker.primary,marker.primary.type)\u000amarker.markers.push(subMark)\u000asubMark.parent=marker}}}\u000afunction detachSharedMarkers(markers){var loop=function(i){var marker=markers[i],linked=[marker.primary.doc]\u000alinkedDocs(marker.primary.doc,function(d){return linked.push(d);})\u000afor(var j=0;j<marker.markers.length;j++){var subMarker=marker.markers[j]\u000aif(indexOf(linked,subMarker.doc)==-1){subMarker.parent=null\u000amarker.markers.splice(j--,1)}}};for(var i=0;i<markers.length;i++)loop(i);}\u000avar nextDocId=0\u000avar Doc=function(text,mode,firstLine,lineSep,direction){if(!(this instanceof Doc)){return new Doc(text,mode,firstLine,lineSep,direction)}\u000aif(firstLine==null){firstLine=0}\u000aBranchChunk.call(this,[new LeafChunk([new Line("",null)])])\u000athis.first=firstLine\u000athis.scrollTop=this.scrollLeft=0\u000athis.cantEdit=false\u000athis.cleanGeneration=1\u000athis.modeFrontier=this.highlightFrontier=firstLine\u000avar start=Pos(firstLine,0)\u000athis.sel=simpleSelection(start)\u000athis.history=new History(null)\u000athis.id=++nextDocId\u000athis.modeOption=mode\u000athis.lineSep=lineSep\u000athis.direction=(direction=="rtl")?"rtl":"ltr"\u000athis.extend=false\u000aif(typeof text=="string"){text=this.splitLines(text)}\u000aupdateDoc(this,{from:start,to:start,text:text})\u000asetSelection(this,simpleSelection(start),sel_dontScroll)}\u000aDoc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){if(op){this.iterN(from-this.first,to-from,op)}\u000aelse{this.iterN(this.first,this.first+this.size,from)}},insert:function(at,lines){var height=0\u000afor(var i=0;i<lines.length;++i){height+=lines[i].height}\u000athis.insertInner(at-this.first,lines,height)},remove:function(at,n){this.removeInner(at-this.first,n)},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size)\u000aif(lineSep===false){return lines}\u000areturn lines.join(lineSep||this.lineSeparator())},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1\u000amakeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:true},true)\u000aif(this.cm){scrollToCoords(this.cm,0,0)}\u000asetSelection(this,simpleSelection(top),sel_dontScroll)}),replaceRange:function(code,from,to,origin){from=clipPos(this,from)\u000ato=to?clipPos(this,to):from\u000areplaceRange(this,code,from,to,origin)},getRange:function(from,to,lineSep){var lines=getBetween(this,clipPos(this,from),clipPos(this,to))\u000aif(lineSep===false){return lines}\u000areturn lines.join(lineSep||this.lineSeparator())},getLine:function(line){var l=this.getLineHandle(line);return l&&l.text},getLineHandle:function(line){if(isLine(this,line)){return getLine(this,line)}},getLineNumber:function(line){return lineNo(line)},getLineHandleVisualStart:function(line){if(typeof line=="number"){line=getLine(this,line)}\u000areturn visualLine(line)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(pos){return clipPos(this,pos)},getCursor:function(start){var range=this.sel.primary(),pos\u000aif(start==null||start=="head"){pos=range.head}\u000aelse if(start=="anchor"){pos=range.anchor}\u000aelse if(start=="end"||start=="to"||start===false){pos=range.to()}\u000aelse{pos=range.from()}\u000areturn pos},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,clipPos(this,typeof line=="number"?Pos(line,ch||0):line),null,options)}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),options)}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,clipPos(this,head),other&&clipPos(this,other),options)}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options)}),extendSelectionsBy:docMethodOp(function(f,options){var heads=map(this.sel.ranges,f)\u000aextendSelections(this,clipPosArray(this,heads),options)}),setSelections:docMethodOp(function(ranges,primary,options){var this$1=this;if(!ranges.length){return}\u000avar out=[]\u000afor(var i=0;i<ranges.length;i++)\u000a{out[i]=new Range(clipPos(this$1,ranges[i].anchor),clipPos(this$1,ranges[i].head))}\u000aif(primary==null){primary=Math.min(ranges.length-1,this.sel.primIndex)}\u000asetSelection(this,normalizeSelection(out,primary),options)}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0)\u000aranges.push(new Range(clipPos(this,anchor),clipPos(this,head||anchor)))\u000asetSelection(this,normalizeSelection(ranges,ranges.length-1),options)}),getSelection:function(lineSep){var this$1=this;var ranges=this.sel.ranges,lines\u000afor(var i=0;i<ranges.length;i++){var sel=getBetween(this$1,ranges[i].from(),ranges[i].to())\u000alines=lines?lines.concat(sel):sel}\u000aif(lineSep===false){return lines}\u000aelse{return lines.join(lineSep||this.lineSeparator())}},getSelections:function(lineSep){var this$1=this;var parts=[],ranges=this.sel.ranges\u000afor(var i=0;i<ranges.length;i++){var sel=getBetween(this$1,ranges[i].from(),ranges[i].to())\u000aif(lineSep!==false){sel=sel.join(lineSep||this$1.lineSeparator())}\u000aparts[i]=sel}\u000areturn parts},replaceSelection:function(code,collapse,origin){var dup=[]\u000afor(var i=0;i<this.sel.ranges.length;i++)\u000a{dup[i]=code}\u000athis.replaceSelections(dup,collapse,origin||"+input")},replaceSelections:docMethodOp(function(code,collapse,origin){var this$1=this;var changes=[],sel=this.sel\u000afor(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i]\u000achanges[i]={from:range.from(),to:range.to(),text:this$1.splitLines(code[i]),origin:origin}}\u000avar newSel=collapse&&collapse!="end"&&computeReplacedSel(this,changes,collapse)\u000afor(var i$1=changes.length-1;i$1>=0;i$1--)\u000a{makeChange(this$1,changes[i$1])}\u000aif(newSel){setSelectionReplaceHistory(this,newSel)}\u000aelse if(this.cm){ensureCursorVisible(this.cm)}}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo")}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo")}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",true)}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",true)}),setExtending:function(val){this.extend=val},getExtending:function(){return this.extend},historySize:function(){var hist=this.history,done=0,undone=0\u000afor(var i=0;i<hist.done.length;i++){if(!hist.done[i].ranges){++done}}\u000afor(var i$1=0;i$1<hist.undone.length;i$1++){if(!hist.undone[i$1].ranges){++undone}}\u000areturn{undo:done,redo:undone}},clearHistory:function(){this.history=new History(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(true)},changeGeneration:function(forceSplit){if(forceSplit)\u000a{this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null}\u000areturn this.history.generation},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(histData){var hist=this.history=new History(this.history.maxGeneration)\u000ahist.done=copyHistoryArray(histData.done.slice(0),null,true)\u000ahist.undone=copyHistoryArray(histData.undone.slice(0),null,true)},setGutterMarker:docMethodOp(function(line,gutterID,value){return changeLine(this,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={})\u000amarkers[gutterID]=value\u000aif(!value&&isEmpty(markers)){line.gutterMarkers=null}\u000areturn true})}),clearGutter:docMethodOp(function(gutterID){var this$1=this;this.iter(function(line){if(line.gutterMarkers&&line.gutterMarkers[gutterID]){changeLine(this$1,line,"gutter",function(){line.gutterMarkers[gutterID]=null\u000aif(isEmpty(line.gutterMarkers)){line.gutterMarkers=null}\u000areturn true})}})}),lineInfo:function(line){var n\u000aif(typeof line=="number"){if(!isLine(this,line)){return null}\u000an=line\u000aline=getLine(this,line)\u000aif(!line){return null}}else{n=lineNo(line)\u000aif(n==null){return null}}\u000areturn{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass"\u000aif(!line[prop]){line[prop]=cls}\u000aelse if(classTest(cls).test(line[prop])){return false}\u000aelse{line[prop]+=" "+cls}\u000areturn true})}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass"\u000avar cur=line[prop]\u000aif(!cur){return false}\u000aelse if(cls==null){line[prop]=null}\u000aelse{var found=cur.match(classTest(cls))\u000aif(!found){return false}\u000avar end=found.index+found[0].length\u000aline[prop]=cur.slice(0,found.index)+(!found.index||end==cur.length?"":" ")+cur.slice(end)||null}\u000areturn true})}),addLineWidget:docMethodOp(function(handle,node,options){return addLineWidget(this,handle,node,options)}),removeLineWidget:function(widget){widget.clear()},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,options&&options.type||"range")},setBookmark:function(pos,options){var realOpts={replacedWith:options&&(options.nodeType==null?options.widget:options),insertLeft:options&&options.insertLeft,clearWhenEmpty:false,shared:options&&options.shared,handleMouseEvents:options&&options.handleMouseEvents}\u000apos=clipPos(this,pos)\u000areturn markText(this,pos,pos,realOpts,"bookmark")},findMarksAt:function(pos){pos=clipPos(this,pos)\u000avar markers=[],spans=getLine(this,pos.line).markedSpans\u000aif(spans){for(var i=0;i<spans.length;++i){var span=spans[i]\u000aif((span.from==null||span.from<=pos.ch)&&(span.to==null||span.to>=pos.ch))\u000a{markers.push(span.marker.parent||span.marker)}}}\u000areturn markers},findMarks:function(from,to,filter){from=clipPos(this,from);to=clipPos(this,to)\u000avar found=[],lineNo=from.line\u000athis.iter(from.line,to.line+1,function(line){var spans=line.markedSpans\u000aif(spans){for(var i=0;i<spans.length;i++){var span=spans[i]\u000aif(!(span.to!=null&&lineNo==from.line&&from.ch>=span.to||span.from==null&&lineNo!=from.line||span.from!=null&&lineNo==to.line&&span.from>=to.ch)&&(!filter||filter(span.marker)))\u000a{found.push(span.marker.parent||span.marker)}}}\u000a++lineNo})\u000areturn found},getAllMarks:function(){var markers=[]\u000athis.iter(function(line){var sps=line.markedSpans\u000aif(sps){for(var i=0;i<sps.length;++i)\u000a{if(sps[i].from!=null){markers.push(sps[i].marker)}}}})\u000areturn markers},posFromIndex:function(off){var ch,lineNo=this.first,sepSize=this.lineSeparator().length\u000athis.iter(function(line){var sz=line.text.length+sepSize\u000aif(sz>off){ch=off;return true}\u000aoff-=sz\u000a++lineNo})\u000areturn clipPos(this,Pos(lineNo,ch))},indexFromPos:function(coords){coords=clipPos(this,coords)\u000avar index=coords.ch\u000aif(coords.line<this.first||coords.ch<0){return 0}\u000avar sepSize=this.lineSeparator().length\u000athis.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize})\u000areturn index},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction)\u000adoc.scrollTop=this.scrollTop;doc.scrollLeft=this.scrollLeft\u000adoc.sel=this.sel\u000adoc.extend=false\u000aif(copyHistory){doc.history.undoDepth=this.history.undoDepth\u000adoc.setHistory(this.getHistory())}\u000areturn doc},linkedDoc:function(options){if(!options){options={}}\u000avar from=this.first,to=this.first+this.size\u000aif(options.from!=null&&options.from>from){from=options.from}\u000aif(options.to!=null&&options.to<to){to=options.to}\u000avar copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from,this.lineSep,this.direction)\u000aif(options.sharedHist){copy.history=this.history;}(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist})\u000acopy.linked=[{doc:this,isParent:true,sharedHist:options.sharedHist}]\u000acopySharedMarkers(copy,findSharedMarkers(this))\u000areturn copy},unlinkDoc:function(other){var this$1=this;if(other instanceof CodeMirror){other=other.doc}\u000aif(this.linked){for(var i=0;i<this.linked.length;++i){var link=this$1.linked[i]\u000aif(link.doc!=other){continue}\u000athis$1.linked.splice(i,1)\u000aother.unlinkDoc(this$1)\u000adetachSharedMarkers(findSharedMarkers(this$1))\u000abreak}}\u000aif(other.history==this.history){var splitIds=[other.id]\u000alinkedDocs(other,function(doc){return splitIds.push(doc.id);},true)\u000aother.history=new History(null)\u000aother.history.done=copyHistoryArray(this.history.done,splitIds)\u000aother.history.undone=copyHistoryArray(this.history.undone,splitIds)}},iterLinkedDocs:function(f){linkedDocs(this,f)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(str){if(this.lineSep){return str.split(this.lineSep)}\u000areturn splitLinesAuto(str)},lineSeparator:function(){return this.lineSep||"\u005cn"},setDirection:docMethodOp(function(dir){if(dir!="rtl"){dir="ltr"}\u000aif(dir==this.direction){return}\u000athis.direction=dir\u000athis.iter(function(line){return line.order=null;})\u000aif(this.cm){directionChanged(this.cm)}})})\u000aDoc.prototype.eachLine=Doc.prototype.iter\u000avar lastDrop=0\u000afunction onDrop(e){var cm=this\u000aclearDragCursor(cm)\u000aif(signalDOMEvent(cm,e)||eventInWidget(cm.display,e))\u000a{return}\u000ae_preventDefault(e)\u000aif(ie){lastDrop=+new Date}\u000avar pos=posFromMouse(cm,e,true),files=e.dataTransfer.files\u000aif(!pos||cm.isReadOnly()){return}\u000aif(files&&files.length&&window.FileReader&&window.File){var n=files.length,text=Array(n),read=0\u000avar loadFile=function(file,i){if(cm.options.allowDropFileTypes&&indexOf(cm.options.allowDropFileTypes,file.type)==-1)\u000a{return}\u000avar reader=new FileReader\u000areader.onload=operation(cm,function(){var content=reader.result\u000aif(/[\u005cx00-\u005cx08\u005cx0e-\u005cx1f]{2}/.test(content)){content=""}\u000atext[i]=content\u000aif(++read==n){pos=clipPos(cm.doc,pos)\u000avar change={from:pos,to:pos,text:cm.doc.splitLines(text.join(cm.doc.lineSeparator())),origin:"paste"}\u000amakeChange(cm.doc,change)\u000asetSelectionReplaceHistory(cm.doc,simpleSelection(pos,changeEnd(change)))}})\u000areader.readAsText(file)}\u000afor(var i=0;i<n;++i){loadFile(files[i],i)}}else{if(cm.state.draggingText&&cm.doc.sel.contains(pos)>-1){cm.state.draggingText(e)\u000asetTimeout(function(){return cm.display.input.focus();},20)\u000areturn}\u000atry{var text$1=e.dataTransfer.getData("Text")\u000aif(text$1){var selected\u000aif(cm.state.draggingText&&!cm.state.draggingText.copy)\u000a{selected=cm.listSelections()}\u000asetSelectionNoUndo(cm.doc,simpleSelection(pos,pos))\u000aif(selected){for(var i$1=0;i$1<selected.length;++i$1)\u000a{replaceRange(cm.doc,"",selected[i$1].anchor,selected[i$1].head,"drag")}}\u000acm.replaceSelection(text$1,"around","paste")\u000acm.display.input.focus()}}\u000acatch(e){}}}\u000afunction onDragStart(cm,e){if(ie&&(!cm.state.draggingText||+new Date-lastDrop<100)){e_stop(e);return}\u000aif(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return}\u000ae.dataTransfer.setData("Text",cm.getSelection())\u000ae.dataTransfer.effectAllowed="copyMove"\u000aif(e.dataTransfer.setDragImage&&!safari){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;")\u000aimg.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\u000aif(presto){img.width=img.height=1\u000acm.display.wrapper.appendChild(img)\u000aimg._top=img.offsetTop}\u000ae.dataTransfer.setDragImage(img,0,0)\u000aif(presto){img.parentNode.removeChild(img)}}}\u000afunction onDragOver(cm,e){var pos=posFromMouse(cm,e)\u000aif(!pos){return}\u000avar frag=document.createDocumentFragment()\u000adrawSelectionCursor(cm,pos,frag)\u000aif(!cm.display.dragCursor){cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors")\u000acm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv)}\u000aremoveChildrenAndAdd(cm.display.dragCursor,frag)}\u000afunction clearDragCursor(cm){if(cm.display.dragCursor){cm.display.lineSpace.removeChild(cm.display.dragCursor)\u000acm.display.dragCursor=null}}\u000afunction forEachCodeMirror(f){if(!document.getElementsByClassName){return}\u000avar byClass=document.getElementsByClassName("CodeMirror")\u000afor(var i=0;i<byClass.length;i++){var cm=byClass[i].CodeMirror\u000aif(cm){f(cm)}}}\u000avar globalsRegistered=false\u000afunction ensureGlobalHandlers(){if(globalsRegistered){return}\u000aregisterGlobalHandlers()\u000aglobalsRegistered=true}\u000afunction registerGlobalHandlers(){var resizeTimer\u000aon(window,"resize",function(){if(resizeTimer==null){resizeTimer=setTimeout(function(){resizeTimer=null\u000aforEachCodeMirror(onResize)},100)}})\u000aon(window,"blur",function(){return forEachCodeMirror(onBlur);})}\u000afunction onResize(cm){var d=cm.display\u000aif(d.lastWrapHeight==d.wrapper.clientHeight&&d.lastWrapWidth==d.wrapper.clientWidth)\u000a{return}\u000ad.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null\u000ad.scrollbarsClipped=false\u000acm.setSize()}\u000avar keyNames={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\u005c\u005c",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"}\u000afor(var i=0;i<10;i++){keyNames[i+48]=keyNames[i+96]=String(i)}\u000afor(var i$1=65;i$1<=90;i$1++){keyNames[i$1]=String.fromCharCode(i$1)}\u000afor(var i$2=1;i$2<=12;i$2++){keyNames[i$2+111]=keyNames[i$2+63235]="F"+i$2}\u000avar keyMap={}\u000akeyMap.basic={"Left":"goCharLeft","Right":"goCharRight","Up":"goLineUp","Down":"goLineDown","End":"goLineEnd","Home":"goLineStartSmart","PageUp":"goPageUp","PageDown":"goPageDown","Delete":"delCharAfter","Backspace":"delCharBefore","Shift-Backspace":"delCharBefore","Tab":"defaultTab","Shift-Tab":"indentAuto","Enter":"newlineAndIndent","Insert":"toggleOverwrite","Esc":"singleSelection"}\u000akeyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"}\u000akeyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"}\u000akeyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}\u000akeyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault\u000afunction normalizeKeyName(name){var parts=name.split(/-(?!$)/)\u000aname=parts[parts.length-1]\u000avar alt,ctrl,shift,cmd\u000afor(var i=0;i<parts.length-1;i++){var mod=parts[i]\u000aif(/^(cmd|meta|m)$/i.test(mod)){cmd=true}\u000aelse if(/^a(lt)?$/i.test(mod)){alt=true}\u000aelse if(/^(c|ctrl|control)$/i.test(mod)){ctrl=true}\u000aelse if(/^s(hift)?$/i.test(mod)){shift=true}\u000aelse{throw new Error("Unrecognized modifier name: "+mod)}}\u000aif(alt){name="Alt-"+name}\u000aif(ctrl){name="Ctrl-"+name}\u000aif(cmd){name="Cmd-"+name}\u000aif(shift){name="Shift-"+name}\u000areturn name}\u000afunction normalizeKeyMap(keymap){var copy={}\u000afor(var keyname in keymap){if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname]\u000aif(/^(name|fallthrough|(de|at)tach)$/.test(keyname)){continue}\u000aif(value=="..."){delete keymap[keyname];continue}\u000avar keys=map(keyname.split(" "),normalizeKeyName)\u000afor(var i=0;i<keys.length;i++){var val=(void 0),name=(void 0)\u000aif(i==keys.length-1){name=keys.join(" ")\u000aval=value}else{name=keys.slice(0,i+1).join(" ")\u000aval="..."}\u000avar prev=copy[name]\u000aif(!prev){copy[name]=val}\u000aelse if(prev!=val){throw new Error("Inconsistent bindings for "+name)}}\u000adelete keymap[keyname]}}\u000afor(var prop in copy){keymap[prop]=copy[prop]}\u000areturn keymap}\u000afunction lookupKey(key,map,handle,context){map=getKeyMap(map)\u000avar found=map.call?map.call(key,context):map[key]\u000aif(found===false){return"nothing"}\u000aif(found==="..."){return"multi"}\u000aif(found!=null&&handle(found)){return"handled"}\u000aif(map.fallthrough){if(Object.prototype.toString.call(map.fallthrough)!="[object Array]")\u000a{return lookupKey(key,map.fallthrough,handle,context)}\u000afor(var i=0;i<map.fallthrough.length;i++){var result=lookupKey(key,map.fallthrough[i],handle,context)\u000aif(result){return result}}}}\u000afunction isModifierKey(value){var name=typeof value=="string"?value:keyNames[value.keyCode]\u000areturn name=="Ctrl"||name=="Alt"||name=="Shift"||name=="Mod"}\u000afunction addModifierNames(name,event,noShift){var base=name\u000aif(event.altKey&&base!="Alt"){name="Alt-"+name}\u000aif((flipCtrlCmd?event.metaKey:event.ctrlKey)&&base!="Ctrl"){name="Ctrl-"+name}\u000aif((flipCtrlCmd?event.ctrlKey:event.metaKey)&&base!="Cmd"){name="Cmd-"+name}\u000aif(!noShift&&event.shiftKey&&base!="Shift"){name="Shift-"+name}\u000areturn name}\u000afunction keyName(event,noShift){if(presto&&event.keyCode==34&&event["char"]){return false}\u000avar name=keyNames[event.keyCode]\u000aif(name==null||event.altGraphKey){return false}\u000aif(event.keyCode==3&&event.code){name=event.code}\u000areturn addModifierNames(name,event,noShift)}\u000afunction getKeyMap(val){return typeof val=="string"?keyMap[val]:val}\u000afunction deleteNearSelection(cm,compute){var ranges=cm.doc.sel.ranges,kill=[]\u000afor(var i=0;i<ranges.length;i++){var toKill=compute(ranges[i])\u000awhile(kill.length&&cmp(toKill.from,lst(kill).to)<=0){var replaced=kill.pop()\u000aif(cmp(replaced.from,toKill.from)<0){toKill.from=replaced.from\u000abreak}}\u000akill.push(toKill)}\u000arunInOp(cm,function(){for(var i=kill.length-1;i>=0;i--)\u000a{replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete")}\u000aensureCursorVisible(cm)})}\u000afunction moveCharLogically(line,ch,dir){var target=skipExtendingChars(line.text,ch+dir,dir)\u000areturn target<0||target>line.text.length?null:target}\u000afunction moveLogically(line,start,dir){var ch=moveCharLogically(line,start.ch,dir)\u000areturn ch==null?null:new Pos(start.line,ch,dir<0?"after":"before")}\u000afunction endOfLine(visually,cm,lineObj,lineNo,dir){if(visually){var order=getOrder(lineObj,cm.doc.direction)\u000aif(order){var part=dir<0?lst(order):order[0]\u000avar moveInStorageOrder=(dir<0)==(part.level==1)\u000avar sticky=moveInStorageOrder?"after":"before"\u000avar ch\u000aif(part.level>0||cm.doc.direction=="rtl"){var prep=prepareMeasureForLine(cm,lineObj)\u000ach=dir<0?lineObj.text.length-1:0\u000avar targetTop=measureCharPrepared(cm,prep,ch).top\u000ach=findFirst(function(ch){return measureCharPrepared(cm,prep,ch).top==targetTop;},(dir<0)==(part.level==1)?part.from:part.to-1,ch)\u000aif(sticky=="before"){ch=moveCharLogically(lineObj,ch,1)}}else{ch=dir<0?part.to:part.from}\u000areturn new Pos(lineNo,ch,sticky)}}\u000areturn new Pos(lineNo,dir<0?lineObj.text.length:0,dir<0?"before":"after")}\u000afunction moveVisually(cm,line,start,dir){var bidi=getOrder(line,cm.doc.direction)\u000aif(!bidi){return moveLogically(line,start,dir)}\u000aif(start.ch>=line.text.length){start.ch=line.text.length\u000astart.sticky="before"}else if(start.ch<=0){start.ch=0\u000astart.sticky="after"}\u000avar partPos=getBidiPartAt(bidi,start.ch,start.sticky),part=bidi[partPos]\u000aif(cm.doc.direction=="ltr"&&part.level%2==0&&(dir>0?part.to>start.ch:part.from<start.ch)){return moveLogically(line,start,dir)}\u000avar mv=function(pos,dir){return moveCharLogically(line,pos instanceof Pos?pos.ch:pos,dir);}\u000avar prep\u000avar getWrappedLineExtent=function(ch){if(!cm.options.lineWrapping){return{begin:0,end:line.text.length}}\u000aprep=prep||prepareMeasureForLine(cm,line)\u000areturn wrappedLineExtentChar(cm,line,prep,ch)}\u000avar wrappedLineExtent=getWrappedLineExtent(start.sticky=="before"?mv(start,-1):start.ch)\u000aif(cm.doc.direction=="rtl"||part.level==1){var moveInStorageOrder=(part.level==1)==(dir<0)\u000avar ch=mv(start,moveInStorageOrder?1:-1)\u000aif(ch!=null&&(!moveInStorageOrder?ch>=part.from&&ch>=wrappedLineExtent.begin:ch<=part.to&&ch<=wrappedLineExtent.end)){var sticky=moveInStorageOrder?"before":"after"\u000areturn new Pos(start.line,ch,sticky)}}\u000avar searchInVisualLine=function(partPos,dir,wrappedLineExtent){var getRes=function(ch,moveInStorageOrder){return moveInStorageOrder?new Pos(start.line,mv(ch,1),"before"):new Pos(start.line,ch,"after");}\u000afor(;partPos>=0&&partPos<bidi.length;partPos+=dir){var part=bidi[partPos]\u000avar moveInStorageOrder=(dir>0)==(part.level!=1)\u000avar ch=moveInStorageOrder?wrappedLineExtent.begin:mv(wrappedLineExtent.end,-1)\u000aif(part.from<=ch&&ch<part.to){return getRes(ch,moveInStorageOrder)}\u000ach=moveInStorageOrder?part.from:mv(part.to,-1)\u000aif(wrappedLineExtent.begin<=ch&&ch<wrappedLineExtent.end){return getRes(ch,moveInStorageOrder)}}}\u000avar res=searchInVisualLine(partPos+dir,dir,wrappedLineExtent)\u000aif(res){return res}\u000avar nextCh=dir>0?wrappedLineExtent.end:mv(wrappedLineExtent.begin,-1)\u000aif(nextCh!=null&&!(dir>0&&nextCh==line.text.length)){res=searchInVisualLine(dir>0?0:bidi.length-1,dir,getWrappedLineExtent(nextCh))\u000aif(res){return res}}\u000areturn null}\u000avar commands={selectAll:selectAll,singleSelection:function(cm){return cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll);},killLine:function(cm){return deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length\u000aif(range.head.ch==len&&range.head.line<cm.lastLine())\u000a{return{from:range.head,to:Pos(range.head.line+1,0)}}\u000aelse\u000a{return{from:range.head,to:Pos(range.head.line,len)}}}else{return{from:range.from(),to:range.to()}}});},deleteLine:function(cm){return deleteNearSelection(cm,function(range){return({from:Pos(range.from().line,0),to:clipPos(cm.doc,Pos(range.to().line+1,0))});});},delLineLeft:function(cm){return deleteNearSelection(cm,function(range){return({from:Pos(range.from().line,0),to:range.from()});});},delWrappedLineLeft:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5\u000avar leftPos=cm.coordsChar({left:0,top:top},"div")\u000areturn{from:leftPos,to:range.from()}});},delWrappedLineRight:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5\u000avar rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")\u000areturn{from:range.from(),to:rightPos}});},undo:function(cm){return cm.undo();},redo:function(cm){return cm.redo();},undoSelection:function(cm){return cm.undoSelection();},redoSelection:function(cm){return cm.redoSelection();},goDocStart:function(cm){return cm.extendSelection(Pos(cm.firstLine(),0));},goDocEnd:function(cm){return cm.extendSelection(Pos(cm.lastLine()));},goLineStart:function(cm){return cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line);},{origin:"+move",bias:1});},goLineStartSmart:function(cm){return cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head);},{origin:"+move",bias:1});},goLineEnd:function(cm){return cm.extendSelectionsBy(function(range){return lineEnd(cm,range.head.line);},{origin:"+move",bias:-1});},goLineRight:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5\u000areturn cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")},sel_move);},goLineLeft:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5\u000areturn cm.coordsChar({left:0,top:top},"div")},sel_move);},goLineLeftSmart:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5\u000avar pos=cm.coordsChar({left:0,top:top},"div")\u000aif(pos.ch<cm.getLine(pos.line).search(/\u005cS/)){return lineStartSmart(cm,range.head)}\u000areturn pos},sel_move);},goLineUp:function(cm){return cm.moveV(-1,"line");},goLineDown:function(cm){return cm.moveV(1,"line");},goPageUp:function(cm){return cm.moveV(-1,"page");},goPageDown:function(cm){return cm.moveV(1,"page");},goCharLeft:function(cm){return cm.moveH(-1,"char");},goCharRight:function(cm){return cm.moveH(1,"char");},goColumnLeft:function(cm){return cm.moveH(-1,"column");},goColumnRight:function(cm){return cm.moveH(1,"column");},goWordLeft:function(cm){return cm.moveH(-1,"word");},goGroupRight:function(cm){return cm.moveH(1,"group");},goGroupLeft:function(cm){return cm.moveH(-1,"group");},goWordRight:function(cm){return cm.moveH(1,"word");},delCharBefore:function(cm){return cm.deleteH(-1,"char");},delCharAfter:function(cm){return cm.deleteH(1,"char");},delWordBefore:function(cm){return cm.deleteH(-1,"word");},delWordAfter:function(cm){return cm.deleteH(1,"word");},delGroupBefore:function(cm){return cm.deleteH(-1,"group");},delGroupAfter:function(cm){return cm.deleteH(1,"group");},indentAuto:function(cm){return cm.indentSelection("smart");},indentMore:function(cm){return cm.indentSelection("add");},indentLess:function(cm){return cm.indentSelection("subtract");},insertTab:function(cm){return cm.replaceSelection("\u005ct");},insertSoftTab:function(cm){var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize\u000afor(var i=0;i<ranges.length;i++){var pos=ranges[i].from()\u000avar col=countColumn(cm.getLine(pos.line),pos.ch,tabSize)\u000aspaces.push(spaceStr(tabSize-col%tabSize))}\u000acm.replaceSelections(spaces)},defaultTab:function(cm){if(cm.somethingSelected()){cm.indentSelection("add")}\u000aelse{cm.execCommand("insertTab")}},transposeChars:function(cm){return runInOp(cm,function(){var ranges=cm.listSelections(),newSel=[]\u000afor(var i=0;i<ranges.length;i++){if(!ranges[i].empty()){continue}\u000avar cur=ranges[i].head,line=getLine(cm.doc,cur.line).text\u000aif(line){if(cur.ch==line.length){cur=new Pos(cur.line,cur.ch-1)}\u000aif(cur.ch>0){cur=new Pos(cur.line,cur.ch+1)\u000acm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose")}else if(cur.line>cm.doc.first){var prev=getLine(cm.doc,cur.line-1).text\u000aif(prev){cur=new Pos(cur.line,1)\u000acm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+\u000aprev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),cur,"+transpose")}}}\u000anewSel.push(new Range(cur,cur))}\u000acm.setSelections(newSel)});},newlineAndIndent:function(cm){return runInOp(cm,function(){var sels=cm.listSelections()\u000afor(var i=sels.length-1;i>=0;i--)\u000a{cm.replaceRange(cm.doc.lineSeparator(),sels[i].anchor,sels[i].head,"+input")}\u000asels=cm.listSelections()\u000afor(var i$1=0;i$1<sels.length;i$1++)\u000a{cm.indentLine(sels[i$1].from().line,null,true)}\u000aensureCursorVisible(cm)});},openLine:function(cm){return cm.replaceSelection("\u005cn","start");},toggleOverwrite:function(cm){return cm.toggleOverwrite();}}\u000afunction lineStart(cm,lineN){var line=getLine(cm.doc,lineN)\u000avar visual=visualLine(line)\u000aif(visual!=line){lineN=lineNo(visual)}\u000areturn endOfLine(true,cm,visual,lineN,1)}\u000afunction lineEnd(cm,lineN){var line=getLine(cm.doc,lineN)\u000avar visual=visualLineEnd(line)\u000aif(visual!=line){lineN=lineNo(visual)}\u000areturn endOfLine(true,cm,line,lineN,-1)}\u000afunction lineStartSmart(cm,pos){var start=lineStart(cm,pos.line)\u000avar line=getLine(cm.doc,start.line)\u000avar order=getOrder(line,cm.doc.direction)\u000aif(!order||order[0].level==0){var firstNonWS=Math.max(0,line.text.search(/\u005cS/))\u000avar inWS=pos.line==start.line&&pos.ch<=firstNonWS&&pos.ch\u000areturn Pos(start.line,inWS?0:firstNonWS,start.sticky)}\u000areturn start}\u000afunction doHandleBinding(cm,bound,dropShift){if(typeof bound=="string"){bound=commands[bound]\u000aif(!bound){return false}}\u000acm.display.input.ensurePolled()\u000avar prevShift=cm.display.shift,done=false\u000atry{if(cm.isReadOnly()){cm.state.suppressEdits=true}\u000aif(dropShift){cm.display.shift=false}\u000adone=bound(cm)!=Pass}finally{cm.display.shift=prevShift\u000acm.state.suppressEdits=false}\u000areturn done}\u000afunction lookupKeyForEditor(cm,name,handle){for(var i=0;i<cm.state.keyMaps.length;i++){var result=lookupKey(name,cm.state.keyMaps[i],handle,cm)\u000aif(result){return result}}\u000areturn(cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm))||lookupKey(name,cm.options.keyMap,handle,cm)}\u000avar stopSeq=new Delayed\u000afunction dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq\u000aif(seq){if(isModifierKey(name)){return"handled"}\u000aif(/\u005c'$/.test(name))\u000a{cm.state.keySeq=null}\u000aelse\u000a{stopSeq.set(50,function(){if(cm.state.keySeq==seq){cm.state.keySeq=null\u000acm.display.input.reset()}})}\u000aif(dispatchKeyInner(cm,seq+" "+name,e,handle)){return true}}\u000areturn dispatchKeyInner(cm,name,e,handle)}\u000afunction dispatchKeyInner(cm,name,e,handle){var result=lookupKeyForEditor(cm,name,handle)\u000aif(result=="multi")\u000a{cm.state.keySeq=name}\u000aif(result=="handled")\u000a{signalLater(cm,"keyHandled",cm,name,e)}\u000aif(result=="handled"||result=="multi"){e_preventDefault(e)\u000arestartBlink(cm)}\u000areturn!!result}\u000afunction handleKeyBinding(cm,e){var name=keyName(e,true)\u000aif(!name){return false}\u000aif(e.shiftKey&&!cm.state.keySeq){return dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,true);})||dispatchKey(cm,name,e,function(b){if(typeof b=="string"?/^go[A-Z]/.test(b):b.motion)\u000a{return doHandleBinding(cm,b)}})}else{return dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b);})}}\u000afunction handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,true);})}\u000avar lastStoppedKey=null\u000afunction onKeyDown(e){var cm=this\u000acm.curOp.focus=activeElt()\u000aif(signalDOMEvent(cm,e)){return}\u000aif(ie&&ie_version<11&&e.keyCode==27){e.returnValue=false}\u000avar code=e.keyCode\u000acm.display.shift=code==16||e.shiftKey\u000avar handled=handleKeyBinding(cm,e)\u000aif(presto){lastStoppedKey=handled?code:null\u000aif(!handled&&code==88&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey))\u000a{cm.replaceSelection("",null,"cut")}}\u000aif(code==18&&!/\u005cbCodeMirror-crosshair\u005cb/.test(cm.display.lineDiv.className))\u000a{showCrossHair(cm)}}\u000afunction showCrossHair(cm){var lineDiv=cm.display.lineDiv\u000aaddClass(lineDiv,"CodeMirror-crosshair")\u000afunction up(e){if(e.keyCode==18||!e.altKey){rmClass(lineDiv,"CodeMirror-crosshair")\u000aoff(document,"keyup",up)\u000aoff(document,"mouseover",up)}}\u000aon(document,"keyup",up)\u000aon(document,"mouseover",up)}\u000afunction onKeyUp(e){if(e.keyCode==16){this.doc.sel.shift=false}\u000asignalDOMEvent(this,e)}\u000afunction onKeyPress(e){var cm=this\u000aif(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey){return}\u000avar keyCode=e.keyCode,charCode=e.charCode\u000aif(presto&&keyCode==lastStoppedKey){lastStoppedKey=null;e_preventDefault(e);return}\u000aif((presto&&(!e.which||e.which<10))&&handleKeyBinding(cm,e)){return}\u000avar ch=String.fromCharCode(charCode==null?keyCode:charCode)\u000aif(ch=="\u005cx08"){return}\u000aif(handleCharBinding(cm,e,ch)){return}\u000acm.display.input.onKeyPress(e)}\u000avar DOUBLECLICK_DELAY=400\u000avar PastClick=function(time,pos,button){this.time=time\u000athis.pos=pos\u000athis.button=button};PastClick.prototype.compare=function(time,pos,button){return this.time+DOUBLECLICK_DELAY>time&&cmp(pos,this.pos)==0&&button==this.button};var lastClick;var lastDoubleClick;function clickRepeat(pos,button){var now=+new Date\u000aif(lastDoubleClick&&lastDoubleClick.compare(now,pos,button)){lastClick=lastDoubleClick=null\u000areturn"triple"}else if(lastClick&&lastClick.compare(now,pos,button)){lastDoubleClick=new PastClick(now,pos,button)\u000alastClick=null\u000areturn"double"}else{lastClick=new PastClick(now,pos,button)\u000alastDoubleClick=null\u000areturn"single"}}\u000afunction onMouseDown(e){var cm=this,display=cm.display\u000aif(signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch()){return}\u000adisplay.input.ensurePolled()\u000adisplay.shift=e.shiftKey\u000aif(eventInWidget(display,e)){if(!webkit){display.scroller.draggable=false\u000asetTimeout(function(){return display.scroller.draggable=true;},100)}\u000areturn}\u000aif(clickInGutter(cm,e)){return}\u000avar pos=posFromMouse(cm,e),button=e_button(e),repeat=pos?clickRepeat(pos,button):"single"\u000awindow.focus()\u000aif(button==1&&cm.state.selectingText)\u000a{cm.state.selectingText(e)}\u000aif(pos&&handleMappedButton(cm,button,pos,repeat,e)){return}\u000aif(button==1){if(pos){leftButtonDown(cm,pos,repeat,e)}\u000aelse if(e_target(e)==display.scroller){e_preventDefault(e)}}else if(button==2){if(pos){extendSelection(cm.doc,pos)}\u000asetTimeout(function(){return display.input.focus();},20)}else if(button==3){if(captureRightClick){onContextMenu(cm,e)}\u000aelse{delayBlurEvent(cm)}}}\u000afunction handleMappedButton(cm,button,pos,repeat,event){var name="Click"\u000aif(repeat=="double"){name="Double"+name}\u000aelse if(repeat=="triple"){name="Triple"+name}\u000aname=(button==1?"Left":button==2?"Middle":"Right")+name\u000areturn dispatchKey(cm,addModifierNames(name,event),event,function(bound){if(typeof bound=="string"){bound=commands[bound]}\u000aif(!bound){return false}\u000avar done=false\u000atry{if(cm.isReadOnly()){cm.state.suppressEdits=true}\u000adone=bound(cm,pos)!=Pass}finally{cm.state.suppressEdits=false}\u000areturn done})}\u000afunction configureMouse(cm,repeat,event){var option=cm.getOption("configureMouse")\u000avar value=option?option(cm,repeat,event):{}\u000aif(value.unit==null){var rect=chromeOS?event.shiftKey&&event.metaKey:event.altKey\u000avalue.unit=rect?"rectangle":repeat=="single"?"char":repeat=="double"?"word":"line"}\u000aif(value.extend==null||cm.doc.extend){value.extend=cm.doc.extend||event.shiftKey}\u000aif(value.addNew==null){value.addNew=mac?event.metaKey:event.ctrlKey}\u000aif(value.moveOnDrag==null){value.moveOnDrag=!(mac?event.altKey:event.ctrlKey)}\u000areturn value}\u000afunction leftButtonDown(cm,pos,repeat,event){if(ie){setTimeout(bind(ensureFocus,cm),0)}\u000aelse{cm.curOp.focus=activeElt()}\u000avar behavior=configureMouse(cm,repeat,event)\u000avar sel=cm.doc.sel,contained\u000aif(cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&repeat=="single"&&(contained=sel.contains(pos))>-1&&(cmp((contained=sel.ranges[contained]).from(),pos)<0||pos.xRel>0)&&(cmp(contained.to(),pos)>0||pos.xRel<0))\u000a{leftButtonStartDrag(cm,event,pos,behavior)}\u000aelse\u000a{leftButtonSelect(cm,event,pos,behavior)}}\u000afunction leftButtonStartDrag(cm,event,pos,behavior){var display=cm.display,moved=false\u000avar dragEnd=operation(cm,function(e){if(webkit){display.scroller.draggable=false}\u000acm.state.draggingText=false\u000aoff(document,"mouseup",dragEnd)\u000aoff(document,"mousemove",mouseMove)\u000aoff(display.scroller,"dragstart",dragStart)\u000aoff(display.scroller,"drop",dragEnd)\u000aif(!moved){e_preventDefault(e)\u000aif(!behavior.addNew)\u000a{extendSelection(cm.doc,pos,null,null,behavior.extend)}\u000aif(webkit||ie&&ie_version==9)\u000a{setTimeout(function(){document.body.focus();display.input.focus()},20)}\u000aelse\u000a{display.input.focus()}}})\u000avar mouseMove=function(e2){moved=moved||Math.abs(event.clientX-e2.clientX)+Math.abs(event.clientY-e2.clientY)>=10}\u000avar dragStart=function(){return moved=true;}\u000aif(webkit){display.scroller.draggable=true}\u000acm.state.draggingText=dragEnd\u000adragEnd.copy=!behavior.moveOnDrag\u000aif(display.scroller.dragDrop){display.scroller.dragDrop()}\u000aon(document,"mouseup",dragEnd)\u000aon(document,"mousemove",mouseMove)\u000aon(display.scroller,"dragstart",dragStart)\u000aon(display.scroller,"drop",dragEnd)\u000adelayBlurEvent(cm)\u000asetTimeout(function(){return display.input.focus();},20)}\u000afunction rangeForUnit(cm,pos,unit){if(unit=="char"){return new Range(pos,pos)}\u000aif(unit=="word"){return cm.findWordAt(pos)}\u000aif(unit=="line"){return new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)))}\u000avar result=unit(cm,pos)\u000areturn new Range(result.from,result.to)}\u000afunction leftButtonSelect(cm,event,start,behavior){var display=cm.display,doc=cm.doc\u000ae_preventDefault(event)\u000avar ourRange,ourIndex,startSel=doc.sel,ranges=startSel.ranges\u000aif(behavior.addNew&&!behavior.extend){ourIndex=doc.sel.contains(start)\u000aif(ourIndex>-1)\u000a{ourRange=ranges[ourIndex]}\u000aelse\u000a{ourRange=new Range(start,start)}}else{ourRange=doc.sel.primary()\u000aourIndex=doc.sel.primIndex}\u000aif(behavior.unit=="rectangle"){if(!behavior.addNew){ourRange=new Range(start,start)}\u000astart=posFromMouse(cm,event,true,true)\u000aourIndex=-1}else{var range=rangeForUnit(cm,start,behavior.unit)\u000aif(behavior.extend)\u000a{ourRange=extendRange(ourRange,range.anchor,range.head,behavior.extend)}\u000aelse\u000a{ourRange=range}}\u000aif(!behavior.addNew){ourIndex=0\u000asetSelection(doc,new Selection([ourRange],0),sel_mouse)\u000astartSel=doc.sel}else if(ourIndex==-1){ourIndex=ranges.length\u000asetSelection(doc,normalizeSelection(ranges.concat([ourRange]),ourIndex),{scroll:false,origin:"*mouse"})}else if(ranges.length>1&&ranges[ourIndex].empty()&&behavior.unit=="char"&&!behavior.extend){setSelection(doc,normalizeSelection(ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:false,origin:"*mouse"})\u000astartSel=doc.sel}else{replaceOneSelection(doc,ourIndex,ourRange,sel_mouse)}\u000avar lastPos=start\u000afunction extendTo(pos){if(cmp(lastPos,pos)==0){return}\u000alastPos=pos\u000aif(behavior.unit=="rectangle"){var ranges=[],tabSize=cm.options.tabSize\u000avar startCol=countColumn(getLine(doc,start.line).text,start.ch,tabSize)\u000avar posCol=countColumn(getLine(doc,pos.line).text,pos.ch,tabSize)\u000avar left=Math.min(startCol,posCol),right=Math.max(startCol,posCol)\u000afor(var line=Math.min(start.line,pos.line),end=Math.min(cm.lastLine(),Math.max(start.line,pos.line));line<=end;line++){var text=getLine(doc,line).text,leftPos=findColumn(text,left,tabSize)\u000aif(left==right)\u000a{ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos)))}\u000aelse if(text.length>leftPos)\u000a{ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))))}}\u000aif(!ranges.length){ranges.push(new Range(start,start))}\u000asetSelection(doc,normalizeSelection(startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:false})\u000acm.scrollIntoView(pos)}else{var oldRange=ourRange\u000avar range=rangeForUnit(cm,pos,behavior.unit)\u000avar anchor=oldRange.anchor,head\u000aif(cmp(range.anchor,anchor)>0){head=range.head\u000aanchor=minPos(oldRange.from(),range.anchor)}else{head=range.anchor\u000aanchor=maxPos(oldRange.to(),range.head)}\u000avar ranges$1=startSel.ranges.slice(0)\u000aranges$1[ourIndex]=bidiSimplify(cm,new Range(clipPos(doc,anchor),head))\u000asetSelection(doc,normalizeSelection(ranges$1,ourIndex),sel_mouse)}}\u000avar editorSize=display.wrapper.getBoundingClientRect()\u000avar counter=0\u000afunction extend(e){var curCount=++counter\u000avar cur=posFromMouse(cm,e,true,behavior.unit=="rectangle")\u000aif(!cur){return}\u000aif(cmp(cur,lastPos)!=0){cm.curOp.focus=activeElt()\u000aextendTo(cur)\u000avar visible=visibleLines(display,doc)\u000aif(cur.line>=visible.to||cur.line<visible.from)\u000a{setTimeout(operation(cm,function(){if(counter==curCount){extend(e)}}),150)}}else{var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0\u000aif(outside){setTimeout(operation(cm,function(){if(counter!=curCount){return}\u000adisplay.scroller.scrollTop+=outside\u000aextend(e)}),50)}}}\u000afunction done(e){cm.state.selectingText=false\u000acounter=Infinity\u000ae_preventDefault(e)\u000adisplay.input.focus()\u000aoff(document,"mousemove",move)\u000aoff(document,"mouseup",up)\u000adoc.history.lastSelOrigin=null}\u000avar move=operation(cm,function(e){if(!e_button(e)){done(e)}\u000aelse{extend(e)}})\u000avar up=operation(cm,done)\u000acm.state.selectingText=up\u000aon(document,"mousemove",move)\u000aon(document,"mouseup",up)}\u000afunction bidiSimplify(cm,range){var anchor=range.anchor;var head=range.head;var anchorLine=getLine(cm.doc,anchor.line)\u000aif(cmp(anchor,head)==0&&anchor.sticky==head.sticky){return range}\u000avar order=getOrder(anchorLine)\u000aif(!order){return range}\u000avar index=getBidiPartAt(order,anchor.ch,anchor.sticky),part=order[index]\u000aif(part.from!=anchor.ch&&part.to!=anchor.ch){return range}\u000avar boundary=index+((part.from==anchor.ch)==(part.level!=1)?0:1)\u000aif(boundary==0||boundary==order.length){return range}\u000avar leftSide\u000aif(head.line!=anchor.line){leftSide=(head.line-anchor.line)*(cm.doc.direction=="ltr"?1:-1)>0}else{var headIndex=getBidiPartAt(order,head.ch,head.sticky)\u000avar dir=headIndex-index||(head.ch-anchor.ch)*(part.level==1?-1:1)\u000aif(headIndex==boundary-1||headIndex==boundary)\u000a{leftSide=dir<0}\u000aelse\u000a{leftSide=dir>0}}\u000avar usePart=order[boundary+(leftSide?-1:0)]\u000avar from=leftSide==(usePart.level==1)\u000avar ch=from?usePart.from:usePart.to,sticky=from?"after":"before"\u000areturn anchor.ch==ch&&anchor.sticky==sticky?range:new Range(new Pos(anchor.line,ch,sticky),head)}\u000afunction gutterEvent(cm,e,type,prevent){var mX,mY\u000aif(e.touches){mX=e.touches[0].clientX\u000amY=e.touches[0].clientY}else{try{mX=e.clientX;mY=e.clientY}\u000acatch(e){return false}}\u000aif(mX>=Math.floor(cm.display.gutters.getBoundingClientRect().right)){return false}\u000aif(prevent){e_preventDefault(e)}\u000avar display=cm.display\u000avar lineBox=display.lineDiv.getBoundingClientRect()\u000aif(mY>lineBox.bottom||!hasHandler(cm,type)){return e_defaultPrevented(e)}\u000amY-=lineBox.top-display.viewOffset\u000afor(var i=0;i<cm.options.gutters.length;++i){var g=display.gutters.childNodes[i]\u000aif(g&&g.getBoundingClientRect().right>=mX){var line=lineAtHeight(cm.doc,mY)\u000avar gutter=cm.options.gutters[i]\u000asignal(cm,type,cm,line,gutter,e)\u000areturn e_defaultPrevented(e)}}}\u000afunction clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",true)}\u000afunction onContextMenu(cm,e){if(eventInWidget(cm.display,e)||contextMenuInGutter(cm,e)){return}\u000aif(signalDOMEvent(cm,e,"contextmenu")){return}\u000acm.display.input.onContextMenu(e)}\u000afunction contextMenuInGutter(cm,e){if(!hasHandler(cm,"gutterContextMenu")){return false}\u000areturn gutterEvent(cm,e,"gutterContextMenu",false)}\u000afunction themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\u005cs*cm-s-\u005cS+/g,"")+\u000acm.options.theme.replace(/(^|\u005cs)\u005cs*/g," cm-s-")\u000aclearCaches(cm)}\u000avar Init={toString:function(){return"CodeMirror.Init"}}\u000avar defaults={}\u000avar optionHandlers={}\u000afunction defineOptions(CodeMirror){var optionHandlers=CodeMirror.optionHandlers\u000afunction option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt\u000aif(handle){optionHandlers[name]=notOnInit?function(cm,val,old){if(old!=Init){handle(cm,val,old)}}:handle}}\u000aCodeMirror.defineOption=option\u000aCodeMirror.Init=Init\u000aoption("value","",function(cm,val){return cm.setValue(val);},true)\u000aoption("mode",null,function(cm,val){cm.doc.modeOption=val\u000aloadMode(cm)},true)\u000aoption("indentUnit",2,loadMode,true)\u000aoption("indentWithTabs",false)\u000aoption("smartIndent",true)\u000aoption("tabSize",4,function(cm){resetModeState(cm)\u000aclearCaches(cm)\u000aregChange(cm)},true)\u000aoption("lineSeparator",null,function(cm,val){cm.doc.lineSep=val\u000aif(!val){return}\u000avar newBreaks=[],lineNo=cm.doc.first\u000acm.doc.iter(function(line){for(var pos=0;;){var found=line.text.indexOf(val,pos)\u000aif(found==-1){break}\u000apos=found+val.length\u000anewBreaks.push(Pos(lineNo,found))}\u000alineNo++})\u000afor(var i=newBreaks.length-1;i>=0;i--)\u000a{replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length))}})\u000aoption("specialChars",/[\u005cu0000-\u005cu001f\u005cu007f-\u005cu009f\u005cu00ad\u005cu061c\u005cu200b-\u005cu200f\u005cu2028\u005cu2029\u005cufeff]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\u005ct")?"":"|\u005ct"),"g")\u000aif(old!=Init){cm.refresh()}})\u000aoption("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){return cm.refresh();},true)\u000aoption("electricChars",true)\u000aoption("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},true)\u000aoption("spellcheck",false,function(cm,val){return cm.getInputField().spellcheck=val;},true)\u000aoption("rtlMoveVisually",!windows)\u000aoption("wholeLineUpdateBefore",true)\u000aoption("theme","default",function(cm){themeChanged(cm)\u000aguttersChanged(cm)},true)\u000aoption("keyMap","default",function(cm,val,old){var next=getKeyMap(val)\u000avar prev=old!=Init&&getKeyMap(old)\u000aif(prev&&prev.detach){prev.detach(cm,next)}\u000aif(next.attach){next.attach(cm,prev||null)}})\u000aoption("extraKeys",null)\u000aoption("configureMouse",null)\u000aoption("lineWrapping",false,wrappingChanged,true)\u000aoption("gutters",[],function(cm){setGuttersForLineNumbers(cm.options)\u000aguttersChanged(cm)},true)\u000aoption("fixedGutter",true,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0"\u000acm.refresh()},true)\u000aoption("coverGutterNextToScrollbar",false,function(cm){return updateScrollbars(cm);},true)\u000aoption("scrollbarStyle","native",function(cm){initScrollbars(cm)\u000aupdateScrollbars(cm)\u000acm.display.scrollbars.setScrollTop(cm.doc.scrollTop)\u000acm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft)},true)\u000aoption("lineNumbers",false,function(cm){setGuttersForLineNumbers(cm.options)\u000aguttersChanged(cm)},true)\u000aoption("firstLineNumber",1,guttersChanged,true)\u000aoption("lineNumberFormatter",function(integer){return integer;},guttersChanged,true)\u000aoption("showCursorWhenSelecting",false,updateSelection,true)\u000aoption("resetSelectionOnContextMenu",true)\u000aoption("lineWiseCopyCut",true)\u000aoption("pasteLinesPerSelection",true)\u000aoption("readOnly",false,function(cm,val){if(val=="nocursor"){onBlur(cm)\u000acm.display.input.blur()}\u000acm.display.input.readOnlyChanged(val)})\u000aoption("disableInput",false,function(cm,val){if(!val){cm.display.input.reset()}},true)\u000aoption("dragDrop",true,dragDropChanged)\u000aoption("allowDropFileTypes",null)\u000aoption("cursorBlinkRate",530)\u000aoption("cursorScrollMargin",0)\u000aoption("cursorHeight",1,updateSelection,true)\u000aoption("singleCursorHeightPerLine",true,updateSelection,true)\u000aoption("workTime",100)\u000aoption("workDelay",100)\u000aoption("flattenSpans",true,resetModeState,true)\u000aoption("addModeClass",false,resetModeState,true)\u000aoption("pollInterval",100)\u000aoption("undoDepth",200,function(cm,val){return cm.doc.history.undoDepth=val;})\u000aoption("historyEventDelay",1250)\u000aoption("viewportMargin",10,function(cm){return cm.refresh();},true)\u000aoption("maxHighlightLength",10000,resetModeState,true)\u000aoption("moveInputWithCursor",true,function(cm,val){if(!val){cm.display.input.resetPosition()}})\u000aoption("tabindex",null,function(cm,val){return cm.display.input.getField().tabIndex=val||"";})\u000aoption("autofocus",null)\u000aoption("direction","ltr",function(cm,val){return cm.doc.setDirection(val);},true)}\u000afunction guttersChanged(cm){updateGutters(cm)\u000aregChange(cm)\u000aalignHorizontally(cm)}\u000afunction dragDropChanged(cm,value,old){var wasOn=old&&old!=Init\u000aif(!value!=!wasOn){var funcs=cm.display.dragFunctions\u000avar toggle=value?on:off\u000atoggle(cm.display.scroller,"dragstart",funcs.start)\u000atoggle(cm.display.scroller,"dragenter",funcs.enter)\u000atoggle(cm.display.scroller,"dragover",funcs.over)\u000atoggle(cm.display.scroller,"dragleave",funcs.leave)\u000atoggle(cm.display.scroller,"drop",funcs.drop)}}\u000afunction wrappingChanged(cm){if(cm.options.lineWrapping){addClass(cm.display.wrapper,"CodeMirror-wrap")\u000acm.display.sizer.style.minWidth=""\u000acm.display.sizerWidth=null}else{rmClass(cm.display.wrapper,"CodeMirror-wrap")\u000afindMaxLine(cm)}\u000aestimateLineHeights(cm)\u000aregChange(cm)\u000aclearCaches(cm)\u000asetTimeout(function(){return updateScrollbars(cm);},100)}\u000afunction CodeMirror(place,options){var this$1=this;if(!(this instanceof CodeMirror)){return new CodeMirror(place,options)}\u000athis.options=options=options?copyObj(options):{}\u000acopyObj(defaults,options,false)\u000asetGuttersForLineNumbers(options)\u000avar doc=options.value\u000aif(typeof doc=="string"){doc=new Doc(doc,options.mode,null,options.lineSeparator,options.direction)}\u000athis.doc=doc\u000avar input=new CodeMirror.inputStyles[options.inputStyle](this)\u000avar display=this.display=new Display(place,doc,input)\u000adisplay.wrapper.CodeMirror=this\u000aupdateGutters(this)\u000athemeChanged(this)\u000aif(options.lineWrapping)\u000a{this.display.wrapper.className+=" CodeMirror-wrap"}\u000ainitScrollbars(this)\u000athis.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:false,cutIncoming:false,selectingText:false,draggingText:false,highlight:new Delayed(),keySeq:null,specialChars:null}\u000aif(options.autofocus&&!mobile){display.input.focus()}\u000aif(ie&&ie_version<11){setTimeout(function(){return this$1.display.input.reset(true);},20)}\u000aregisterEventHandlers(this)\u000aensureGlobalHandlers()\u000astartOperation(this)\u000athis.curOp.forceUpdate=true\u000aattachDoc(this,doc)\u000aif((options.autofocus&&!mobile)||this.hasFocus())\u000a{setTimeout(bind(onFocus,this),20)}\u000aelse\u000a{onBlur(this)}\u000afor(var opt in optionHandlers){if(optionHandlers.hasOwnProperty(opt))\u000a{optionHandlers[opt](this$1,options[opt],Init)}}\u000amaybeUpdateLineNumberWidth(this)\u000aif(options.finishInit){options.finishInit(this)}\u000afor(var i=0;i<initHooks.length;++i){initHooks[i](this$1)}\u000aendOperation(this)\u000aif(webkit&&options.lineWrapping&&getComputedStyle(display.lineDiv).textRendering=="optimizelegibility")\u000a{display.lineDiv.style.textRendering="auto"}}\u000aCodeMirror.defaults=defaults\u000aCodeMirror.optionHandlers=optionHandlers\u000afunction registerEventHandlers(cm){var d=cm.display\u000aon(d.scroller,"mousedown",operation(cm,onMouseDown))\u000aif(ie&&ie_version<11)\u000a{on(d.scroller,"dblclick",operation(cm,function(e){if(signalDOMEvent(cm,e)){return}\u000avar pos=posFromMouse(cm,e)\u000aif(!pos||clickInGutter(cm,e)||eventInWidget(cm.display,e)){return}\u000ae_preventDefault(e)\u000avar word=cm.findWordAt(pos)\u000aextendSelection(cm.doc,word.anchor,word.head)}))}\u000aelse\u000a{on(d.scroller,"dblclick",function(e){return signalDOMEvent(cm,e)||e_preventDefault(e);})}\u000aif(!captureRightClick){on(d.scroller,"contextmenu",function(e){return onContextMenu(cm,e);})}\u000avar touchFinished,prevTouch={end:0}\u000afunction finishTouch(){if(d.activeTouch){touchFinished=setTimeout(function(){return d.activeTouch=null;},1000)\u000aprevTouch=d.activeTouch\u000aprevTouch.end=+new Date}}\u000afunction isMouseLikeTouchEvent(e){if(e.touches.length!=1){return false}\u000avar touch=e.touches[0]\u000areturn touch.radiusX<=1&&touch.radiusY<=1}\u000afunction farAway(touch,other){if(other.left==null){return true}\u000avar dx=other.left-touch.left,dy=other.top-touch.top\u000areturn dx*dx+dy*dy>20*20}\u000aon(d.scroller,"touchstart",function(e){if(!signalDOMEvent(cm,e)&&!isMouseLikeTouchEvent(e)&&!clickInGutter(cm,e)){d.input.ensurePolled()\u000aclearTimeout(touchFinished)\u000avar now=+new Date\u000ad.activeTouch={start:now,moved:false,prev:now-prevTouch.end<=300?prevTouch:null}\u000aif(e.touches.length==1){d.activeTouch.left=e.touches[0].pageX\u000ad.activeTouch.top=e.touches[0].pageY}}})\u000aon(d.scroller,"touchmove",function(){if(d.activeTouch){d.activeTouch.moved=true}})\u000aon(d.scroller,"touchend",function(e){var touch=d.activeTouch\u000aif(touch&&!eventInWidget(d,e)&&touch.left!=null&&!touch.moved&&new Date-touch.start<300){var pos=cm.coordsChar(d.activeTouch,"page"),range\u000aif(!touch.prev||farAway(touch,touch.prev))\u000a{range=new Range(pos,pos)}\u000aelse if(!touch.prev.prev||farAway(touch,touch.prev.prev))\u000a{range=cm.findWordAt(pos)}\u000aelse\u000a{range=new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)))}\u000acm.setSelection(range.anchor,range.head)\u000acm.focus()\u000ae_preventDefault(e)}\u000afinishTouch()})\u000aon(d.scroller,"touchcancel",finishTouch)\u000aon(d.scroller,"scroll",function(){if(d.scroller.clientHeight){updateScrollTop(cm,d.scroller.scrollTop)\u000asetScrollLeft(cm,d.scroller.scrollLeft,true)\u000asignal(cm,"scroll",cm)}})\u000aon(d.scroller,"mousewheel",function(e){return onScrollWheel(cm,e);})\u000aon(d.scroller,"DOMMouseScroll",function(e){return onScrollWheel(cm,e);})\u000aon(d.wrapper,"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0;})\u000ad.dragFunctions={enter:function(e){if(!signalDOMEvent(cm,e)){e_stop(e)}},over:function(e){if(!signalDOMEvent(cm,e)){onDragOver(cm,e);e_stop(e)}},start:function(e){return onDragStart(cm,e);},drop:operation(cm,onDrop),leave:function(e){if(!signalDOMEvent(cm,e)){clearDragCursor(cm)}}}\u000avar inp=d.input.getField()\u000aon(inp,"keyup",function(e){return onKeyUp.call(cm,e);})\u000aon(inp,"keydown",operation(cm,onKeyDown))\u000aon(inp,"keypress",operation(cm,onKeyPress))\u000aon(inp,"focus",function(e){return onFocus(cm,e);})\u000aon(inp,"blur",function(e){return onBlur(cm,e);})}\u000avar initHooks=[]\u000aCodeMirror.defineInitHook=function(f){return initHooks.push(f);}\u000afunction indentLine(cm,n,how,aggressive){var doc=cm.doc,state\u000aif(how==null){how="add"}\u000aif(how=="smart"){if(!doc.mode.indent){how="prev"}\u000aelse{state=getContextBefore(cm,n).state}}\u000avar tabSize=cm.options.tabSize\u000avar line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize)\u000aif(line.stateAfter){line.stateAfter=null}\u000avar curSpaceString=line.text.match(/^\u005cs*/)[0],indentation\u000aif(!aggressive&&!/\u005cS/.test(line.text)){indentation=0\u000ahow="not"}else if(how=="smart"){indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text)\u000aif(indentation==Pass||indentation>150){if(!aggressive){return}\u000ahow="prev"}}\u000aif(how=="prev"){if(n>doc.first){indentation=countColumn(getLine(doc,n-1).text,null,tabSize)}\u000aelse{indentation=0}}else if(how=="add"){indentation=curSpace+cm.options.indentUnit}else if(how=="subtract"){indentation=curSpace-cm.options.indentUnit}else if(typeof how=="number"){indentation=curSpace+how}\u000aindentation=Math.max(0,indentation)\u000avar indentString="",pos=0\u000aif(cm.options.indentWithTabs)\u000a{for(var i=Math.floor(indentation/tabSize);i;--i){pos+=tabSize;indentString+="\u005ct"}}\u000aif(pos<indentation){indentString+=spaceStr(indentation-pos)}\u000aif(indentString!=curSpaceString){replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input")\u000aline.stateAfter=null\u000areturn true}else{for(var i$1=0;i$1<doc.sel.ranges.length;i$1++){var range=doc.sel.ranges[i$1]\u000aif(range.head.line==n&&range.head.ch<curSpaceString.length){var pos$1=Pos(n,curSpaceString.length)\u000areplaceOneSelection(doc,i$1,new Range(pos$1,pos$1))\u000abreak}}}}\u000avar lastCopied=null\u000afunction setLastCopied(newLastCopied){lastCopied=newLastCopied}\u000afunction applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc\u000acm.display.shift=false\u000aif(!sel){sel=doc.sel}\u000avar paste=cm.state.pasteIncoming||origin=="paste"\u000avar textLines=splitLinesAuto(inserted),multiPaste=null\u000aif(paste&&sel.ranges.length>1){if(lastCopied&&lastCopied.text.join("\u005cn")==inserted){if(sel.ranges.length%lastCopied.text.length==0){multiPaste=[]\u000afor(var i=0;i<lastCopied.text.length;i++)\u000a{multiPaste.push(doc.splitLines(lastCopied.text[i]))}}}else if(textLines.length==sel.ranges.length&&cm.options.pasteLinesPerSelection){multiPaste=map(textLines,function(l){return[l];})}}\u000avar updateInput\u000afor(var i$1=sel.ranges.length-1;i$1>=0;i$1--){var range=sel.ranges[i$1]\u000avar from=range.from(),to=range.to()\u000aif(range.empty()){if(deleted&&deleted>0)\u000a{from=Pos(from.line,from.ch-deleted)}\u000aelse if(cm.state.overwrite&&!paste)\u000a{to=Pos(to.line,Math.min(getLine(doc,to.line).text.length,to.ch+lst(textLines).length))}\u000aelse if(lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\u005cn")==inserted)\u000a{from=to=Pos(from.line,0)}}\u000aupdateInput=cm.curOp.updateInput\u000avar changeEvent={from:from,to:to,text:multiPaste?multiPaste[i$1%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming?"cut":"+input")}\u000amakeChange(cm.doc,changeEvent)\u000asignalLater(cm,"inputRead",cm,changeEvent)}\u000aif(inserted&&!paste)\u000a{triggerElectric(cm,inserted)}\u000aensureCursorVisible(cm)\u000acm.curOp.updateInput=updateInput\u000acm.curOp.typing=true\u000acm.state.pasteIncoming=cm.state.cutIncoming=false}\u000afunction handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text")\u000aif(pasted){e.preventDefault()\u000aif(!cm.isReadOnly()&&!cm.options.disableInput)\u000a{runInOp(cm,function(){return applyTextInput(cm,pasted,0,null,"paste");})}\u000areturn true}}\u000afunction triggerElectric(cm,inserted){if(!cm.options.electricChars||!cm.options.smartIndent){return}\u000avar sel=cm.doc.sel\u000afor(var i=sel.ranges.length-1;i>=0;i--){var range=sel.ranges[i]\u000aif(range.head.ch>100||(i&&sel.ranges[i-1].head.line==range.head.line)){continue}\u000avar mode=cm.getModeAt(range.head)\u000avar indented=false\u000aif(mode.electricChars){for(var j=0;j<mode.electricChars.length;j++)\u000a{if(inserted.indexOf(mode.electricChars.charAt(j))>-1){indented=indentLine(cm,range.head.line,"smart")\u000abreak}}}else if(mode.electricInput){if(mode.electricInput.test(getLine(cm.doc,range.head.line).text.slice(0,range.head.ch)))\u000a{indented=indentLine(cm,range.head.line,"smart")}}\u000aif(indented){signalLater(cm,"electricInput",cm,range.head.line)}}}\u000afunction copyableRanges(cm){var text=[],ranges=[]\u000afor(var i=0;i<cm.doc.sel.ranges.length;i++){var line=cm.doc.sel.ranges[i].head.line\u000avar lineRange={anchor:Pos(line,0),head:Pos(line+1,0)}\u000aranges.push(lineRange)\u000atext.push(cm.getRange(lineRange.anchor,lineRange.head))}\u000areturn{text:text,ranges:ranges}}\u000afunction disableBrowserMagic(field,spellcheck){field.setAttribute("autocorrect","off")\u000afield.setAttribute("autocapitalize","off")\u000afield.setAttribute("spellcheck",!!spellcheck)}\u000afunction hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none")\u000avar div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;")\u000aif(webkit){te.style.width="1000px"}\u000aelse{te.setAttribute("wrap","off")}\u000aif(ios){te.style.border="1px solid black"}\u000adisableBrowserMagic(te)\u000areturn div}\u000afunction addEditorMethods(CodeMirror){var optionHandlers=CodeMirror.optionHandlers\u000avar helpers=CodeMirror.helpers={}\u000aCodeMirror.prototype={constructor:CodeMirror,focus:function(){window.focus();this.display.input.focus()},setOption:function(option,value){var options=this.options,old=options[option]\u000aif(options[option]==value&&option!="mode"){return}\u000aoptions[option]=value\u000aif(optionHandlers.hasOwnProperty(option))\u000a{operation(this,optionHandlers[option])(this,value,old)}\u000asignal(this,"optionChange",this,option)},getOption:function(option){return this.options[option]},getDoc:function(){return this.doc},addKeyMap:function(map,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map))},removeKeyMap:function(map){var maps=this.state.keyMaps\u000afor(var i=0;i<maps.length;++i)\u000a{if(maps[i]==map||maps[i].name==map){maps.splice(i,1)\u000areturn true}}},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec)\u000aif(mode.startState){throw new Error("Overlays may not be stateful.")}\u000ainsertSorted(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:(options&&options.priority)||0},function(overlay){return overlay.priority;})\u000athis.state.modeGen++\u000aregChange(this)}),removeOverlay:methodOp(function(spec){var this$1=this;var overlays=this.state.overlays\u000afor(var i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec\u000aif(cur==spec||typeof spec=="string"&&cur.name==spec){overlays.splice(i,1)\u000athis$1.state.modeGen++\u000aregChange(this$1)\u000areturn}}}),indentLine:methodOp(function(n,dir,aggressive){if(typeof dir!="string"&&typeof dir!="number"){if(dir==null){dir=this.options.smartIndent?"smart":"prev"}\u000aelse{dir=dir?"add":"subtract"}}\u000aif(isLine(this.doc,n)){indentLine(this,n,dir,aggressive)}}),indentSelection:methodOp(function(how){var this$1=this;var ranges=this.doc.sel.ranges,end=-1\u000afor(var i=0;i<ranges.length;i++){var range=ranges[i]\u000aif(!range.empty()){var from=range.from(),to=range.to()\u000avar start=Math.max(end,from.line)\u000aend=Math.min(this$1.lastLine(),to.line-(to.ch?0:1))+1\u000afor(var j=start;j<end;++j)\u000a{indentLine(this$1,j,how)}\u000avar newRanges=this$1.doc.sel.ranges\u000aif(from.ch==0&&ranges.length==newRanges.length&&newRanges[i].from().ch>0)\u000a{replaceOneSelection(this$1.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll)}}else if(range.head.line>end){indentLine(this$1,range.head.line,how,true)\u000aend=range.head.line\u000aif(i==this$1.doc.sel.primIndex){ensureCursorVisible(this$1)}}}}),getTokenAt:function(pos,precise){return takeToken(this,pos,precise)},getLineTokens:function(line,precise){return takeToken(this,Pos(line),precise,true)},getTokenTypeAt:function(pos){pos=clipPos(this.doc,pos)\u000avar styles=getLineStyles(this,getLine(this.doc,pos.line))\u000avar before=0,after=(styles.length-1)/2,ch=pos.ch\u000avar type\u000aif(ch==0){type=styles[2]}\u000aelse{for(;;){var mid=(before+after)>>1\u000aif((mid?styles[mid*2-1]:0)>=ch){after=mid}\u000aelse if(styles[mid*2+1]<ch){before=mid+1}\u000aelse{type=styles[mid*2+2];break}}}\u000avar cut=type?type.indexOf("overlay "):-1\u000areturn cut<0?type:cut==0?null:type.slice(0,cut-1)},getModeAt:function(pos){var mode=this.doc.mode\u000aif(!mode.innerMode){return mode}\u000areturn CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode},getHelper:function(pos,type){return this.getHelpers(pos,type)[0]},getHelpers:function(pos,type){var this$1=this;var found=[]\u000aif(!helpers.hasOwnProperty(type)){return found}\u000avar help=helpers[type],mode=this.getModeAt(pos)\u000aif(typeof mode[type]=="string"){if(help[mode[type]]){found.push(help[mode[type]])}}else if(mode[type]){for(var i=0;i<mode[type].length;i++){var val=help[mode[type][i]]\u000aif(val){found.push(val)}}}else if(mode.helperType&&help[mode.helperType]){found.push(help[mode.helperType])}else if(help[mode.name]){found.push(help[mode.name])}\u000afor(var i$1=0;i$1<help._global.length;i$1++){var cur=help._global[i$1]\u000aif(cur.pred(mode,this$1)&&indexOf(found,cur.val)==-1)\u000a{found.push(cur.val)}}\u000areturn found},getStateAfter:function(line,precise){var doc=this.doc\u000aline=clipLine(doc,line==null?doc.first+doc.size-1:line)\u000areturn getContextBefore(this,line+1,precise).state},cursorCoords:function(start,mode){var pos,range=this.doc.sel.primary()\u000aif(start==null){pos=range.head}\u000aelse if(typeof start=="object"){pos=clipPos(this.doc,start)}\u000aelse{pos=start?range.from():range.to()}\u000areturn cursorCoords(this,pos,mode||"page")},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page")},coordsChar:function(coords,mode){coords=fromCoordSystem(this,coords,mode||"page")\u000areturn coordsChar(this,coords.left,coords.top)},lineAtHeight:function(height,mode){height=fromCoordSystem(this,{top:height,left:0},mode||"page").top\u000areturn lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function(line,mode,includeWidgets){var end=false,lineObj\u000aif(typeof line=="number"){var last=this.doc.first+this.doc.size-1\u000aif(line<this.doc.first){line=this.doc.first}\u000aelse if(line>last){line=last;end=true}\u000alineObj=getLine(this.doc,line)}else{lineObj=line}\u000areturn intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page",includeWidgets||end).top+\u000a(end?this.doc.height-heightAtLine(lineObj):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(pos,node,scroll,vert,horiz){var display=this.display\u000apos=cursorCoords(this,clipPos(this.doc,pos))\u000avar top=pos.bottom,left=pos.left\u000anode.style.position="absolute"\u000anode.setAttribute("cm-ignore-events","true")\u000athis.display.input.setUneditable(node)\u000adisplay.sizer.appendChild(node)\u000aif(vert=="over"){top=pos.top}else if(vert=="above"||vert=="near"){var vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth)\u000aif((vert=='above'||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight)\u000a{top=pos.top-node.offsetHeight}\u000aelse if(pos.bottom+node.offsetHeight<=vspace)\u000a{top=pos.bottom}\u000aif(left+node.offsetWidth>hspace)\u000a{left=hspace-node.offsetWidth}}\u000anode.style.top=top+"px"\u000anode.style.left=node.style.right=""\u000aif(horiz=="right"){left=display.sizer.clientWidth-node.offsetWidth\u000anode.style.right="0px"}else{if(horiz=="left"){left=0}\u000aelse if(horiz=="middle"){left=(display.sizer.clientWidth-node.offsetWidth)/2}\u000anode.style.left=left+"px"}\u000aif(scroll)\u000a{scrollIntoView(this,{left:left,top:top,right:left+node.offsetWidth,bottom:top+node.offsetHeight})}},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(cmd){if(commands.hasOwnProperty(cmd))\u000a{return commands[cmd].call(null,this)}},triggerElectric:methodOp(function(text){triggerElectric(this,text)}),findPosH:function(from,amount,unit,visually){var this$1=this;var dir=1\u000aif(amount<0){dir=-1;amount=-amount}\u000avar cur=clipPos(this.doc,from)\u000afor(var i=0;i<amount;++i){cur=findPosH(this$1.doc,cur,dir,unit,visually)\u000aif(cur.hitSide){break}}\u000areturn cur},moveH:methodOp(function(dir,unit){var this$1=this;this.extendSelectionsBy(function(range){if(this$1.display.shift||this$1.doc.extend||range.empty())\u000a{return findPosH(this$1.doc,range.head,dir,unit,this$1.options.rtlMoveVisually)}\u000aelse\u000a{return dir<0?range.from():range.to()}},sel_move)}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc\u000aif(sel.somethingSelected())\u000a{doc.replaceSelection("",null,"+delete")}\u000aelse\u000a{deleteNearSelection(this,function(range){var other=findPosH(doc,range.head,dir,unit,false)\u000areturn dir<0?{from:other,to:range.head}:{from:range.head,to:other}})}}),findPosV:function(from,amount,unit,goalColumn){var this$1=this;var dir=1,x=goalColumn\u000aif(amount<0){dir=-1;amount=-amount}\u000avar cur=clipPos(this.doc,from)\u000afor(var i=0;i<amount;++i){var coords=cursorCoords(this$1,cur,"div")\u000aif(x==null){x=coords.left}\u000aelse{coords.left=x}\u000acur=findPosV(this$1,coords,dir,unit)\u000aif(cur.hitSide){break}}\u000areturn cur},moveV:methodOp(function(dir,unit){var this$1=this;var doc=this.doc,goals=[]\u000avar collapse=!this.display.shift&&!doc.extend&&doc.sel.somethingSelected()\u000adoc.extendSelectionsBy(function(range){if(collapse)\u000a{return dir<0?range.from():range.to()}\u000avar headPos=cursorCoords(this$1,range.head,"div")\u000aif(range.goalColumn!=null){headPos.left=range.goalColumn}\u000agoals.push(headPos.left)\u000avar pos=findPosV(this$1,headPos,dir,unit)\u000aif(unit=="page"&&range==doc.sel.primary())\u000a{addToScrollTop(this$1,charCoords(this$1,pos,"div").top-headPos.top)}\u000areturn pos},sel_move)\u000aif(goals.length){for(var i=0;i<doc.sel.ranges.length;i++)\u000a{doc.sel.ranges[i].goalColumn=goals[i]}}}),findWordAt:function(pos){var doc=this.doc,line=getLine(doc,pos.line).text\u000avar start=pos.ch,end=pos.ch\u000aif(line){var helper=this.getHelper(pos,"wordChars")\u000aif((pos.sticky=="before"||end==line.length)&&start){--start;}else{++end}\u000avar startChar=line.charAt(start)\u000avar check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper);}:/\u005cs/.test(startChar)?function(ch){return /\u005cs/.test(ch);}:function(ch){return(!/\u005cs/.test(ch)&&!isWordChar(ch));}\u000awhile(start>0&&check(line.charAt(start-1))){--start}\u000awhile(end<line.length&&check(line.charAt(end))){++end}}\u000areturn new Range(Pos(pos.line,start),Pos(pos.line,end))},toggleOverwrite:function(value){if(value!=null&&value==this.state.overwrite){return}\u000aif(this.state.overwrite=!this.state.overwrite)\u000a{addClass(this.display.cursorDiv,"CodeMirror-overwrite")}\u000aelse\u000a{rmClass(this.display.cursorDiv,"CodeMirror-overwrite")}\u000asignal(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:methodOp(function(x,y){scrollToCoords(this,x,y)}),getScrollInfo:function(){var scroller=this.display.scroller\u000areturn{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(range,margin){if(range==null){range={from:this.doc.sel.primary().head,to:null}\u000aif(margin==null){margin=this.options.cursorScrollMargin}}else if(typeof range=="number"){range={from:Pos(range,0),to:null}}else if(range.from==null){range={from:range,to:null}}\u000aif(!range.to){range.to=range.from}\u000arange.margin=margin||0\u000aif(range.from.line!=null){scrollToRange(this,range)}else{scrollToCoordsRange(this,range.from,range.to,range.margin)}}),setSize:methodOp(function(width,height){var this$1=this;var interpret=function(val){return typeof val=="number"||/^\u005cd+$/.test(String(val))?val+"px":val;}\u000aif(width!=null){this.display.wrapper.style.width=interpret(width)}\u000aif(height!=null){this.display.wrapper.style.height=interpret(height)}\u000aif(this.options.lineWrapping){clearLineMeasurementCache(this)}\u000avar lineNo=this.display.viewFrom\u000athis.doc.iter(lineNo,this.display.viewTo,function(line){if(line.widgets){for(var i=0;i<line.widgets.length;i++)\u000a{if(line.widgets[i].noHScroll){regLineChange(this$1,lineNo,"widget");break}}}\u000a++lineNo})\u000athis.curOp.forceUpdate=true\u000asignal(this,"refresh",this)}),operation:function(f){return runInOp(this,f)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight\u000aregChange(this)\u000athis.curOp.forceUpdate=true\u000aclearCaches(this)\u000ascrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop)\u000aupdateGutterSpace(this)\u000aif(oldHeight==null||Math.abs(oldHeight-textHeight(this.display))>.5)\u000a{estimateLineHeights(this)}\u000asignal(this,"refresh",this)}),swapDoc:methodOp(function(doc){var old=this.doc\u000aold.cm=null\u000aattachDoc(this,doc)\u000aclearCaches(this)\u000athis.display.input.reset()\u000ascrollToCoords(this,doc.scrollLeft,doc.scrollTop)\u000athis.curOp.forceScroll=true\u000asignalLater(this,"swapDoc",this,old)\u000areturn old}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}}\u000aeventMixin(CodeMirror)\u000aCodeMirror.registerHelper=function(type,name,value){if(!helpers.hasOwnProperty(type)){helpers[type]=CodeMirror[type]={_global:[]}}\u000ahelpers[type][name]=value}\u000aCodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value)\u000ahelpers[type]._global.push({pred:predicate,val:value})}}\u000afunction findPosH(doc,pos,dir,unit,visually){var oldPos=pos\u000avar origDir=dir\u000avar lineObj=getLine(doc,pos.line)\u000afunction findNextLine(){var l=pos.line+dir\u000aif(l<doc.first||l>=doc.first+doc.size){return false}\u000apos=new Pos(l,pos.ch,pos.sticky)\u000areturn lineObj=getLine(doc,l)}\u000afunction moveOnce(boundToLine){var next\u000aif(visually){next=moveVisually(doc.cm,lineObj,pos,dir)}else{next=moveLogically(lineObj,pos,dir)}\u000aif(next==null){if(!boundToLine&&findNextLine())\u000a{pos=endOfLine(visually,doc.cm,lineObj,pos.line,dir)}\u000aelse\u000a{return false}}else{pos=next}\u000areturn true}\u000aif(unit=="char"){moveOnce()}else if(unit=="column"){moveOnce(true)}else if(unit=="word"||unit=="group"){var sawType=null,group=unit=="group"\u000avar helper=doc.cm&&doc.cm.getHelper(pos,"wordChars")\u000afor(var first=true;;first=false){if(dir<0&&!moveOnce(!first)){break}\u000avar cur=lineObj.text.charAt(pos.ch)||"\u005cn"\u000avar type=isWordChar(cur,helper)?"w":group&&cur=="\u005cn"?"n":!group||/\u005cs/.test(cur)?null:"p"\u000aif(group&&!first&&!type){type="s"}\u000aif(sawType&&sawType!=type){if(dir<0){dir=1;moveOnce();pos.sticky="after"}\u000abreak}\u000aif(type){sawType=type}\u000aif(dir>0&&!moveOnce(!first)){break}}}\u000avar result=skipAtomic(doc,pos,oldPos,origDir,true)\u000aif(equalCursorPos(oldPos,result)){result.hitSide=true}\u000areturn result}\u000afunction findPosV(cm,pos,dir,unit){var doc=cm.doc,x=pos.left,y\u000aif(unit=="page"){var pageSize=Math.min(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)\u000avar moveAmount=Math.max(pageSize-.5*textHeight(cm.display),3)\u000ay=(dir>0?pos.bottom:pos.top)+dir*moveAmount}else if(unit=="line"){y=dir>0?pos.bottom+3:pos.top-3}\u000avar target\u000afor(;;){target=coordsChar(cm,x,y)\u000aif(!target.outside){break}\u000aif(dir<0?y<=0:y>=doc.height){target.hitSide=true;break}\u000ay+=dir*5}\u000areturn target}\u000avar ContentEditableInput=function(cm){this.cm=cm\u000athis.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null\u000athis.polling=new Delayed()\u000athis.composing=null\u000athis.gracePeriod=false\u000athis.readDOMTimeout=null};ContentEditableInput.prototype.init=function(display){var this$1=this;var input=this,cm=input.cm\u000avar div=input.div=display.lineDiv\u000adisableBrowserMagic(div,cm.options.spellcheck)\u000aon(div,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return}\u000aif(ie_version<=11){setTimeout(operation(cm,function(){return this$1.updateFromDOM();}),20)}})\u000aon(div,"compositionstart",function(e){this$1.composing={data:e.data,done:false}})\u000aon(div,"compositionupdate",function(e){if(!this$1.composing){this$1.composing={data:e.data,done:false}}})\u000aon(div,"compositionend",function(e){if(this$1.composing){if(e.data!=this$1.composing.data){this$1.readFromDOMSoon()}\u000athis$1.composing.done=true}})\u000aon(div,"touchstart",function(){return input.forceCompositionEnd();})\u000aon(div,"input",function(){if(!this$1.composing){this$1.readFromDOMSoon()}})\u000afunction onCopyCut(e){if(signalDOMEvent(cm,e)){return}\u000aif(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()})\u000aif(e.type=="cut"){cm.replaceSelection("",null,"cut")}}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm)\u000asetLastCopied({lineWise:true,text:ranges.text})\u000aif(e.type=="cut"){cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll)\u000acm.replaceSelection("",null,"cut")})}}\u000aif(e.clipboardData){e.clipboardData.clearData()\u000avar content=lastCopied.text.join("\u005cn")\u000ae.clipboardData.setData("Text",content)\u000aif(e.clipboardData.getData("Text")==content){e.preventDefault()\u000areturn}}\u000avar kludge=hiddenTextarea(),te=kludge.firstChild\u000acm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild)\u000ate.value=lastCopied.text.join("\u005cn")\u000avar hadFocus=document.activeElement\u000aselectInput(te)\u000asetTimeout(function(){cm.display.lineSpace.removeChild(kludge)\u000ahadFocus.focus()\u000aif(hadFocus==div){input.showPrimarySelection()}},50)}\u000aon(div,"copy",onCopyCut)\u000aon(div,"cut",onCopyCut)};ContentEditableInput.prototype.prepareSelection=function(){var result=prepareSelection(this.cm,false)\u000aresult.focus=this.cm.state.focused\u000areturn result};ContentEditableInput.prototype.showSelection=function(info,takeFocus){if(!info||!this.cm.display.view.length){return}\u000aif(info.focus||takeFocus){this.showPrimarySelection()}\u000athis.showMultipleSelections(info)};ContentEditableInput.prototype.showPrimarySelection=function(){var sel=window.getSelection(),cm=this.cm,prim=cm.doc.sel.primary()\u000avar from=prim.from(),to=prim.to()\u000aif(cm.display.viewTo==cm.display.viewFrom||from.line>=cm.display.viewTo||to.line<cm.display.viewFrom){sel.removeAllRanges()\u000areturn}\u000avar curAnchor=domToPos(cm,sel.anchorNode,sel.anchorOffset)\u000avar curFocus=domToPos(cm,sel.focusNode,sel.focusOffset)\u000aif(curAnchor&&!curAnchor.bad&&curFocus&&!curFocus.bad&&cmp(minPos(curAnchor,curFocus),from)==0&&cmp(maxPos(curAnchor,curFocus),to)==0)\u000a{return}\u000avar view=cm.display.view\u000avar start=(from.line>=cm.display.viewFrom&&posToDOM(cm,from))||{node:view[0].measure.map[2],offset:0}\u000avar end=to.line<cm.display.viewTo&&posToDOM(cm,to)\u000aif(!end){var measure=view[view.length-1].measure\u000avar map=measure.maps?measure.maps[measure.maps.length-1]:measure.map\u000aend={node:map[map.length-1],offset:map[map.length-2]-map[map.length-3]}}\u000aif(!start||!end){sel.removeAllRanges()\u000areturn}\u000avar old=sel.rangeCount&&sel.getRangeAt(0),rng\u000atry{rng=range(start.node,start.offset,end.offset,end.node)}\u000acatch(e){}\u000aif(rng){if(!gecko&&cm.state.focused){sel.collapse(start.node,start.offset)\u000aif(!rng.collapsed){sel.removeAllRanges()\u000asel.addRange(rng)}}else{sel.removeAllRanges()\u000asel.addRange(rng)}\u000aif(old&&sel.anchorNode==null){sel.addRange(old)}\u000aelse if(gecko){this.startGracePeriod()}}\u000athis.rememberSelection()};ContentEditableInput.prototype.startGracePeriod=function(){var this$1=this;clearTimeout(this.gracePeriod)\u000athis.gracePeriod=setTimeout(function(){this$1.gracePeriod=false\u000aif(this$1.selectionChanged())\u000a{this$1.cm.operation(function(){return this$1.cm.curOp.selectionChanged=true;})}},20)};ContentEditableInput.prototype.showMultipleSelections=function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors)\u000aremoveChildrenAndAdd(this.cm.display.selectionDiv,info.selection)};ContentEditableInput.prototype.rememberSelection=function(){var sel=window.getSelection()\u000athis.lastAnchorNode=sel.anchorNode;this.lastAnchorOffset=sel.anchorOffset\u000athis.lastFocusNode=sel.focusNode;this.lastFocusOffset=sel.focusOffset};ContentEditableInput.prototype.selectionInEditor=function(){var sel=window.getSelection()\u000aif(!sel.rangeCount){return false}\u000avar node=sel.getRangeAt(0).commonAncestorContainer\u000areturn contains(this.div,node)};ContentEditableInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"){if(!this.selectionInEditor())\u000a{this.showSelection(this.prepareSelection(),true)}\u000athis.div.focus()}};ContentEditableInput.prototype.blur=function(){this.div.blur()};ContentEditableInput.prototype.getField=function(){return this.div};ContentEditableInput.prototype.supportsTouch=function(){return true};ContentEditableInput.prototype.receivedFocus=function(){var input=this\u000aif(this.selectionInEditor())\u000a{this.pollSelection()}\u000aelse\u000a{runInOp(this.cm,function(){return input.cm.curOp.selectionChanged=true;})}\u000afunction poll(){if(input.cm.state.focused){input.pollSelection()\u000ainput.polling.set(input.cm.options.pollInterval,poll)}}\u000athis.polling.set(this.cm.options.pollInterval,poll)};ContentEditableInput.prototype.selectionChanged=function(){var sel=window.getSelection()\u000areturn sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset};ContentEditableInput.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged()){return}\u000avar sel=window.getSelection(),cm=this.cm\u000aif(android&&chrome&&this.cm.options.gutters.length&&isInGutter(sel.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs})\u000athis.blur()\u000athis.focus()\u000areturn}\u000aif(this.composing){return}\u000athis.rememberSelection()\u000avar anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset)\u000avar head=domToPos(cm,sel.focusNode,sel.focusOffset)\u000aif(anchor&&head){runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll)\u000aif(anchor.bad||head.bad){cm.curOp.selectionChanged=true}})}};ContentEditableInput.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout)\u000athis.readDOMTimeout=null}\u000avar cm=this.cm,display=cm.display,sel=cm.doc.sel.primary()\u000avar from=sel.from(),to=sel.to()\u000aif(from.ch==0&&from.line>cm.firstLine())\u000a{from=Pos(from.line-1,getLine(cm.doc,from.line-1).length)}\u000aif(to.ch==getLine(cm.doc,to.line).text.length&&to.line<cm.lastLine())\u000a{to=Pos(to.line+1,0)}\u000aif(from.line<display.viewFrom||to.line>display.viewTo-1){return false}\u000avar fromIndex,fromLine,fromNode\u000aif(from.line==display.viewFrom||(fromIndex=findViewIndex(cm,from.line))==0){fromLine=lineNo(display.view[0].line)\u000afromNode=display.view[0].node}else{fromLine=lineNo(display.view[fromIndex].line)\u000afromNode=display.view[fromIndex-1].node.nextSibling}\u000avar toIndex=findViewIndex(cm,to.line)\u000avar toLine,toNode\u000aif(toIndex==display.view.length-1){toLine=display.viewTo-1\u000atoNode=display.lineDiv.lastChild}else{toLine=lineNo(display.view[toIndex+1].line)-1\u000atoNode=display.view[toIndex+1].node.previousSibling}\u000aif(!fromNode){return false}\u000avar newText=cm.doc.splitLines(domTextBetween(cm,fromNode,toNode,fromLine,toLine))\u000avar oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length))\u000awhile(newText.length>1&&oldText.length>1){if(lst(newText)==lst(oldText)){newText.pop();oldText.pop();toLine--}\u000aelse if(newText[0]==oldText[0]){newText.shift();oldText.shift();fromLine++}\u000aelse{break}}\u000avar cutFront=0,cutEnd=0\u000avar newTop=newText[0],oldTop=oldText[0],maxCutFront=Math.min(newTop.length,oldTop.length)\u000awhile(cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront))\u000a{++cutFront}\u000avar newBot=lst(newText),oldBot=lst(oldText)\u000avar maxCutEnd=Math.min(newBot.length-(newText.length==1?cutFront:0),oldBot.length-(oldText.length==1?cutFront:0))\u000awhile(cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1))\u000a{++cutEnd}\u000aif(newText.length==1&&oldText.length==1&&fromLine==from.line){while(cutFront&&cutFront>from.ch&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1)){cutFront--\u000acutEnd++}}\u000anewText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd).replace(/^\u005cu200b+/,"")\u000anewText[0]=newText[0].slice(cutFront).replace(/\u005cu200b+$/,"")\u000avar chFrom=Pos(fromLine,cutFront)\u000avar chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0)\u000aif(newText.length>1||newText[0]||cmp(chFrom,chTo)){replaceRange(cm.doc,newText,chFrom,chTo,"+input")\u000areturn true}};ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()};ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()};ContentEditableInput.prototype.forceCompositionEnd=function(){if(!this.composing){return}\u000aclearTimeout(this.readDOMTimeout)\u000athis.composing=null\u000athis.updateFromDOM()\u000athis.div.blur()\u000athis.div.focus()};ContentEditableInput.prototype.readFromDOMSoon=function(){var this$1=this;if(this.readDOMTimeout!=null){return}\u000athis.readDOMTimeout=setTimeout(function(){this$1.readDOMTimeout=null\u000aif(this$1.composing){if(this$1.composing.done){this$1.composing=null}\u000aelse{return}}\u000athis$1.updateFromDOM()},80)};ContentEditableInput.prototype.updateFromDOM=function(){var this$1=this;if(this.cm.isReadOnly()||!this.pollContent())\u000a{runInOp(this.cm,function(){return regChange(this$1.cm);})}};ContentEditableInput.prototype.setUneditable=function(node){node.contentEditable="false"};ContentEditableInput.prototype.onKeyPress=function(e){if(e.charCode==0){return}\u000ae.preventDefault()\u000aif(!this.cm.isReadOnly())\u000a{operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0)}};ContentEditableInput.prototype.readOnlyChanged=function(val){this.div.contentEditable=String(val!="nocursor")};ContentEditableInput.prototype.onContextMenu=function(){};ContentEditableInput.prototype.resetPosition=function(){};ContentEditableInput.prototype.needsContentAttribute=true\u000afunction posToDOM(cm,pos){var view=findViewForLine(cm,pos.line)\u000aif(!view||view.hidden){return null}\u000avar line=getLine(cm.doc,pos.line)\u000avar info=mapFromLineView(view,line,pos.line)\u000avar order=getOrder(line,cm.doc.direction),side="left"\u000aif(order){var partPos=getBidiPartAt(order,pos.ch)\u000aside=partPos%2?"right":"left"}\u000avar result=nodeAndOffsetInLineMap(info.map,pos.ch,side)\u000aresult.offset=result.collapse=="right"?result.end:result.start\u000areturn result}\u000afunction isInGutter(node){for(var scan=node;scan;scan=scan.parentNode)\u000a{if(/CodeMirror-gutter-wrapper/.test(scan.className)){return true}}\u000areturn false}\u000afunction badPos(pos,bad){if(bad){pos.bad=true;}return pos}\u000afunction domTextBetween(cm,from,to,fromLine,toLine){var text="",closing=false,lineSep=cm.doc.lineSeparator()\u000afunction recognizeMarker(id){return function(marker){return marker.id==id;}}\u000afunction close(){if(closing){text+=lineSep\u000aclosing=false}}\u000afunction addText(str){if(str){close()\u000atext+=str}}\u000afunction walk(node){if(node.nodeType==1){var cmText=node.getAttribute("cm-text")\u000aif(cmText!=null){addText(cmText||node.textContent.replace(/\u005cu200b/g,""))\u000areturn}\u000avar markerID=node.getAttribute("cm-marker"),range\u000aif(markerID){var found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),recognizeMarker(+markerID))\u000aif(found.length&&(range=found[0].find(0)))\u000a{addText(getBetween(cm.doc,range.from,range.to).join(lineSep))}\u000areturn}\u000aif(node.getAttribute("contenteditable")=="false"){return}\u000avar isBlock=/^(pre|div|p)$/i.test(node.nodeName)\u000aif(isBlock){close()}\u000afor(var i=0;i<node.childNodes.length;i++)\u000a{walk(node.childNodes[i])}\u000aif(isBlock){closing=true}}else if(node.nodeType==3){addText(node.nodeValue)}}\u000afor(;;){walk(from)\u000aif(from==to){break}\u000afrom=from.nextSibling}\u000areturn text}\u000afunction domToPos(cm,node,offset){var lineNode\u000aif(node==cm.display.lineDiv){lineNode=cm.display.lineDiv.childNodes[offset]\u000aif(!lineNode){return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),true)}\u000anode=null;offset=0}else{for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv){return null}\u000aif(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv){break}}}\u000afor(var i=0;i<cm.display.view.length;i++){var lineView=cm.display.view[i]\u000aif(lineView.node==lineNode)\u000a{return locateNodeInLineView(lineView,node,offset)}}}\u000afunction locateNodeInLineView(lineView,node,offset){var wrapper=lineView.text.firstChild,bad=false\u000aif(!node||!contains(wrapper,node)){return badPos(Pos(lineNo(lineView.line),0),true)}\u000aif(node==wrapper){bad=true\u000anode=wrapper.childNodes[offset]\u000aoffset=0\u000aif(!node){var line=lineView.rest?lst(lineView.rest):lineView.line\u000areturn badPos(Pos(lineNo(line),line.text.length),bad)}}\u000avar textNode=node.nodeType==3?node:null,topNode=node\u000aif(!textNode&&node.childNodes.length==1&&node.firstChild.nodeType==3){textNode=node.firstChild\u000aif(offset){offset=textNode.nodeValue.length}}\u000awhile(topNode.parentNode!=wrapper){topNode=topNode.parentNode}\u000avar measure=lineView.measure,maps=measure.maps\u000afunction find(textNode,topNode,offset){for(var i=-1;i<(maps?maps.length:0);i++){var map=i<0?measure.map:maps[i]\u000afor(var j=0;j<map.length;j+=3){var curNode=map[j+2]\u000aif(curNode==textNode||curNode==topNode){var line=lineNo(i<0?lineView.line:lineView.rest[i])\u000avar ch=map[j]+offset\u000aif(offset<0||curNode!=textNode){ch=map[j+(offset?1:0)]}\u000areturn Pos(line,ch)}}}}\u000avar found=find(textNode,topNode,offset)\u000aif(found){return badPos(found,bad)}\u000afor(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;after;after=after.nextSibling){found=find(after,after.firstChild,0)\u000aif(found)\u000a{return badPos(Pos(found.line,found.ch-dist),bad)}\u000aelse\u000a{dist+=after.textContent.length}}\u000afor(var before=topNode.previousSibling,dist$1=offset;before;before=before.previousSibling){found=find(before,before.firstChild,-1)\u000aif(found)\u000a{return badPos(Pos(found.line,found.ch+dist$1),bad)}\u000aelse\u000a{dist$1+=before.textContent.length}}}\u000avar TextareaInput=function(cm){this.cm=cm\u000athis.prevInput=""\u000athis.pollingFast=false\u000athis.polling=new Delayed()\u000athis.hasSelection=false\u000athis.composing=null};TextareaInput.prototype.init=function(display){var this$1=this;var input=this,cm=this.cm\u000avar div=this.wrapper=hiddenTextarea()\u000avar te=this.textarea=div.firstChild\u000adisplay.wrapper.insertBefore(div,display.wrapper.firstChild)\u000aif(ios){te.style.width="0px"}\u000aon(te,"input",function(){if(ie&&ie_version>=9&&this$1.hasSelection){this$1.hasSelection=null}\u000ainput.poll()})\u000aon(te,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return}\u000acm.state.pasteIncoming=true\u000ainput.fastPoll()})\u000afunction prepareCopyCut(e){if(signalDOMEvent(cm,e)){return}\u000aif(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()})}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm)\u000asetLastCopied({lineWise:true,text:ranges.text})\u000aif(e.type=="cut"){cm.setSelections(ranges.ranges,null,sel_dontScroll)}else{input.prevInput=""\u000ate.value=ranges.text.join("\u005cn")\u000aselectInput(te)}}\u000aif(e.type=="cut"){cm.state.cutIncoming=true}}\u000aon(te,"cut",prepareCopyCut)\u000aon(te,"copy",prepareCopyCut)\u000aon(display.scroller,"paste",function(e){if(eventInWidget(display,e)||signalDOMEvent(cm,e)){return}\u000acm.state.pasteIncoming=true\u000ainput.focus()})\u000aon(display.lineSpace,"selectstart",function(e){if(!eventInWidget(display,e)){e_preventDefault(e)}})\u000aon(te,"compositionstart",function(){var start=cm.getCursor("from")\u000aif(input.composing){input.composing.range.clear()}\u000ainput.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})}})\u000aon(te,"compositionend",function(){if(input.composing){input.poll()\u000ainput.composing.range.clear()\u000ainput.composing=null}})};TextareaInput.prototype.prepareSelection=function(){var cm=this.cm,display=cm.display,doc=cm.doc\u000avar result=prepareSelection(cm)\u000aif(cm.options.moveInputWithCursor){var headPos=cursorCoords(cm,doc.sel.primary().head,"div")\u000avar wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect()\u000aresult.teTop=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top))\u000aresult.teLeft=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left))}\u000areturn result};TextareaInput.prototype.showSelection=function(drawn){var cm=this.cm,display=cm.display\u000aremoveChildrenAndAdd(display.cursorDiv,drawn.cursors)\u000aremoveChildrenAndAdd(display.selectionDiv,drawn.selection)\u000aif(drawn.teTop!=null){this.wrapper.style.top=drawn.teTop+"px"\u000athis.wrapper.style.left=drawn.teLeft+"px"}};TextareaInput.prototype.reset=function(typing){if(this.contextMenuPending||this.composing){return}\u000avar cm=this.cm\u000aif(cm.somethingSelected()){this.prevInput=""\u000avar content=cm.getSelection()\u000athis.textarea.value=content\u000aif(cm.state.focused){selectInput(this.textarea)}\u000aif(ie&&ie_version>=9){this.hasSelection=content}}else if(!typing){this.prevInput=this.textarea.value=""\u000aif(ie&&ie_version>=9){this.hasSelection=null}}};TextareaInput.prototype.getField=function(){return this.textarea};TextareaInput.prototype.supportsTouch=function(){return false};TextareaInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!mobile||activeElt()!=this.textarea)){try{this.textarea.focus()}\u000acatch(e){}}};TextareaInput.prototype.blur=function(){this.textarea.blur()};TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};TextareaInput.prototype.receivedFocus=function(){this.slowPoll()};TextareaInput.prototype.slowPoll=function(){var this$1=this;if(this.pollingFast){return}\u000athis.polling.set(this.cm.options.pollInterval,function(){this$1.poll()\u000aif(this$1.cm.state.focused){this$1.slowPoll()}})};TextareaInput.prototype.fastPoll=function(){var missed=false,input=this\u000ainput.pollingFast=true\u000afunction p(){var changed=input.poll()\u000aif(!changed&&!missed){missed=true;input.polling.set(60,p)}\u000aelse{input.pollingFast=false;input.slowPoll()}}\u000ainput.polling.set(20,p)};TextareaInput.prototype.poll=function(){var this$1=this;var cm=this.cm,input=this.textarea,prevInput=this.prevInput\u000aif(this.contextMenuPending||!cm.state.focused||(hasSelection(input)&&!prevInput&&!this.composing)||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq)\u000a{return false}\u000avar text=input.value\u000aif(text==prevInput&&!cm.somethingSelected()){return false}\u000aif(ie&&ie_version>=9&&this.hasSelection===text||mac&&/[\u005cuf700-\u005cuf7ff]/.test(text)){cm.display.input.reset()\u000areturn false}\u000aif(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0)\u000aif(first==0x200b&&!prevInput){prevInput="\u005cu200b"}\u000aif(first==0x21da){this.reset();return this.cm.execCommand("undo")}}\u000avar same=0,l=Math.min(prevInput.length,text.length)\u000awhile(same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same)){++same}\u000arunInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,this$1.composing?"*compose":null)\u000aif(text.length>1000||text.indexOf("\u005cn")>-1){input.value=this$1.prevInput=""}\u000aelse{this$1.prevInput=text}\u000aif(this$1.composing){this$1.composing.range.clear()\u000athis$1.composing.range=cm.markText(this$1.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"})}})\u000areturn true};TextareaInput.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=false}};TextareaInput.prototype.onKeyPress=function(){if(ie&&ie_version>=9){this.hasSelection=null}\u000athis.fastPoll()};TextareaInput.prototype.onContextMenu=function(e){var input=this,cm=input.cm,display=cm.display,te=input.textarea\u000avar pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop\u000aif(!pos||presto){return}\u000avar reset=cm.options.resetSelectionOnContextMenu\u000aif(reset&&cm.doc.sel.contains(pos)==-1)\u000a{operation(cm,setSelection)(cm.doc,simpleSelection(pos),sel_dontScroll)}\u000avar oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText\u000ainput.wrapper.style.cssText="position: absolute"\u000avar wrapperBox=input.wrapper.getBoundingClientRect()\u000ate.style.cssText="position: absolute; width: 30px; height: 30px;\u005cn      top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px;\u005cn      z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+";\u005cn      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);"\u000avar oldScrollY\u000aif(webkit){oldScrollY=window.scrollY}\u000adisplay.input.focus()\u000aif(webkit){window.scrollTo(null,oldScrollY)}\u000adisplay.input.reset()\u000aif(!cm.somethingSelected()){te.value=input.prevInput=" "}\u000ainput.contextMenuPending=true\u000adisplay.selForContextMenu=cm.doc.sel\u000aclearTimeout(display.detectingSelectAll)\u000afunction prepareSelectAllHack(){if(te.selectionStart!=null){var selected=cm.somethingSelected()\u000avar extval="\u005cu200b"+(selected?te.value:"")\u000ate.value="\u005cu21da"\u000ate.value=extval\u000ainput.prevInput=selected?"":"\u005cu200b"\u000ate.selectionStart=1;te.selectionEnd=extval.length\u000adisplay.selForContextMenu=cm.doc.sel}}\u000afunction rehide(){input.contextMenuPending=false\u000ainput.wrapper.style.cssText=oldWrapperCSS\u000ate.style.cssText=oldCSS\u000aif(ie&&ie_version<9){display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos)}\u000aif(te.selectionStart!=null){if(!ie||(ie&&ie_version<9)){prepareSelectAllHack()}\u000avar i=0,poll=function(){if(display.selForContextMenu==cm.doc.sel&&te.selectionStart==0&&te.selectionEnd>0&&input.prevInput=="\u005cu200b"){operation(cm,selectAll)(cm)}else if(i++<10){display.detectingSelectAll=setTimeout(poll,500)}else{display.selForContextMenu=null\u000adisplay.input.reset()}}\u000adisplay.detectingSelectAll=setTimeout(poll,200)}}\u000aif(ie&&ie_version>=9){prepareSelectAllHack()}\u000aif(captureRightClick){e_stop(e)\u000avar mouseup=function(){off(window,"mouseup",mouseup)\u000asetTimeout(rehide,20)}\u000aon(window,"mouseup",mouseup)}else{setTimeout(rehide,50)}};TextareaInput.prototype.readOnlyChanged=function(val){if(!val){this.reset()}\u000athis.textarea.disabled=val=="nocursor"};TextareaInput.prototype.setUneditable=function(){};TextareaInput.prototype.needsContentAttribute=false\u000afunction fromTextArea(textarea,options){options=options?copyObj(options):{}\u000aoptions.value=textarea.value\u000aif(!options.tabindex&&textarea.tabIndex)\u000a{options.tabindex=textarea.tabIndex}\u000aif(!options.placeholder&&textarea.placeholder)\u000a{options.placeholder=textarea.placeholder}\u000aif(options.autofocus==null){var hasFocus=activeElt()\u000aoptions.autofocus=hasFocus==textarea||textarea.getAttribute("autofocus")!=null&&hasFocus==document.body}\u000afunction save(){textarea.value=cm.getValue()}\u000avar realSubmit\u000aif(textarea.form){on(textarea.form,"submit",save)\u000aif(!options.leaveSubmitMethodAlone){var form=textarea.form\u000arealSubmit=form.submit\u000atry{var wrappedSubmit=form.submit=function(){save()\u000aform.submit=realSubmit\u000aform.submit()\u000aform.submit=wrappedSubmit}}catch(e){}}}\u000aoptions.finishInit=function(cm){cm.save=save\u000acm.getTextArea=function(){return textarea;}\u000acm.toTextArea=function(){cm.toTextArea=isNaN\u000asave()\u000atextarea.parentNode.removeChild(cm.getWrapperElement())\u000atextarea.style.display=""\u000aif(textarea.form){off(textarea.form,"submit",save)\u000aif(typeof textarea.form.submit=="function")\u000a{textarea.form.submit=realSubmit}}}}\u000atextarea.style.display="none"\u000avar cm=CodeMirror(function(node){return textarea.parentNode.insertBefore(node,textarea.nextSibling);},options)\u000areturn cm}\u000afunction addLegacyProps(CodeMirror){CodeMirror.off=off\u000aCodeMirror.on=on\u000aCodeMirror.wheelEventPixels=wheelEventPixels\u000aCodeMirror.Doc=Doc\u000aCodeMirror.splitLines=splitLinesAuto\u000aCodeMirror.countColumn=countColumn\u000aCodeMirror.findColumn=findColumn\u000aCodeMirror.isWordChar=isWordCharBasic\u000aCodeMirror.Pass=Pass\u000aCodeMirror.signal=signal\u000aCodeMirror.Line=Line\u000aCodeMirror.changeEnd=changeEnd\u000aCodeMirror.scrollbarModel=scrollbarModel\u000aCodeMirror.Pos=Pos\u000aCodeMirror.cmpPos=cmp\u000aCodeMirror.modes=modes\u000aCodeMirror.mimeModes=mimeModes\u000aCodeMirror.resolveMode=resolveMode\u000aCodeMirror.getMode=getMode\u000aCodeMirror.modeExtensions=modeExtensions\u000aCodeMirror.extendMode=extendMode\u000aCodeMirror.copyState=copyState\u000aCodeMirror.startState=startState\u000aCodeMirror.innerMode=innerMode\u000aCodeMirror.commands=commands\u000aCodeMirror.keyMap=keyMap\u000aCodeMirror.keyName=keyName\u000aCodeMirror.isModifierKey=isModifierKey\u000aCodeMirror.lookupKey=lookupKey\u000aCodeMirror.normalizeKeyMap=normalizeKeyMap\u000aCodeMirror.StringStream=StringStream\u000aCodeMirror.SharedTextMarker=SharedTextMarker\u000aCodeMirror.TextMarker=TextMarker\u000aCodeMirror.LineWidget=LineWidget\u000aCodeMirror.e_preventDefault=e_preventDefault\u000aCodeMirror.e_stopPropagation=e_stopPropagation\u000aCodeMirror.e_stop=e_stop\u000aCodeMirror.addClass=addClass\u000aCodeMirror.contains=contains\u000aCodeMirror.rmClass=rmClass\u000aCodeMirror.keyNames=keyNames}\u000adefineOptions(CodeMirror)\u000aaddEditorMethods(CodeMirror)\u000avar dontDelegate="iter insert remove copy getEditor constructor".split(" ")\u000afor(var prop in Doc.prototype){if(Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0)\u000a{CodeMirror.prototype[prop]=(function(method){return function(){return method.apply(this.doc,arguments)}})(Doc.prototype[prop])}}\u000aeventMixin(Doc)\u000aCodeMirror.inputStyles={"textarea":TextareaInput,"contenteditable":ContentEditableInput}\u000aCodeMirror.defineMode=function(name ){if(!CodeMirror.defaults.mode&&name!="null"){CodeMirror.defaults.mode=name}\u000adefineMode.apply(this,arguments)}\u000aCodeMirror.defineMIME=defineMIME\u000aCodeMirror.defineMode("null",function(){return({token:function(stream){return stream.skipToEnd();}});})\u000aCodeMirror.defineMIME("text/plain","null")\u000aCodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func}\u000aCodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func}\u000aCodeMirror.fromTextArea=fromTextArea\u000aaddLegacyProps(CodeMirror)\u000aCodeMirror.version="5.34.0"\u000areturn CodeMirror;})));(function(mod){if(typeof exports=="object"&&typeof module=="object")\u000amod(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"));else if(typeof define=="function"&&define.amd)\u000adefine(["../../lib/codemirror","../xml/xml","../meta"],mod);else\u000amod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineMode("markdown",function(cmCfg,modeCfg){var htmlMode=CodeMirror.getMode(cmCfg,"text/html");var htmlModeMissing=htmlMode.name=="null"\u000afunction getMode(name){if(CodeMirror.findModeByName){var found=CodeMirror.findModeByName(name);if(found)name=found.mime||found.mimes[0];}\u000avar mode=CodeMirror.getMode(cmCfg,name);return mode.name=="null"?null:mode;}\u000aif(modeCfg.highlightFormatting===undefined)\u000amodeCfg.highlightFormatting=false;if(modeCfg.maxBlockquoteDepth===undefined)\u000amodeCfg.maxBlockquoteDepth=0;if(modeCfg.taskLists===undefined)modeCfg.taskLists=false;if(modeCfg.strikethrough===undefined)\u000amodeCfg.strikethrough=false;if(modeCfg.emoji===undefined)\u000amodeCfg.emoji=false;if(modeCfg.fencedCodeBlockHighlighting===undefined)\u000amodeCfg.fencedCodeBlockHighlighting=true;if(modeCfg.xml===undefined)\u000amodeCfg.xml=true;if(modeCfg.tokenTypeOverrides===undefined)\u000amodeCfg.tokenTypeOverrides={};var tokenTypes={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(var tokenType in tokenTypes){if(tokenTypes.hasOwnProperty(tokenType)&&modeCfg.tokenTypeOverrides[tokenType]){tokenTypes[tokenType]=modeCfg.tokenTypeOverrides[tokenType];}}\u000avar hrRE=/^([*\u005c-_])(?:\u005cs*\u005c1){2,}\u005cs*$/,listRE=/^(?:[*\u005c-+]|^[0-9]+([.)]))\u005cs+/,taskListRE=/^\u005c[(x| )\u005c](?=\u005cs)/i,atxHeaderRE=modeCfg.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,setextHeaderRE=/^ *(?:\u005c={1,}|-{1,})\u005cs*$/,textRE=/^[^#!\u005c[\u005c]*_\u005c\u005c<>` "'(~:]+/,fencedCodeRE=/^(~~~+|```+)[ \u005ct]*([\u005cw+#-]*)[^\u005cn`]*$/,linkDefRE=/^\u005cs*\u005c[[^\u005c]]+?\u005c]:\u005cs*\u005cS+(\u005cs*\u005cS*\u005cs*)?$/,punctuation=/[!\u005c"#$%&\u005c'()*+,\u005c-\u005c.\u005c/:;<=>?@\u005c[\u005c\u005c\u005c]^_`{|}~\u2014]/,expandedTab="    "\u000afunction switchInline(stream,state,f){state.f=state.inline=f;return f(stream,state);}\u000afunction switchBlock(stream,state,f){state.f=state.block=f;return f(stream,state);}\u000afunction lineIsEmpty(line){return!line||!/\u005cS/.test(line.string)}\u000afunction blankLine(state){state.linkTitle=false;state.linkHref=false;state.linkText=false;state.em=false;state.strong=false;state.strikethrough=false;state.quote=0;state.indentedCode=false;if(state.f==htmlBlock){state.f=inlineNormal;state.block=blockNormal;}\u000astate.trailingSpace=0;state.trailingSpaceNewLine=false;state.prevLine=state.thisLine\u000astate.thisLine={stream:null}\u000areturn null;}\u000afunction blockNormal(stream,state){var firstTokenOnLine=stream.column()===state.indentation;var prevLineLineIsEmpty=lineIsEmpty(state.prevLine.stream);var prevLineIsIndentedCode=state.indentedCode;var prevLineIsHr=state.prevLine.hr;var prevLineIsList=state.list!==false;var maxNonCodeIndentation=(state.listStack[state.listStack.length-1]||0)+3;state.indentedCode=false;var lineIndentation=state.indentation;if(state.indentationDiff===null){state.indentationDiff=state.indentation;if(prevLineIsList){state.em=false;state.strong=false;state.code=false;state.strikethrough=false;state.list=null;while(lineIndentation<state.listStack[state.listStack.length-1]){state.listStack.pop();if(state.listStack.length){state.indentation=state.listStack[state.listStack.length-1];}else{state.list=false;}}\u000aif(state.list!==false){state.indentationDiff=lineIndentation-state.listStack[state.listStack.length-1]}}}\u000avar allowsInlineContinuation=(!prevLineLineIsEmpty&&!prevLineIsHr&&!state.prevLine.header&&(!prevLineIsList||!prevLineIsIndentedCode)&&!state.prevLine.fencedCodeEnd);var isHr=(state.list===false||prevLineIsHr||prevLineLineIsEmpty)&&state.indentation<=maxNonCodeIndentation&&stream.match(hrRE);var match=null;if(state.indentationDiff>=4&&(prevLineIsIndentedCode||state.prevLine.fencedCodeEnd||state.prevLine.header||prevLineLineIsEmpty)){stream.skipToEnd();state.indentedCode=true;return tokenTypes.code;}else if(stream.eatSpace()){return null;}else if(firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(atxHeaderRE))&&match[1].length<=6){state.quote=0;state.header=match[1].length;state.thisLine.header=true;if(modeCfg.highlightFormatting)state.formatting="header";state.f=state.inline;return getType(state);}else if(state.indentation<=maxNonCodeIndentation&&stream.eat('>')){state.quote=firstTokenOnLine?1:state.quote+1;if(modeCfg.highlightFormatting)state.formatting="quote";stream.eatSpace();return getType(state);}else if(!isHr&&!state.setext&&firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(listRE))){var listType=match[1]?"ol":"ul";state.indentation=lineIndentation+stream.current().length;state.list=true;state.quote=0;state.listStack.push(state.indentation);if(modeCfg.taskLists&&stream.match(taskListRE,false)){state.taskList=true;}\u000astate.f=state.inline;if(modeCfg.highlightFormatting)state.formatting=["list","list-"+listType];return getType(state);}else if(firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(fencedCodeRE,true))){state.quote=0;state.fencedEndRE=new RegExp(match[1]+"+ *$");state.localMode=modeCfg.fencedCodeBlockHighlighting&&getMode(match[2]);if(state.localMode)state.localState=CodeMirror.startState(state.localMode);state.f=state.block=local;if(modeCfg.highlightFormatting)state.formatting="code-block";state.code=-1\u000areturn getType(state);}else if(state.setext||((!allowsInlineContinuation||!prevLineIsList)&&!state.quote&&state.list===false&&!state.code&&!isHr&&!linkDefRE.test(stream.string)&&(match=stream.lookAhead(1))&&(match=match.match(setextHeaderRE)))){if(!state.setext){state.header=match[0].charAt(0)=='='?1:2;state.setext=state.header;}else{state.header=state.setext;state.setext=0;stream.skipToEnd();if(modeCfg.highlightFormatting)state.formatting="header";}\u000astate.thisLine.header=true;state.f=state.inline;return getType(state);}else if(isHr){stream.skipToEnd();state.hr=true;state.thisLine.hr=true;return tokenTypes.hr;}else if(stream.peek()==='['){return switchInline(stream,state,footnoteLink);}\u000areturn switchInline(stream,state,state.inline);}\u000afunction htmlBlock(stream,state){var style=htmlMode.token(stream,state.htmlState);if(!htmlModeMissing){var inner=CodeMirror.innerMode(htmlMode,state.htmlState)\u000aif((inner.mode.name=="xml"&&inner.state.tagStart===null&&(!inner.state.context&&inner.state.tokenize.isInText))||(state.md_inside&&stream.current().indexOf(">")>-1)){state.f=inlineNormal;state.block=blockNormal;state.htmlState=null;}}\u000areturn style;}\u000afunction local(stream,state){var currListInd=state.listStack[state.listStack.length-1]||0;var hasExitedList=state.indentation<currListInd;var maxFencedEndInd=currListInd+3;if(state.fencedEndRE&&state.indentation<=maxFencedEndInd&&(hasExitedList||stream.match(state.fencedEndRE))){if(modeCfg.highlightFormatting)state.formatting="code-block";var returnType;if(!hasExitedList)returnType=getType(state)\u000astate.localMode=state.localState=null;state.block=blockNormal;state.f=inlineNormal;state.fencedEndRE=null;state.code=0\u000astate.thisLine.fencedCodeEnd=true;if(hasExitedList)return switchBlock(stream,state,state.block);return returnType;}else if(state.localMode){return state.localMode.token(stream,state.localState);}else{stream.skipToEnd();return tokenTypes.code;}}\u000afunction getType(state){var styles=[];if(state.formatting){styles.push(tokenTypes.formatting);if(typeof state.formatting==="string")state.formatting=[state.formatting];for(var i=0;i<state.formatting.length;i++){styles.push(tokenTypes.formatting+"-"+state.formatting[i]);if(state.formatting[i]==="header"){styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.header);}\u000aif(state.formatting[i]==="quote"){if(!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote){styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.quote);}else{styles.push("error");}}}}\u000aif(state.taskOpen){styles.push("meta");return styles.length?styles.join(' '):null;}\u000aif(state.taskClosed){styles.push("property");return styles.length?styles.join(' '):null;}\u000aif(state.linkHref){styles.push(tokenTypes.linkHref,"url");}else{if(state.strong){styles.push(tokenTypes.strong);}\u000aif(state.em){styles.push(tokenTypes.em);}\u000aif(state.strikethrough){styles.push(tokenTypes.strikethrough);}\u000aif(state.emoji){styles.push(tokenTypes.emoji);}\u000aif(state.linkText){styles.push(tokenTypes.linkText);}\u000aif(state.code){styles.push(tokenTypes.code);}\u000aif(state.image){styles.push(tokenTypes.image);}\u000aif(state.imageAltText){styles.push(tokenTypes.imageAltText,"link");}\u000aif(state.imageMarker){styles.push(tokenTypes.imageMarker);}}\u000aif(state.header){styles.push(tokenTypes.header,tokenTypes.header+"-"+state.header);}\u000aif(state.quote){styles.push(tokenTypes.quote);if(!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote){styles.push(tokenTypes.quote+"-"+state.quote);}else{styles.push(tokenTypes.quote+"-"+modeCfg.maxBlockquoteDepth);}}\u000aif(state.list!==false){var listMod=(state.listStack.length-1)%3;if(!listMod){styles.push(tokenTypes.list1);}else if(listMod===1){styles.push(tokenTypes.list2);}else{styles.push(tokenTypes.list3);}}\u000aif(state.trailingSpaceNewLine){styles.push("trailing-space-new-line");}else if(state.trailingSpace){styles.push("trailing-space-"+(state.trailingSpace%2?"a":"b"));}\u000areturn styles.length?styles.join(' '):null;}\u000afunction handleText(stream,state){if(stream.match(textRE,true)){return getType(state);}\u000areturn undefined;}\u000afunction inlineNormal(stream,state){var style=state.text(stream,state);if(typeof style!=='undefined')\u000areturn style;if(state.list){state.list=null;return getType(state);}\u000aif(state.taskList){var taskOpen=stream.match(taskListRE,true)[1]===" ";if(taskOpen)state.taskOpen=true;else state.taskClosed=true;if(modeCfg.highlightFormatting)state.formatting="task";state.taskList=false;return getType(state);}\u000astate.taskOpen=false;state.taskClosed=false;if(state.header&&stream.match(/^#+$/,true)){if(modeCfg.highlightFormatting)state.formatting="header";return getType(state);}\u000avar ch=stream.next();if(state.linkTitle){state.linkTitle=false;var matchCh=ch;if(ch==='('){matchCh=')';}\u000amatchCh=(matchCh+'').replace(/([.?*+^\u005c[\u005c]\u005c\u005c(){}|-])/g,"\u005c\u005c$1");var regex='^\u005c\u005cs*(?:[^'+matchCh+'\u005c\u005c\u005c\u005c]+|\u005c\u005c\u005c\u005c\u005c\u005c\u005c\u005c|\u005c\u005c\u005c\u005c.)'+matchCh;if(stream.match(new RegExp(regex),true)){return tokenTypes.linkHref;}}\u000aif(ch==='`'){var previousFormatting=state.formatting;if(modeCfg.highlightFormatting)state.formatting="code";stream.eatWhile('`');var count=stream.current().length\u000aif(state.code==0&&(!state.quote||count==1)){state.code=count\u000areturn getType(state)}else if(count==state.code){var t=getType(state)\u000astate.code=0\u000areturn t}else{state.formatting=previousFormatting\u000areturn getType(state)}}else if(state.code){return getType(state);}\u000aif(ch==='\u005c\u005c'){stream.next();if(modeCfg.highlightFormatting){var type=getType(state);var formattingEscape=tokenTypes.formatting+"-escape";return type?type+" "+formattingEscape:formattingEscape;}}\u000aif(ch==='!'&&stream.match(/\u005c[[^\u005c]]*\u005c] ?(?:\u005c(|\u005c[)/,false)){state.imageMarker=true;state.image=true;if(modeCfg.highlightFormatting)state.formatting="image";return getType(state);}\u000aif(ch==='['&&state.imageMarker&&stream.match(/[^\u005c]]*\u005c](\u005c(.*?\u005c)| ?\u005c[.*?\u005c])/,false)){state.imageMarker=false;state.imageAltText=true\u000aif(modeCfg.highlightFormatting)state.formatting="image";return getType(state);}\u000aif(ch===']'&&state.imageAltText){if(modeCfg.highlightFormatting)state.formatting="image";var type=getType(state);state.imageAltText=false;state.image=false;state.inline=state.f=linkHref;return type;}\u000aif(ch==='['&&!state.image){state.linkText=true;if(modeCfg.highlightFormatting)state.formatting="link";return getType(state);}\u000aif(ch===']'&&state.linkText){if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);state.linkText=false;state.inline=state.f=stream.match(/\u005c(.*?\u005c)| ?\u005c[.*?\u005c]/,false)?linkHref:inlineNormal\u000areturn type;}\u000aif(ch==='<'&&stream.match(/^(https?|ftps?):\u005c/\u005c/(?:[^\u005c\u005c>]|\u005c\u005c.)+>/,false)){state.f=state.inline=linkInline;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}\u000areturn type+tokenTypes.linkInline;}\u000aif(ch==='<'&&stream.match(/^[^> \u005c\u005c]+@(?:[^\u005c\u005c>]|\u005c\u005c.)+>/,false)){state.f=state.inline=linkInline;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}\u000areturn type+tokenTypes.linkEmail;}\u000aif(modeCfg.xml&&ch==='<'&&stream.match(/^(!--|[a-z]+(?:\u005cs+[a-z_:.\u005c-]+(?:\u005cs*=\u005cs*[^ >]+)?)*\u005cs*>)/i,false)){var end=stream.string.indexOf(">",stream.pos);if(end!=-1){var atts=stream.string.substring(stream.start,end);if(/markdown\u005cs*=\u005cs*('|"){0,1}1('|"){0,1}/.test(atts))state.md_inside=true;}\u000astream.backUp(1);state.htmlState=CodeMirror.startState(htmlMode);return switchBlock(stream,state,htmlBlock);}\u000aif(modeCfg.xml&&ch==='<'&&stream.match(/^\u005c/\u005cw*?>/)){state.md_inside=false;return"tag";}else if(ch==="*"||ch==="_"){var len=1,before=stream.pos==1?" ":stream.string.charAt(stream.pos-2)\u000awhile(len<3&&stream.eat(ch))len++\u000avar after=stream.peek()||" "\u000avar leftFlanking=!/\u005cs/.test(after)&&(!punctuation.test(after)||/\u005cs/.test(before)||punctuation.test(before))\u000avar rightFlanking=!/\u005cs/.test(before)&&(!punctuation.test(before)||/\u005cs/.test(after)||punctuation.test(after))\u000avar setEm=null,setStrong=null\u000aif(len%2){if(!state.em&&leftFlanking&&(ch==="*"||!rightFlanking||punctuation.test(before)))\u000asetEm=true\u000aelse if(state.em==ch&&rightFlanking&&(ch==="*"||!leftFlanking||punctuation.test(after)))\u000asetEm=false}\u000aif(len>1){if(!state.strong&&leftFlanking&&(ch==="*"||!rightFlanking||punctuation.test(before)))\u000asetStrong=true\u000aelse if(state.strong==ch&&rightFlanking&&(ch==="*"||!leftFlanking||punctuation.test(after)))\u000asetStrong=false}\u000aif(setStrong!=null||setEm!=null){if(modeCfg.highlightFormatting)state.formatting=setEm==null?"strong":setStrong==null?"em":"strong em"\u000aif(setEm===true)state.em=ch\u000aif(setStrong===true)state.strong=ch\u000avar t=getType(state)\u000aif(setEm===false)state.em=false\u000aif(setStrong===false)state.strong=false\u000areturn t}}else if(ch===' '){if(stream.eat('*')||stream.eat('_')){if(stream.peek()===' '){return getType(state);}else{stream.backUp(1);}}}\u000aif(modeCfg.strikethrough){if(ch==='~'&&stream.eatWhile(ch)){if(state.strikethrough){if(modeCfg.highlightFormatting)state.formatting="strikethrough";var t=getType(state);state.strikethrough=false;return t;}else if(stream.match(/^[^\u005cs]/,false)){state.strikethrough=true;if(modeCfg.highlightFormatting)state.formatting="strikethrough";return getType(state);}}else if(ch===' '){if(stream.match(/^~~/,true)){if(stream.peek()===' '){return getType(state);}else{stream.backUp(2);}}}}\u000aif(modeCfg.emoji&&ch===":"&&stream.match(/^[a-z_\u005cd+-]+:/)){state.emoji=true;if(modeCfg.highlightFormatting)state.formatting="emoji";var retType=getType(state);state.emoji=false;return retType;}\u000aif(ch===' '){if(stream.match(/ +$/,false)){state.trailingSpace++;}else if(state.trailingSpace){state.trailingSpaceNewLine=true;}}\u000areturn getType(state);}\u000afunction linkInline(stream,state){var ch=stream.next();if(ch===">"){state.f=state.inline=inlineNormal;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}\u000areturn type+tokenTypes.linkInline;}\u000astream.match(/^[^>]+/,true);return tokenTypes.linkInline;}\u000afunction linkHref(stream,state){if(stream.eatSpace()){return null;}\u000avar ch=stream.next();if(ch==='('||ch==='['){state.f=state.inline=getLinkHrefInside(ch==="("?")":"]");if(modeCfg.highlightFormatting)state.formatting="link-string";state.linkHref=true;return getType(state);}\u000areturn'error';}\u000avar linkRE={")":/^(?:[^\u005c\u005c\u005c(\u005c)]|\u005c\u005c.|\u005c((?:[^\u005c\u005c\u005c(\u005c)]|\u005c\u005c.)*\u005c))*?(?=\u005c))/,"]":/^(?:[^\u005c\u005c\u005c[\u005c]]|\u005c\u005c.|\u005c[(?:[^\u005c\u005c\u005c[\u005c]]|\u005c\u005c.)*\u005c])*?(?=\u005c])/}\u000afunction getLinkHrefInside(endChar){return function(stream,state){var ch=stream.next();if(ch===endChar){state.f=state.inline=inlineNormal;if(modeCfg.highlightFormatting)state.formatting="link-string";var returnState=getType(state);state.linkHref=false;return returnState;}\u000astream.match(linkRE[endChar])\u000astate.linkHref=true;return getType(state);};}\u000afunction footnoteLink(stream,state){if(stream.match(/^([^\u005c]\u005c\u005c]|\u005c\u005c.)*\u005c]:/,false)){state.f=footnoteLinkInside;stream.next();if(modeCfg.highlightFormatting)state.formatting="link";state.linkText=true;return getType(state);}\u000areturn switchInline(stream,state,inlineNormal);}\u000afunction footnoteLinkInside(stream,state){if(stream.match(/^\u005c]:/,true)){state.f=state.inline=footnoteUrl;if(modeCfg.highlightFormatting)state.formatting="link";var returnType=getType(state);state.linkText=false;return returnType;}\u000astream.match(/^([^\u005c]\u005c\u005c]|\u005c\u005c.)+/,true);return tokenTypes.linkText;}\u000afunction footnoteUrl(stream,state){if(stream.eatSpace()){return null;}\u000astream.match(/^[^\u005cs]+/,true);if(stream.peek()===undefined){state.linkTitle=true;}else{stream.match(/^(?:\u005cs+(?:"(?:[^"\u005c\u005c]|\u005c\u005c\u005c\u005c|\u005c\u005c.)+"|'(?:[^'\u005c\u005c]|\u005c\u005c\u005c\u005c|\u005c\u005c.)+'|\u005c((?:[^)\u005c\u005c]|\u005c\u005c\u005c\u005c|\u005c\u005c.)+\u005c)))?/,true);}\u000astate.f=state.inline=inlineNormal;return tokenTypes.linkHref+" url";}\u000avar mode={startState:function(){return{f:blockNormal,prevLine:{stream:null},thisLine:{stream:null},block:blockNormal,htmlState:null,indentation:0,inline:inlineNormal,text:handleText,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,setext:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,emoji:false,fencedEndRE:null};},copyState:function(s){return{f:s.f,prevLine:s.prevLine,thisLine:s.thisLine,block:s.block,htmlState:s.htmlState&&CodeMirror.copyState(htmlMode,s.htmlState),indentation:s.indentation,localMode:s.localMode,localState:s.localMode?CodeMirror.copyState(s.localMode,s.localState):null,inline:s.inline,text:s.text,formatting:false,linkText:s.linkText,linkTitle:s.linkTitle,linkHref:s.linkHref,code:s.code,em:s.em,strong:s.strong,strikethrough:s.strikethrough,emoji:s.emoji,header:s.header,setext:s.setext,hr:s.hr,taskList:s.taskList,list:s.list,listStack:s.listStack.slice(0),quote:s.quote,indentedCode:s.indentedCode,trailingSpace:s.trailingSpace,trailingSpaceNewLine:s.trailingSpaceNewLine,md_inside:s.md_inside,fencedEndRE:s.fencedEndRE};},token:function(stream,state){state.formatting=false;if(stream!=state.thisLine.stream){state.header=0;state.hr=false;if(stream.match(/^\u005cs*$/,true)){blankLine(state);return null;}\u000astate.prevLine=state.thisLine\u000astate.thisLine={stream:stream}\u000astate.taskList=false;state.trailingSpace=0;state.trailingSpaceNewLine=false;if(!state.localState){state.f=state.block;if(state.f!=htmlBlock){var indentation=stream.match(/^\u005cs*/,true)[0].replace(/\u005ct/g,expandedTab).length;state.indentation=indentation;state.indentationDiff=null;if(indentation>0)return null;}}}\u000areturn state.f(stream,state);},innerMode:function(state){if(state.block==htmlBlock)return{state:state.htmlState,mode:htmlMode};if(state.localState)return{state:state.localState,mode:state.localMode};return{state:state,mode:mode};},indent:function(state,textAfter,line){if(state.block==htmlBlock&&htmlMode.indent)return htmlMode.indent(state.htmlState,textAfter,line)\u000aif(state.localState&&state.localMode.indent)return state.localMode.indent(state.localState,textAfter,line)\u000areturn CodeMirror.Pass},blankLine:blankLine,getType:getType,closeBrackets:"()[]{}''\u005c"\u005c"``",fold:"markdown"};return mode;},"xml");CodeMirror.defineMIME("text/markdown","markdown");CodeMirror.defineMIME("text/x-markdown","markdown");});
p1
.